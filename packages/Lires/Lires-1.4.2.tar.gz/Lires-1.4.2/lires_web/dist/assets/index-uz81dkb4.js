var yt=Object.defineProperty;var wt=(r,t,e)=>t in r?yt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var oe=(r,t,e)=>(wt(r,typeof t!="symbol"?t+"":t,e),e);import{d as q,f as T,B as k,C as me,D as Y,E as y,G as n,c as C,H as P,a as _,w as ne,F as H,I as X,z as x,J as G,K as z,L as B,M as Xe,N as U,O as _t,P as bt,Q as ee,R as te,S as qe,T as et,U as ve,V as W,W as kt,X as J,Y as Oe,Z as Re,o as ke,_ as $e,$ as St,n as $t,a0 as Dt,a1 as Ct,a2 as xt}from"./@vue-NNSWgvKg.js";import{d as Ee,c as Tt}from"./pinia-o0QJ1zBb.js";import{u as fe,a as tt,c as Pt,b as It}from"./vue-router-ZDhEVaBF.js";import{f as at}from"./fast-xml-parser-AryUhA7v.js";import{P as Ae}from"./plotly.js-dist-s6nuoKOE.js";import{y as Lt,N as Ut}from"./md-editor-v3-bbAh5hx0.js";import"./@lezer-zO5nUykE.js";import"./markdown-it-Hr5Sq5Da.js";import"./strnum-nO6OuMXP.js";import"./copy-to-clipboard-ebbzfRrE.js";import"./toggle-selection-fekekO1r.js";import"./@vavt-nbmepBNB.js";import"./codemirror-thLcTxEQ.js";import"./@codemirror-1Oy-9S_E.js";import"./style-mod-z-g5kJ9M.js";import"./w3c-keyname-KjuS0gPF.js";import"./medium-zoom-UI1A0slP.js";import"./markdown-it-image-figures-56d0Cn7e.js";import"./markdown-it-task-lists-ssNXB4M9.js";import"./entities-cg2bgkkV.js";import"./uc.micro-05tmOiB-.js";import"./mdurl-VWZ1KHdU.js";import"./linkify-it-Rn4CjAEN.js";import"./punycode-HZlgMKS9.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();const Rt=q({__name:"Popup",props:{styleType:{default:"info"},position:{default:"top-center"}},setup(r){const t=r,e=T(()=>t.styleType==="alert"||t.styleType==="error"?{backgroundColor:"rgba(180, 0, 20, 0.9)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="warning"?{backgroundColor:"rgba(210, 150, 0, 0.9)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="info"?{backgroundColor:"rgba(0, 0, 0, 0.75)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="success"?{backgroundColor:"rgba(0, 180, 0, 0.9)",color:"rgba(255, 255, 255, 1)"}:{backgroundColor:"rgba(0, 0, 0, 0.5)",color:"var(--color-text)"}),a=T(()=>{if(t.position==="top-center")return{top:"30px",left:"50%",transform:"translate(-50%, 0)"};if(t.position==="center")return{top:"50%",left:"50%",transform:"translate(-50%, -50%)"};throw Error("Incorrect style.")});return(s,i)=>(y(),k("div",{id:"popup",style:Y({...e.value,...a.value})},[me(s.$slots,"default",{},void 0,!0)],4))}}),M=(r,t)=>{const e=r.__vccOpts||r;for(const[a,s]of t)e[a]=s;return e},je=M(Rt,[["__scopeId","data-v-e0ba6b84"]]);let At=window.location.protocol,nt;nt=`${At}//${window.location.hostname}:${window.location.port}`;const Bt=`${nt}/docs/userManual_zh/index.html`;console.log("production mode");function Q(){const r=Z().backendPort;return`${Z().backendHost}:${r}`}const qt={name:"Li, Mengxun",email:"mengxunli@whu.edu.cn"},Pe=["SweetiePie","CutiePatootie","CuddleBug","FluffyPaws","HoneyBee","SnuggleMuffin","SugarPlum","AngelFace","PawsomePuppy","TeddyBearHugs","PrettyKitty","LoveBug","BabyDoll","SunshineSmiles","FuzzyWuzzy","BumbleBee","CupcakeQueen","DoodleDaisy","PurrfectPaws","CuddlyKoala","SweetPea","BunnyHop","SparklePony","HappyPanda","DreamyDove","FluffyCloud","CherryBlossom","AngelicWhisper","SnickerDoodle","LuckyLadybug","BlossomButterfly","SugarCubes","CottonCandyDreams","HoneyBunches","FurryFriend","BabyBlueEyes","SweetCheeks","PawsitiveVibes","SnugglyBear","LovelyLlama","PurrfectlyAdorable","TwinkleToes","CuddleBunny","CookieCrumbs","SunnySmiles","FluffyKitten","DarlingDeer","ButterflyKisses","FuzzyWuzzyPanda","SweetDreamer","SillyGoose","DaisyDoodle","CupcakeCutie","BuzzyBee","SnoozySnail","CharmingChick","CandyCane","BerryBlossom","Dimples","CocoaCuddles","CheerfulCherub","PetalPaws","BubblyBumble","AngelWings","JollyJellybean","WhiskerWonder","SprinkleSmiles","GigglyGiraffe","DancingDaisy","SunnySideUp","SnugglySloth","CuteQuokka","PeachyPaws","BouncyBunny","DazzlingDimples","ChirpyChickadee","CandyHeart","CupcakeSprinkle","BuzzyButterfly","SnoozyPanda","CharmingCorgi","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy","ChirpyChickadee","CandyCane","CupcakeCutie","BuzzyButterfly","SnoozySnail","CharmingCherub","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy"];var ce=function r(t){function e(ue,N){return ue>>>N|ue<<32-N}for(var a=Math.pow,s=a(2,32),i="length",o,c,l="",f=[],g=t[i]*8,d=r.h=r.h||[],u=r.k=r.k||[],h=u[i],m={},p=2;h<64;p++)if(!m[p]){for(o=0;o<313;o+=p)m[o]=p;d[h]=a(p,.5)*s|0,u[h++]=a(p,1/3)*s|0}for(t+="";t[i]%64-56;)t+="\0";for(o=0;o<t[i];o++){if(c=t.charCodeAt(o),c>>8)throw new Error("ASCII check failed");f[o>>2]|=c<<(3-o)%4*8}for(f[f[i]]=g/s|0,f[f[i]]=g,c=0;c<f[i];){var v=f.slice(c,c+=16),w=d;for(d=d.slice(0,8),o=0;o<64;o++){var b=v[o-15],S=v[o-2],D=d[0],$=d[4],L=d[7]+(e($,6)^e($,11)^e($,25))+($&d[5]^~$&d[6])+u[o]+(v[o]=o<16?v[o]:v[o-16]+(e(b,7)^e(b,18)^b>>>3)+v[o-7]+(e(S,17)^e(S,19)^S>>>10)|0),R=(e(D,2)^e(D,13)^e(D,22))+(D&d[1]^D&d[2]^d[1]&d[2]);d=[L+R|0].concat(d),d[4]=d[4]+L|0}for(o=0;o<8;o++)d[o]=d[o]+w[o]|0}for(o=0;o<8;o++)for(c=3;c+1;c--){var j=d[o]>>c*8&255;l+=(j<16?0:"")+j.toString(16)}return l};class A{constructor(){}get settings(){return Z()}apiURL(){return Q()+"/api"}async authUsr(t){const e=new URLSearchParams;e.set("key",t);const a=await fetch(`${this.apiURL()}/auth`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e.toString()});if(a.ok&&a.status===200)return JSON.parse(await a.text());throw new Error(`Got response: ${a.status}`)}async status(){const t=new FormData;t.append("key",this.settings.encKey);const e=await fetch(`${this.apiURL()}/status`,{method:"POST",body:t});if(console.log(e),e.ok)return JSON.parse(await e.text());throw new Error(`Got response: ${e.status}`)}async reqFileList(t){const e=t.join("&&"),a=new URL(`${this.apiURL()}/filelist`);a.searchParams.append("tags",e),a.searchParams.append("key",this.settings.encKey);const s=await fetch(a.toString());if(s.ok)return await s.json();throw new Error(`Got response: ${s.status}`)}async reqFileListStream(t=[],e=()=>{}){const a=t.join("&&"),s=new URL(`${this.apiURL()}/filelist-stream`);s.searchParams.append("tags",a),s.searchParams.append("key",this.settings.encKey);const i=await fetch(s.toString());if(!i.ok)throw new Error(`Got response: ${i.status}`);const o=i.headers.get("totalDataCount"),c=o?parseInt(o):-1;let l=0;const f=i.body.getReader();let g="";const d=({value:u,done:h})=>{const p=(g+new TextDecoder().decode(u)).split("\\N");for(let v=0;v<p.length-1;v++){const w=p[v];try{const b=JSON.parse(w);l+=1,e(b,l,c)}catch(b){console.error(b)}}if(p.length>0&&(g=p[p.length-1]),h){if(g)try{const v=JSON.parse(g);l+=1,e(v,l,c)}catch(v){console.error(v)}return}return f.read().then(d)};return f.read().then(d)}async reqDatabaseFeatureTSNE(t="doc_feature",e=3,a=10){const s=new URL(`${this.apiURL()}/datafeat/tsne/${t}`);s.searchParams.append("key",this.settings.encKey),s.searchParams.append("n_component",e.toString()),s.searchParams.append("perplexity",a.toString());const i=await fetch(s.toString());if(i.ok)return await i.json();throw new Error(`Got response: ${i.status}`)}async reqDatapointSummary(t){const e=new URL(`${this.apiURL()}/fileinfo/${t}`);e.searchParams.append("key",this.settings.encKey);const a=await fetch(e.toString());if(a.ok)return await a.json();throw new Error(`Got response: ${a.status}`)}async reqReloadDB(){const t=new FormData;t.append("key",this.settings.encKey);const e=await fetch(`${this.apiURL()}/reload-db`,{method:"POST",body:t});if(e.ok)return!0;throw new Error(`Got response: ${e.status}`)}async reqDatapointAbstract(t){new URLSearchParams().set("key",this.settings.encKey);const a=await fetch(`${this.apiURL()}/fileinfo-supp/abstract/${t}`);if(a.ok&&a.status===200)return await a.text();throw new Error(`Got response: ${a.status}`)}async reqDatapointAbstractUpdate(t,e){const a=new FormData;a.append("key",this.settings.encKey),a.append("content",e);const s=await fetch(`${this.apiURL()}/fileinfo-supp/abstract-update/${t}`,{method:"POST",body:a});if(s.ok)return!0;throw new Error(`Got response: ${s.status}`)}async reqDatapointNote(t){const e=new URL(`${this.apiURL()}/fileinfo-supp/note/${t}`);e.searchParams.append("key",this.settings.encKey);const a=await fetch(e.toString());if(a.ok)return await a.text();throw new Error(`Got response: ${a.status}`)}async reqDatapointNoteUpdate(t,e){const a=new URL(`${this.apiURL()}/fileinfo-supp/note-update/${t}`),s=new FormData;s.append("key",this.settings.encKey),s.append("content",e);const i=await fetch(a.toString(),{method:"POST",body:s});if(i.ok)return!0;throw new Error(`Got response: ${i.status}`)}async search(t,e){const a=new URLSearchParams;a.set("key",this.settings.encKey),a.set("method",t),a.set("kwargs",JSON.stringify(e));const s=await fetch(`${this.apiURL()}/search`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.toString()});if(s.ok&&s.status===200)return JSON.parse(await s.text());throw new Error(`Got response: ${s.status}`)}async featurize(t,e=!1){const a=new FormData;a.append("key",this.settings.encKey),a.append("text",t),a.append("require_cache",e.toString());const s=await fetch(`${this.apiURL()}/iserver/textFeature`,{method:"POST",body:a});if(s.ok&&s.status===200){const i=await s.text();return JSON.parse(i)}else throw new Error(`Got response: ${s.status}`)}reqAISummary(t,e,a=()=>{},s=!0,i="DEFAULT"){const o=new FormData;o.append("key",this.settings.encKey),o.append("force",s.toString()),o.append("uuid",t),o.append("model",i),fetch(`${this.apiURL()}/summary`,{method:"POST",body:o}).then(l=>{if(!l.ok)throw e("(Error: "+l.status+")"),new Error("HTTP error "+l.status);const f=l.body.getReader(),g=({value:d,done:u})=>{if(u){a();return}let h=new TextDecoder().decode(d);return e(h),f.read().then(g)};return f.read().then(g)}).catch(l=>{console.error(l)})}async deleteData(t){const e=new URL(`${this.apiURL()}/dataman/delete`);e.searchParams.append("key",this.settings.encKey),e.searchParams.append("uuid",t);const a=await fetch(e.toString(),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(a.ok&&a.status===200)return!0;throw new Error(`Got response: ${a.status}`)}async editData(t,e=null,a=null,s=null){if(!t&&(e===null||a===null||s===null))throw new Error("uid is null, other fields should be complete");const i=new URLSearchParams;t||(t=null),i.set("key",this.settings.encKey),i.set("uuid",JSON.stringify(t)),e!==null&&i.set("bibtex",e),a!==null&&i.set("tags",JSON.stringify(a)),s!==null&&i.set("url",s);const o=await fetch(`${this.apiURL()}/dataman/update`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i.toString()});if(o.ok&&o.status===200)return JSON.parse(await o.text());throw new Error(`Got response: ${o.status}`)}async uploadImages(t,e){return(await Promise.all(e.map(s=>new Promise((i,o)=>{const c=new FormData;c.append("file",s),c.append("key",this.settings.encKey),fetch(`${Q()}/img/${t}`,{method:"PUT",body:c}).then(l=>{if(!l.ok)throw new Error("Network response was not ok");return l.json()}).then(l=>i(l)).catch(l=>o(l))})))).map(s=>s.file_name)}async uploadDocument(t,e){const a=new FormData;a.append("file",e),a.append("key",this.settings.encKey);const s=await fetch(`${Q()}/doc/${t}`,{method:"PUT",body:a});if(s.ok)return await s.json();throw new Error(`Got response: ${s.status}`)}async freeDocument(t){const e=new FormData;e.append("key",this.settings.encKey);const a=await fetch(`${Q()}/doc/${t}`,{method:"DELETE",body:e});if(a.ok)return await a.json();throw new Error(`Got response: ${a.status}`)}async renameTag(t,e){const a=new FormData;a.append("key",this.settings.encKey),a.append("oldTag",t),a.append("newTag",e);const s=await fetch(`${this.apiURL()}/dataman/tag-rename`,{method:"POST",body:a});if(s.ok)return!0;throw new Error(`Got response: ${s.status}`)}async deleteTag(t){const e=new FormData;e.append("key",this.settings.encKey),e.append("tag",t);const a=await fetch(`${this.apiURL()}/dataman/tag-delete`,{method:"POST",body:e});if(a.ok)return!0;throw new Error(`Got response: ${a.status}`)}async reqUserInfo(t){const e=new FormData;e.append("key",this.settings.encKey);const a=await fetch(`${this.apiURL()}/user/info/${t}`,{method:"POST",body:e});if(a.ok)return await a.json();throw new Error(`Got response: ${a.status}`)}async updateUserNickname(t){const e=new FormData;e.append("key",this.settings.encKey),e.append("name",t);const a=await fetch(`${this.apiURL()}/user/info-update`,{method:"POST",body:e});if(a.ok)return await a.json();throw new Error(`Got response: ${a.status}`)}async updateUserPassword(t){const e=new FormData;e.append("key",this.settings.encKey),e.append("password",ce(t));const a=await fetch(`${this.apiURL()}/user/info-update`,{method:"POST",body:e});if(a.ok)return await a.json();throw new Error(`Got response: ${a.status}`)}async reqUserList(){const t=new FormData;t.append("key",this.settings.encKey);const e=await fetch(`${this.apiURL()}/user/list`,{method:"POST",body:t});if(e.ok)return await e.json();throw new Error(`Got response: ${e.status}`)}async uploadUserAvatar(t,e){const a=new FormData;a.append("file",e),a.append("key",this.settings.encKey);const s=await fetch(`${Q()}/user-avatar/${t}`,{method:"PUT",body:a});if(s.ok)return await s.json();throw new Error(`Got response: ${s.status}`)}async setUserAccess(t,e,a){const s=new FormData;s.append("key",this.settings.encKey),s.append("username",t),e!==null&&s.append("is_admin",e.toString()),a!==null&&s.append("mandatory_tags",JSON.stringify(a));const i=await fetch(`${this.apiURL()}/userman/modify`,{method:"POST",body:s});if(i.ok)return await i.json();throw new Error(`Got response: ${i.status}`)}async createUser(t,e,a,s,i){const o=new FormData;o.append("key",this.settings.encKey),o.append("username",t),o.append("name",e),o.append("password",ce(a)),o.append("is_admin",s.toString()),o.append("mandatory_tags",JSON.stringify(i));const c=await fetch(`${this.apiURL()}/userman/create`,{method:"POST",body:o});if(c.ok)return await c.json();throw new Error(`Got response: ${c.status}`)}async deleteUser(t){const e=new FormData;e.append("key",this.settings.encKey),e.append("username",t);const a=await fetch(`${this.apiURL()}/userman/delete`,{method:"POST",body:e});if(a.ok)return!0;throw new Error(`Got response: ${a.status}`)}async changelog(){const t=new URL(`${this.apiURL()}/info/changelog`);t.searchParams.append("key",this.settings.encKey);const e=await fetch(t.toString(),{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(e.ok&&e.status===200)return JSON.parse(await e.text());throw new Error(`Got response: ${e.status}`)}}const se="->";function Ve(){return`${Q()}/api`}class E extends Set{static removeSpaces(t){const e=t.split(se);for(let a=0;a<e.length;a++)e[a]=e[a].trim();return t=e.join(se),t}constructor(t=null){t===null&&(t=[]);const e=t instanceof Set?t:new Set(t);e.forEach(a=>E.removeSpaces(a)),super(e)}copy(){return new E(this)}add(t){return super.add(E.removeSpaces(t))}has(t){return super.has(E.removeSpaces(t))}union(t){const e=new E(this);return e.union_(t),e}union_(t){return t.forEach(e=>this.add(e)),this}pop(t){const e=new E(this);return e.pop_(t),e}pop_(t){return t.forEach(e=>this.delete(e)),this}pop_ifcontains_(t){return t.forEach(e=>{this.has(e)&&this.delete(e)}),this}issubset(t){return we.isSubset(this,t)}withParents(){const t=new E(this);return this.forEach(e=>t.union_(we.allParentsOf(e))),t}withChildsFrom(t){const e=new E(this);return this.forEach(a=>e.union_(we.allChildsOf(a,t))),e}allParents(){const t=new E;return this.forEach(e=>t.union_(we.allParentsOf(e))),t}toArray(){return Array.from(this)}}class we{static allParentsOf(t){const e=t.split(se);if(e.length===1)return new E([]);const a=[],s=[];for(let i=0;i<e.length-1;i++)a.push(e[i]),s.push(a.join(se));return new E(s)}static allChildsOf(t,e){const a=new E;for(const s of e)s.startsWith(t)&&s.length>t.length+se.length&&s.substring(t.length,t.length+se.length)===`${se}`&&a.add(s);return a}static tagHierarchy(t){const e=se;function a(o,c){const l=o.split(c);return l.length===1?[o]:[l[0],l.slice(1).join(c)]}function s(o,c=e){const l={},f=o.map(d=>a(d,c));for(const d of f)d[0]in l||(l[d[0]]=[]),d.length===2&&l[d[0]].push(d[1]);const g={};for(const d in l)g[d]=s(l[d],c);return g}function i(o,c=e){for(const l in o){const f=o[l];for(const g in f){const d=[l,g].join(e);f[d]=f[g],delete f[g]}i(f,c)}return o}return i(s(Array.from(t)))}static isSubset(t,e){let a=!0;for(const s of t)if(!e.has(s)){a=!1;break}return a}}class Ge{constructor(t){oe(this,"summary");oe(this,"supp");this.summary=t,this.supp={note:null,abstract:null}}get tags(){return new E(this.summary.tags)}toString(){return`${this.summary.title} - ${this.authorAbbr()} (${this.summary.year}) [uid: ${this.summary.uuid}]`}fetchAbstract(){return new Promise((t,e)=>{new A().reqDatapointAbstract(this.summary.uuid).then(a=>{this.supp.abstract=a,t(a)}).catch(a=>{e(a)})})}uploadAbstract(t){return new Promise((e,a)=>{if(t===this.supp.abstract||t===null){e(!0);return}new A().reqDatapointAbstractUpdate(this.summary.uuid,t).then(s=>{this.supp.abstract=t,e(s)}).catch(s=>{a(s)})})}fetchNote(){return new Promise((t,e)=>{new A().reqDatapointNote(this.summary.uuid).then(a=>{this.supp.note=a,t(a)}).catch(a=>{e(a)})})}uploadNote(t){return t===null?Promise.reject("Note is null"):(t=t.replace(new RegExp(`${Q()}/img/${this.summary.uuid}\\?fname=`,"g"),"./misc/"),new Promise((e,a)=>{new A().reqDatapointNoteUpdate(this.summary.uuid,t).then(s=>{this.supp.note=t,this.summary.note_linecount=t.split(`
`).map(i=>i.trim()==""?0:1).reduce((i,o)=>i+o,0),e(s)}).catch(s=>{a(s)})}))}uploadImages(t){return new Promise((e,a)=>{new A().uploadImages(this.summary.uuid,t).then(s=>{e(s.map(i=>`./misc/${i}`))},s=>{a(s)})})}uploadDocument(t){return new A().uploadDocument(this.summary.uuid,t)}freeDocument(){return new A().freeDocument(this.summary.uuid)}update(t=null){if(t!==null)return this.summary=t,Promise.resolve(t);const e=new A().reqDatapointSummary(this.summary.uuid);return e.then(a=>{this.summary=a}),e}destory(){this.summary=Be}authorAbbr(){let t="";return this.summary.authors.length>1&&(t=" et al."),this.summary.authors[0]+t}authorYear(){return`${this.authorAbbr()} ${this.summary.year}`}yearAuthor(t=" "){return`${this.summary.year}${t}${this.authorAbbr()}`}isDummy(){return this.summary.uuid===Be.uuid}getRawDocURL(){const t=this.summary.uuid;return this.summary.has_file&&this.summary.file_type==".pdf"?`${Q()}/doc/${t}`:!this.summary.has_file&&this.summary.url?this.summary.url:"about:blank"}getOpenDocURL({extraPDFViewerParams:t={},urlHashMark:e=""}={}){const a=this.summary.uuid,s=`${Q()}/pdfjs/web/viewer.html`;function i(l,f=s){const g=new URLSearchParams;f===s&&g.append("key",Z().encKey),g.append("file",`${l}`);for(const d in t)g.append(d,t[d]);return`${f}?${g.toString()}`}function o(l){return e?(new URL(l).hash&&(l=l.slice(0,l.indexOf("#"))),`${l}#${e}`):l}let c="about:blank";if(this.isDummy()&&(c="about:blank"),this.summary.has_file&&this.summary.file_type==".pdf"){const l=`${Q()}/doc/${a}`;c=i(o(l))}return!this.summary.has_file&&this.summary.url&&(c=o(this.summary.url)),console.log("Open doc url: ",c),c}getOpenNoteURL(){const t=this.summary.uuid;return`${Ve()}/comment/${t}/`}getOpenSummaryURL(){const t=this.summary.uuid;return`${Ve()}/summary?uuid=${t}&key=${Z().encKey}`}docType(){return this.summary.has_file&&this.summary.file_type==".pdf"?"pdf":!this.summary.has_file&&this.summary.url?"url":!this.summary.has_file&&!this.summary.url?"":"unknown"}}const Be={has_file:!1,file_type:"",year:"0000",title:" ",author:" ",authors:[" "],publication:null,tags:[],uuid:" ",url:"about:blank",time_added:0,time_modified:0,bibtex:"",doc_size:0,note_linecount:0,has_abstract:!1};class Ot{constructor(){oe(this,"data");oe(this,"_initliazed");this.data={},this._initliazed=!1}get initialized(){return this._initliazed}*[Symbol.iterator](){for(let t in this.data)yield this.data[t]}async requestData(){const e=await new A().reqFileList([]);console.log("Get infolist of size: ",(JSON.stringify(e).length*2/1024/1024).toPrecision(2),"MB"),this.clear();for(let a of e)this.add(a);this._initliazed=!0}async requestDataStream(t=()=>{}){const e=new A;this.clear(),await e.reqFileListStream([],(a,s,i)=>{this.add(a),t(s,i)}),console.log("Get datapoints of size: ",(JSON.stringify(this.data).length*2/1024/1024).toPrecision(2),"MB"),this._initliazed=!0}add(t){return this.data[t.uuid]=new Ge(t),this.data[t.uuid]}clear(){this.data={},this._initliazed=!1}delete(t){delete this.data[t]}get(t){return t in this.data?this.data[t]:new Ge(Be)}getMany(t){const e=[];for(const a of t)e.push(this.get(a));return e}getAllTags(){let t,e=new Set;for(const a of this){t=a.summary.tags;for(const s of t)e.add(s)}return new E(e)}getDataByTags(t){t=new E(t);const e=[];for(const a in this.data){const s=this.data[a],i=new E(s.summary.tags);t.issubset(i.withParents())&&e.push(s)}return e}async renameTag(t,e){if(t=E.removeSpaces(t),e=E.removeSpaces(e),await new A().renameTag(t,e)){const i=this.getDataByTags([t]);return(await Promise.all(i.map(c=>c.update()))).every(c=>c)}else return!1}async deleteTag(t){if(t=E.removeSpaces(t),await new A().deleteTag(t)){const s=this.getDataByTags([t]);return(await Promise.all(s.map(o=>o.update()))).every(o=>o)}else return!1}}class Me{static async filter(t,e){const a=e.content.toLowerCase();if(!a)return{datapoints:this.sortDefault(t,!1),scores:null};const s=new Set;for(const o of t)s.add(o.summary.uuid);const i=new Array;if(e.searchBy.toLowerCase()==="feature"){const c=await new A().search("searchFeature",{pattern:e.content,n_return:999}),l=new Array;for(const g of t)if(c[g.summary.uuid]){i.push(g);const d=c[g.summary.uuid].score;l.push(d)}const f=this.sortByScore(i,l,!1);return{datapoints:f[0],scores:f[1]}}else if(e.searchBy.toLowerCase()==="note"){const c=await new A().search("searchNote",{pattern:e.content,ignore_case:!0}),l=Object.keys(c);for(const f of t)l.includes(f.summary.uuid)&&i.push(f);return{datapoints:this.sortDefault(i,!1),scores:null}}else if(e.searchBy.toLowerCase()==="title")for(const o of t)o.summary.title.toLowerCase().search(a)!==-1&&i.push(o);else if(e.searchBy.toLowerCase()==="uuid")for(const o of t)o.summary.uuid.toLowerCase().search(a)!==-1&&i.push(o);else if(e.searchBy.toLowerCase()==="author"){const o=K().authorPublicationMap,c=be(e.content);if(c in o)for(const l of o[c])s.has(l.summary.uuid)&&i.push(l);else for(const l in o)if(l.search(c)!==-1)for(const f of o[l])s.has(f.summary.uuid)&&i.push(f)}else if(e.searchBy.toLowerCase()==="publication")for(const o of t)o.summary.publication&&o.summary.publication.toLowerCase().search(a)!==-1&&i.push(o);else if(e.searchBy.toLowerCase()==="general")for(const o of t)`${o.summary.title}|${o.summary.authors.join(", ")}|${o.summary.year}`.toLowerCase().search(a)!==-1&&i.push(o);else throw new Error("Unknown searchBy option");return{datapoints:this.sortDefault(i,!1),scores:null}}static sortDefault(t,e=!1){return e?t.sort((a,s)=>a.summary.time_added-s.summary.time_added):t.sort((a,s)=>s.summary.time_added-a.summary.time_added)}static sortByScore(t,e,a=!1){if(t.length!==e.length)throw new Error("arr.length !== scores.length");const s=new Array;for(let l=0;l<t.length;l++)s.push([t[l],e[l]]);let i;a?i=s.sort((l,f)=>l[1]-f[1]):i=s.sort((l,f)=>f[1]-l[1]);const o=new Array,c=new Array;for(const l of i)o.push(l[0]),c.push(l[1]);return[o,c]}}function be(r){r=r.trim().toLowerCase().replace(/-/g,"");let t=r.trim();if(t.includes(",")){const[e,a]=t.split(",",2);t=`${e.trim()}, ${a.trim()}`}else{if(t.indexOf(" ")===-1)return t;const e=t.lastIndexOf(" "),a=t.slice(e+1),s=t.slice(0,e);t=`${a.trim()}, ${s.trim()}`}return t}async function Et(r){if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(r),!0;{const t=document.createElement("textarea");t.value=r,t.style.position="absolute",t.style.left="-99999999px",document.body.prepend(t),t.select();let e=!1;try{document.execCommand("copy")}catch(a){console.log(a),e=!0}finally{t.remove()}return!e}}function Ie(r){window.open(r,"_blank")}function st(r,t){let e=null;return function(...a){e&&window.clearTimeout(e),e=window.setTimeout(()=>{r(...a),e=null},t)}}const O=Ee("uiStatus",{state:()=>({tagStatus:{checked:new E,all:new E,unfolded:new E},shownDataUIDs:[],shownDataScores:[],searchState:{searchBy:"",content:""},unfoldedDataUIDs:[],recentlyReadDataUIDs:[],preferredReaderLeftPanelWidthPerc:.65,popupValues:{},databaseLoadingStatus:{nCurrent:0,nTotal:-1}}),getters:{databaseLoadingProgress(){return this.databaseLoadingStatus.nTotal===-1?this.databaseLoadingStatus.nCurrent===0?0:1:this.databaseLoadingStatus.nCurrent/this.databaseLoadingStatus.nTotal}},actions:{updateShownData(){const r=K();this.tagStatus.all=r.allTags;const t=r.database.getDataByTags(this.tagStatus.checked);Me.filter(t,this.searchState).then(e=>{this.shownDataUIDs=e.datapoints.map(a=>a.summary.uuid),this.shownDataScores=e.scores})},addRecentlyReadDataUID(r){K().database.get(r).isDummy()||(this.recentlyReadDataUIDs.includes(r)&&this.recentlyReadDataUIDs.splice(this.recentlyReadDataUIDs.indexOf(r),1),this.recentlyReadDataUIDs.unshift(r),this.recentlyReadDataUIDs.length>5&&this.recentlyReadDataUIDs.pop())},showPopup(r,t="info",e=3e3){const a=Math.random().toString();this.popupValues[a]={content:r,styleType:t},setTimeout(()=>{delete this.popupValues[a]},e)},reloadDatabase(r=!1){K().reload(r,()=>{this.databaseLoadingStatus.nCurrent=0,K().database.clear(),this.updateShownData()},()=>{this.updateShownData(),O().databaseLoadingStatus.nTotal=-1},()=>{this.showPopup(`Failed to load database from: ${new A().apiURL()}`,"alert"),O().databaseLoadingStatus.nTotal=-1},(t,e)=>{this.databaseLoadingStatus.nCurrent=t,this.databaseLoadingStatus.nTotal=e})}}}),K=Ee("data",{state:()=>({database:new Ot,user:{id:-1,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1}}),getters:{authorPublicationMap(){const r={};console.log("Generating authorPublicationMap...");for(const t of this.database)for(let e of t.summary.authors)e=be(e),e in r||(r[e]=[]),r[e].push(t);return r},allTags(){return this.database.getAllTags()}},actions:{clearUserInfo(){this.user={id:0,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1}},reload(r=!1,t=()=>{this.database.clear()},e=()=>{},a=()=>{},s=()=>{}){t();function i(o){o.database.requestDataStream(s).then(c=>{e()},c=>{a(c)})}r?new A().reqReloadDB().then(o=>{console.log("Reload: ",o),o?i(this):a(new Error("Failed to reload database from backend"))},o=>{a(o)}):i(this)}}}),Z=Ee("settings",{state:()=>({__encKey:sessionStorage.getItem("encKey")||localStorage.getItem("encKey")||"",__showTagPanel:(localStorage.getItem("showTagPanel")||"true")==="true",__show3DScatterPlot:(localStorage.getItem("show3DScatterPlot")||"false")==="true",__readerLayoutType:localStorage.getItem("readerLayoutType")||"2",__backendHost:sessionStorage.getItem("backendUrl")||Mt(),__backendPort:sessionStorage.getItem("backendPort")||Ft(),loggedIn:!1}),getters:{encKey(){return this.__encKey},backendHost(){return this.__backendHost},backendPort(){return this.__backendPort},showTagPanel(){return this.__showTagPanel},show3DScatterPlot(){return this.__show3DScatterPlot},readerLayoutType(){return parseInt(this.__readerLayoutType)}},actions:{setEncKey(r,t){this.__encKey=r,t===!0?localStorage.setItem("encKey",r):(localStorage.getItem("encKey")&&localStorage.removeItem("encKey"),sessionStorage.setItem("encKey",r))},setBackendHost(r){this.__backendHost=r,sessionStorage.setItem("backendUrl",r)},setBackendPort(r){this.__backendPort=r,sessionStorage.setItem("backendPort",r)},setShowTagPanel(r){this.__showTagPanel=r,localStorage.setItem("showTagPanel",r.toString())},setShow3DScatterPlot(r){this.__show3DScatterPlot=r,localStorage.setItem("show3DScatterPlot",r.toString())},setReaderLayoutType(r){this.__readerLayoutType=r.toString(),localStorage.setItem("readerLayoutType",r.toString())}}});function Mt(){let r=window.location.protocol,t=window.location.hostname;return`${r}//${t}`}function Ft(){const r=window.location.port;return r==="1420"?"8080":r}function Fe(r,t,e){Z().setEncKey(r,e),t!==null?K().user=t:K().clearUserInfo(),t?Z().loggedIn=!0:Z().loggedIn=!1}function zt(){Fe("",null,!0)}async function Nt(){const r=new A,t=Z().encKey;try{const e=await r.authUsr(t);return Fe(t,e,!0),e}catch(e){return console.log("settingsAuthentication failed: ",e),null}}function Ht(r,t){return ce(r+ce(t))}const _e={};window.g_eventHooks=_e;function ae(r,t){if(Array.isArray(r)){for(const e of r)ae(e,t);return}_e[r]===void 0&&(_e[r]=[]),_e[r].push(t)}function Le(){return window.g_wsConn===void 0&&(window.g_wsConn=new Kt),window.g_wsConn}class Kt{constructor(){oe(this,"resetRemainingRetries",()=>{this.__remainingRetries=10});oe(this,"decreaseRemainingRetries",()=>{this.__remainingRetries-=1});oe(this,"isOpen",()=>this.ws?this.ws.readyState===WebSocket.OPEN:!1);oe(this,"willTryReconnect",()=>this.__remainingRetries>0);this.resetRemainingRetries(),this.sessionID=ce(Date.now().toString()).slice(0,16),this.__eventCallback_records={onopenCallback:()=>{},onmessageCallback:t=>{},oncloseCallback:()=>{},onfailedToConnectCallback:()=>{}}}get settings(){return Z()}init({onopenCallback:t=()=>{},onmessageCallback:e=i=>{},oncloseCallback:a=()=>{},onfailedToConnectCallback:s=()=>{}}={}){this.__eventCallback_records={onopenCallback:t,onmessageCallback:e,oncloseCallback:a,onfailedToConnectCallback:s};const i=new URLSearchParams(window.location.search);i.append("key",this.settings.encKey),i.append("session_id",this.sessionID);const o=Q().replace("https://","wss://").replace("http://","ws://")+"/ws?"+i.toString();return console.log("connecting to server websocket at: ",o),this.ws=new WebSocket(o),this.ws.onmessage=c=>{console.log(c);const l=JSON.parse(c.data);if(l.type==="event"){const f=l.content;if(console.log(f),Object.keys(_e).includes(f.type))for(const g of _e[f.type])g(f)}e(c)},this.ws.onopen=()=>{console.log("connected to server websocket"),t(),this.resetRemainingRetries()},this.ws.onclose=()=>{console.log("server websocket closed, will try to reconnect in 1 second"),a(),this.willTryReconnect()?(this.decreaseRemainingRetries(),new Promise(c=>setTimeout(c,1e3)).then(()=>{this.ws.readyState===WebSocket.CLOSED&&this.init({onopenCallback:t,onmessageCallback:e,oncloseCallback:a,onfailedToConnectCallback:s})})):s()},this}send(t){this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(t)):console.log("server websocket not ready, cannot send data")}reset(){this.ws.readyState===WebSocket.OPEN&&this.ws.close(),this.resetRemainingRetries(),this.init(this.__eventCallback_records)}close(){this.ws.readyState===WebSocket.OPEN?this.ws.close():console.log("server websocket not ready, cannot close")}}const Wt={class:"loading-widget"},Zt=q({__name:"LoadingWidget",props:{size:{default:"40px"},border_width:{default:"5px"}},setup(r){const t=r,e=T(()=>({width:t.size,height:t.size,border:t.border_width+" solid var(--color-border)",borderTopColor:"var(--color-primary)"}));return(a,s)=>(y(),k("div",Wt,[n("div",{class:"loading-widget__spinner",style:Y(e.value)},null,4)]))}}),Ue=M(Zt,[["__scopeId","data-v-1d6933bb"]]),jt={class:"loading-popout"},Vt=q({__name:"LoadingPopout",props:{text:{default:"loading"}},setup(r){const t=r;return(e,a)=>(y(),k("div",jt,[C(Ue,{size:"25px"}),n("label",null,P(t.text),1)]))}}),Gt=M(Vt,[["__scopeId","data-v-95a13423"]]),Jt=r=>(ee("data-v-b0e4c150"),r=r(),te(),r),Qt={id:"popups"},Yt=Jt(()=>n("div",null,[n("div",{style:{"font-size":"2em","font-weight":"bold",color:"var(--color-red)"}},"Failed to connect to server"),n("div",{style:{color:"gray"}},"Maximum retry exceeded")],-1)),Xt={id:"app"},ea=q({__name:"App",setup(r){const t=fe(),e=O(),a=Z();t.isReady().then(()=>{if(t.currentRoute.value.query.backendPort&&Z().setBackendPort(t.currentRoute.value.query.backendPort),t.currentRoute.value.query.backendHost&&Z().setBackendHost(t.currentRoute.value.query.backendHost),t.currentRoute.value.query.credential&&Z().setEncKey(t.currentRoute.value.query.credential,!1),window.location.hash.split("?")[0]!=="#/login"){console.log("Authenticating...");const u=()=>{a.loggedIn?a.loggedIn=!1:g()};Nt().then(h=>{h||u()},()=>{u()})}});const s=_(!1),i=_(!1),o=_(window.location.hash.split("?")[0]==="#/login");t.afterEach((u,h)=>{o.value=u.path==="/login"});const c=T(()=>!s.value&&!o.value&&!i.value),l=T(()=>i.value&&!o.value);function f(){console.log("Logged in."),Le().init({onopenCallback:()=>{s.value=!0,i.value=!1},oncloseCallback:()=>s.value=!1,onfailedToConnectCallback:()=>i.value=!0}),e.reloadDatabase()}function g(){console.log("Logged out from: ",t.currentRoute.value.fullPath),Le().isOpen()&&Le().close(),t.push({path:"/login",query:{from:t.currentRoute.value.fullPath}})}ne(()=>a.loggedIn,(u,h)=>{u?f():g()}),ae("add_entry",u=>{const h=K(),m=u.datapoint_summary;h.database.add(m),e.updateShownData()}),ae("update_entry",u=>{var p;const h=K(),m=u.datapoint_summary;(p=h.database.get(m.uuid))==null||p.update(m),e.updateShownData()}),ae("delete_entry",u=>{const h=K(),m=u.uuid;h.database.delete(m),e.updateShownData()}),ae(["delete_tag","update_tag"],u=>{const h=new E([u.src_tag]),p=K().database.getDataByTags(h);Promise.all(p.map(v=>v.update())).then(()=>{e.updateShownData()},()=>{e.showPopup("Tag rename succeded at server side, but faild to fetch update, please reload the page","error")})}),ae("update_user",u=>{if(u.username===K().user.username){if(u.user_info===null)throw new Error("assertion failed: User info is null");for(const h of Object.keys(K().user))h!=="enc_key"&&(K().user[h]=u.user_info[h])}});const d=()=>{window.location.reload()};return(u,h)=>{const m=Xe("router-view");return y(),k(H,null,[n("div",Qt,[(y(!0),k(H,null,X(Object.keys(x(e).popupValues),(p,v)=>(y(),G(je,{key:v,styleType:x(e).popupValues[p].styleType,style:Y({transform:`translate(-50%, ${-50+110*v}%) scale(0.9)`})},{default:B(()=>[U(P(x(e).popupValues[p].content),1)]),_:2},1032,["styleType","style"]))),128))]),c.value?(y(),G(Gt,{key:0,text:"connecting..."})):z("",!0),l.value?(y(),G(je,{key:1,styleType:"info",position:"center"},{default:B(()=>[n("div",{style:{display:"flex","flex-direction":"column","align-items":"center",margin:"10px"}},[Yt,n("div",{style:{"font-size":"1.2em","margin-top":"10px"}},[U(" Please check if the server is running, make sure your network is working properly, and try to "),n("a",{style:{"text-decoration":"underline",cursor:"pointer"},onClick:d},"reload the page"),U(". ")])])]),_:1})):z("",!0),n("div",Xt,[C(m,null,{default:B(({Component:p})=>[(y(),G(bt,{exclude:"Reader"},[(y(),G(_t(p)))],1024))]),_:1})])],64)}}}),ta=M(ea,[["__scopeId","data-v-b0e4c150"]]),aa={for:"chk"},na={id:"checkCircle"},sa={key:0,id:"checkStatus"},oa=q({__name:"Toggle",props:{checked:{type:Boolean},identifier:{default:""}},emits:["onCheck"],setup(r,{emit:t}){const e=t,a=r;function s(i){e("onCheck",a.identifier)}return(i,o)=>(y(),k("div",{class:"toggle",onClick:s},[n("label",aa,[me(i.$slots,"default",{},void 0,!0)]),n("div",na,[i.checked?(y(),k("div",sa)):z("",!0)])]))}}),pe=M(oa,[["__scopeId","data-v-582ee950"]]),ra={class:"toggleText"},ia={class:"children slideInDown"},la=q({__name:"TagCollapsibleToggle",props:{tagStatus:{},identifier:{default:""},children:{}},emits:["update:tagStatus"],setup(r,{emit:t}){const e=r,a=t,s=T({get:()=>e.tagStatus,set:m=>a("update:tagStatus",m)}),i=T(()=>{let m="collapseButton";return Object.keys(e.children).length!==0&&(m+=" collapsible"),m}),o=_(null),c=T(()=>!e.tagStatus.unfolded.has(e.identifier)),l=T(()=>c.value?"triangle-right":"triangle-down rotate90in");function f(m){let p=s.value.unfolded;p.has(e.identifier)?p.delete(e.identifier):p.add(e.identifier)}const g=T(()=>e.tagStatus.checked.has(e.identifier));function d(m){if(m===void 0)return;let p=s.value.checked;p.has(m)?p.delete(m):p.add(m)}const u=_(null),h=m=>{m.button===2&&(f(),m.preventDefault())};return qe(()=>{var m;(m=u.value)==null||m.addEventListener("contextmenu",h)}),et(()=>{var m;(m=u.value)==null||m.removeEventListener("contextmenu",h)}),(m,p)=>(y(),k(H,null,[n("div",{class:"row",ref_key:"rowDiv",ref:u},[n("div",{id:"button",class:ve(i.value),ref_key:"button",ref:o,onClick:f},[Object.keys(e.children).length!==0?(y(),k("div",{key:0,class:ve(l.value)},null,2)):z("",!0)],2),n("div",ra,[C(pe,{checked:g.value,identifier:e.identifier,onOnCheck:d},{default:B(()=>[me(m.$slots,"default",{},void 0,!0)]),_:3},8,["checked","identifier"])])],512),W(n("div",ia,[(y(!0),k(H,null,X(m.children,(v,w)=>(y(),G(ot,{identifier:String(w),children:v,"tag-status":s.value,"onUpdate:tagStatus":p[0]||(p[0]=b=>s.value=b)},{default:B(()=>[U(P(String(w).split(x(se)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tag-status"]))),256))],512),[[kt,!c.value]])],64))}}),ot=M(la,[["__scopeId","data-v-6b911d48"]]),ua={id:"tagSelector-main",class:"scrollable"},da=q({__name:"TagSelector",props:{tagStatus:{}},emits:["update:tagStatus"],setup(r,{emit:t}){const e=r,a=t,s=T(()=>we.tagHierarchy(e.tagStatus.all)),i=T(()=>Object.keys(s.value).sort()),o=T({get:()=>e.tagStatus,set:c=>a("update:tagStatus",c)});return(c,l)=>(y(),k("div",ua,[(y(!0),k(H,null,X(i.value,f=>(y(),G(ot,{identifier:String(f),children:s.value[f],tagStatus:o.value,"onUpdate:tagStatus":l[0]||(l[0]=g=>o.value=g)},{default:B(()=>[U(P(String(f).split(x(se)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tagStatus"]))),256))]))}}),rt=M(da,[["__scopeId","data-v-bd49347d"]]),ca={key:0,class:"prefix"},pa=q({__name:"TagBubble",props:{tag:{},tStyle:{default:""}},emits:["click"],setup(r,{emit:t}){const e=r,a=t,s=T(()=>{const i=e.tag.split(se);return i.length==1?["",i[0]]:[i.slice(0,i.length-1).join("·"),i[i.length-1]]});return(i,o)=>(y(),k("div",{class:ve(`bubble${i.tStyle?" "+i.tStyle:""}`),onClick:o[0]||(o[0]=()=>a("click"))},[s.value[0]?(y(),k("div",ca,P(s.value[0]),1)):z("",!0),U(" "+P(s.value[1]),1)],2))}}),ha=M(pa,[["__scopeId","data-v-bb44911a"]]),ma=q({__name:"TagBubbleContainer",props:{tags:{},highlightTags:{default:null},mutedTags:{default:null},maxWidth:{default:null},middleAlign:{type:Boolean,default:!1}},emits:["clickOnBubble"],setup(r,{emit:t}){const e=r,a=t,s=T(()=>{const i={};for(const o of e.tags)e.highlightTags&&e.highlightTags.has(o)?i[o]="highlight":e.mutedTags&&e.mutedTags.has(o)?i[o]="muted":i[o]="";return i});return(i,o)=>(y(),k("div",{id:"bubbleContainer",class:"scrollable",style:Y({maxWidth:`${(e.maxWidth?e.maxWidth:999)-10}px`,justifyContent:e.middleAlign?"center":"flex-start"})},[(y(!0),k(H,null,X(e.tags,c=>(y(),G(ha,{onClick:()=>a("clickOnBubble",c),tag:c,"t-style":s.value[c]},null,8,["onClick","tag","t-style"]))),256))],4))}}),it=M(ma,[["__scopeId","data-v-f638404a"]]),ze=r=>(ee("data-v-dce6739f"),r=r(),te(),r),fa=ze(()=>n("h3",{class:"green"},"Tags",-1)),va=ze(()=>n("hr",null,null,-1)),ga=ze(()=>n("hr",null,null,-1)),ya=q({__name:"FileTags",emits:["onCheck"],setup(r,{emit:t}){const e=t,a=O(),s=K(),i=_(null),o=T(()=>O().unfoldedDataUIDs.length==0?null:a.shownDataUIDs.includes(a.unfoldedDataUIDs[0])?K().database.get(O().unfoldedDataUIDs[0]):null),c=T(()=>o.value==null?null:a.tagStatus.checked.withChildsFrom(o.value.tags)),l=T(()=>{const u=a.tagStatus.checked.copy();return o.value!==null&&u.pop_ifcontains_(o.value.tags),u});function f(){a.tagStatus.checked=new E,a.updateShownData()}ne(a.tagStatus,()=>e("onCheck",a.tagStatus),{deep:!0});function g(){const u=prompt("Old tag");if(u&&s.database.getAllTags().has(u)){const h=prompt("New tag");h&&new A().renameTag(u,h).then(()=>{a.showPopup("Tag renamed","success")},()=>{a.showPopup("Failed to rename tag","error")})}else a.showPopup("Invalid tag","warning")}function d(){const u=prompt("Tag to delete");if(u&&s.database.getAllTags().has(u)){if(!confirm(`Are you sure to delete tag "${u}"?`))return;new A().deleteTag(u).then(()=>{a.showPopup("Tag deleted","success")},()=>{a.showPopup("Failed to delete tag","error")})}else a.showPopup("Invalid tag","warning")}return(u,h)=>(y(),k("div",{id:"file-tags-main",ref_key:"ftPanel",ref:i},[n("div",{class:"title"},[n("div",{id:"title-title"},[fa,n("div",{id:"title-buttons"},[n("div",{class:"button",onClick:g},"rename"),n("div",{class:"button",onClick:d},"delete")])]),va]),C(rt,{onOnCheck:h[0]||(h[0]=m=>e("onCheck",m)),tagStatus:x(a).tagStatus,"onUpdate:tagStatus":h[1]||(h[1]=m=>x(a).tagStatus=m)},null,8,["tagStatus"]),ga,C(it,{onClickOnBubble:h[2]||(h[2]=m=>{x(a).tagStatus.checked.has(m)?x(a).tagStatus.checked.delete(m):x(a).tagStatus.checked.add(m),x(a).updateShownData()}),tags:o.value?o.value.tags:x(a).tagStatus.checked,"highlight-tags":c.value,"muted-tags":l.value,"max-width":i.value?i.value.clientWidth:null},null,8,["tags","highlight-tags","muted-tags","max-width"]),n("div",{class:"buttons"},[n("button",{id:"btnClear",class:"green",onClick:f},"CLEAR SELECTION")])],512))}}),wa=M(ya,[["__scopeId","data-v-dce6739f"]]),_a="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-80q-50%200-85-35t-35-85v-120h120v-560h600v680q0%2050-35%2085t-85%2035H240Zm480-80q17%200%2028.5-11.5T760-200v-600H320v480h360v120q0%2017%2011.5%2028.5T720-160ZM360-600v-80h360v80H360Zm0%20120v-80h360v80H360ZM240-160h360v-80H200v40q0%2017%2011.5%2028.5T240-160Zm0%200h-40%20400-360Z'/%3e%3c/svg%3e",Ne="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M480%20856q-115%200-197.5-82.5T200%20576q0-115%2082.5-197.5T480%20296q115%200%20197.5%2082.5T760%20576q0%20115-82.5%20197.5T480%20856Z'/%3e%3c/svg%3e",ba="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M331%20625h37v-83h48q15.725%200%2026.362-10.638Q453%20520.725%20453%20505v-48q0-15.725-10.638-26.362Q431.725%20420%20416%20420h-85v205Zm37-120v-48h48v48h-48Zm129%20120h84q15%200%2026-10.638%2011-10.637%2011-26.362V457q0-15.725-11-26.362Q596%20420%20581%20420h-84v205Zm37-37V457h47v131h-47Zm133%2037h37v-83h50v-37h-50v-48h50v-37h-87v205ZM260%20856q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h560q24%200%2042%2018t18%2042v560q0%2024-18%2042t-42%2018H260ZM140%20976q-24%200-42-18t-18-42V296h60v620h620v60H140Z'/%3e%3c/svg%3e",ka="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M251%20896q-88%200-149.5-61.5T40%20685q0-78%2050-137t127-71q20-97%2094-158.5T482%20257q112%200%20189%2081.5T748%20534v24q72-2%20122%2046.5T920%20727q0%2069-50%20119t-119%2050H251Z'/%3e%3c/svg%3e",Sa="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554h189L551%20236v186Z'/%3e%3c/svg%3e",$a="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554V236H220v680h520V422H551ZM220%20236v186-186%20680-680Z'/%3e%3c/svg%3e",Da=r=>(ee("data-v-97dd0391"),r=r(),te(),r),Ca={key:0,id:"window"},xa={class:"header"},Ta=Da(()=>n("span",{class:"close-icon"},"✕",-1)),Pa=[Ta],Ia=q({__name:"FloatingWindow",props:{title:{default:"_"},show:{type:Boolean},closeKey:{default:"Escape"},compact:{type:Boolean,default:!1},zIndex:{default:100}},emits:["close","onClose","update:show"],setup(r,{emit:t}){const e=r,a=t,s=T({get:()=>e.show,set:o=>{a("update:show",o)}});function i(){s.value=!1,a("onClose"),a("close")}return window.addEventListener("keydown",o=>{o.key===e.closeKey&&(i(),o.preventDefault())}),(o,c)=>s.value?(y(),k("div",Ca,[n("div",{id:"blocker",onClick:i,style:Y({"z-index":o.zIndex-1})},null,4),n("div",{class:"floating-window",style:Y({"z-index":o.zIndex})},[n("div",xa,[n("label",null,P(e.title),1),n("button",{class:"close-button",onClick:i},Pa)]),n("div",{class:"window-content scrollable",style:Y({margin:e.compact?"0px":"15px",marginTop:e.compact?"0px":"5px"})},[me(o.$slots,"default",{},void 0,!0)],4)],4)])):z("",!0)}}),De=M(Ia,[["__scopeId","data-v-97dd0391"]]),La={id:"query-dialog-main"},Ua={class:"content"},Ra={id:"buttons"},Aa=q({__name:"QueryDialog",props:{show:{type:Boolean},title:{default:"Query"},showCancel:{type:Boolean,default:!0},zIndex:{default:99}},emits:["update:show","onClose","onAccept","onCancel"],setup(r,{emit:t}){const e=r,a=t,s=T({get:()=>e.show,set:i=>{a("update:show",i)}});return(i,o)=>(y(),G(De,{show:s.value,"onUpdate:show":o[2]||(o[2]=c=>s.value=c),title:i.title,compact:!0,"z-index":i.zIndex,onOnClose:o[3]||(o[3]=()=>a("onClose"))},{default:B(()=>[n("div",La,[n("div",Ua,[me(i.$slots,"default",{},void 0,!0)]),n("div",Ra,[n("div",{class:"button ok-button",onClick:o[0]||(o[0]=()=>a("onAccept"))},"OK"),i.showCancel?(y(),k("div",{key:0,class:"button cancel-button last-button",onClick:o[1]||(o[1]=()=>a("onCancel"))},"Cancel")):z("",!0)])])]),_:3},8,["show","title","z-index"]))}}),he=M(Aa,[["__scopeId","data-v-81948a9f"]]),Ba=r=>(ee("data-v-1d8f6d0c"),r=r(),te(),r),qa={id:"tag-selector-with-entry-main"},Oa={style:{textAlign:"left"}},Ea=Ba(()=>n("label",{for:"tagSelector"},"Tags",-1)),Ma={id:"tagSelector",class:"scrollable"},Fa={class:"entry"},za=q({__name:"TagSelectorWithEntry",props:{tagStatus:{},tagInputValue:{default:""}},emits:["update:tagStatus","update:tagInputValue"],setup(r,{emit:t}){const e=r,a=t,s=T({get:()=>e.tagStatus,set:l=>a("update:tagStatus",l)}),i=_(e.tagInputValue);ne(()=>e.tagInputValue,l=>{i.value=l});const o=T({get:()=>i.value,set:l=>{a("update:tagInputValue",l),i.value=l}}),c=()=>{const l=o.value.trim();l!==""&&(s.value.all.add(l),s.value.checked.add(l),s.value.unfolded.union_(we.allParentsOf(l)),o.value="")};return(l,f)=>(y(),k("div",qa,[n("div",Oa,[Ea,n("div",Ma,[C(rt,{tagStatus:s.value,"onUpdate:tagStatus":f[0]||(f[0]=g=>s.value=g)},null,8,["tagStatus"])])]),n("div",Fa,[W(n("input",{type:"text",placeholder:"New tag","onUpdate:modelValue":f[1]||(f[1]=g=>o.value=g),onKeyup:Oe(c,["enter"])},null,544),[[J,o.value]]),n("button",{class:ve(`green${o.value?" to-be-confirmed":""}`),onClick:c},"ADD",2)])]))}}),lt=M(za,[["__scopeId","data-v-1d8f6d0c"]]);async function Na(r=10,t="cat:cs.AI OR cat:cs.CV",e="submittedDate",a="descending"){const i=`https://export.arxiv.org/api/query?${`search_query=${encodeURIComponent(t)}&sortBy=${e}&sortOrder=${a}&max_results=${r}`}`,c=await(await fetch(i,{method:"GET"})).text();let g=new at.XMLParser().parse(c).feed.entry;Array.isArray(g)||(g=[g]);function d(u){return Array.isArray(u.author)?u.author.map(h=>h.name):u.author?[u.author.name]:[]}if(g&&Array.isArray(g))return g.map(h=>{const m=h.id.split("/").pop().split("v")[0],p=h.id,v=h.title,w=h.summary,b=d(h),S=h.updated,D=h.published;return{id:m,link:p,title:v,abstract:w,authors:b,updatedTime:S,publishedTime:D}});throw new Error("Invalid feed data")}async function Ha(r){const t=`https://export.arxiv.org/api/query?id_list=${r}`,a=await(await fetch(t,{method:"GET"})).text();let o=new at.XMLParser().parse(a).feed.entry;function c(l){return Array.isArray(l.author)?l.author.map(f=>f.name):l.author?[l.author.name]:[]}if(o){const l=o.id.split("/").pop().split("v")[0],f=o.id,g=o.title,d=o.summary,u=c(o),h=o.updated,m=o.published;return{id:l,link:f,title:g,abstract:d,authors:u,updatedTime:h,publishedTime:m}}else throw new Error("Failed to fetch paper from arxiv")}function ut(r){return`@article{${r.id},
  author = {${r.authors.join(" and ")}},
  title = {${r.title}},
  journal = {arXiv preprint arXiv:${r.id}},
  year = {${r.publishedTime.split("-")[0]}},
  abstract = {${r.abstract}}
  }`.replace(/  /g,"")}const Ka=r=>{const t=Math.random().toString(36).substring(7);return r=="article"?`@article{${t},
        author = {},
        title = {},
        journal = {},
        year = {${new Date().getFullYear()}},
        abstract = {},
        volume = {},
        number = {},
        pages = {},
        month = {},
        doi = {},
        }`.replace(/  /g,""):r=="inproceedings"?`@inproceedings{${t},
        author = {},
        title = {},
        booktitle = {},
        year = {${new Date().getFullYear()}},
        abstract = {},
        editor = {},
        volume = {},
        number = {},
        series = {},
        pages = {},
        }`.replace(/  /g,""):r=="webpage"?`@misc{${t},
        title = "{}",
        author = "{}",
        year = {${new Date().getFullYear()}},
        url = "{}",
        note = "{}"
        }`.replace(/  /g,""):""};class Wa{async fromArxiv(t){let e=t.toLowerCase();e.startsWith("arxiv:")?e=e.split("arxiv:")[1]:e.includes("arxiv.org/abs/")?e=e.split("arxiv.org/abs/")[1]:e.includes("arxiv.org/pdf/")&&(e=e.split("arxiv.org/pdf/")[1].split(".pdf")[0]);const a=await Ha(e);return{bibtex:ut(a),url:a.link}}async fromWebpage(t){var l;const a=await(await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(t)}`)).text(),o=(l=new DOMParser().parseFromString(a,"text/html").querySelector("title"))==null?void 0:l.innerText;return{bibtex:`@misc{${t},
            author = {},
            title = {${o}},
            url = {${t}},
            year = {${new Date().getFullYear()}},
            }`.replace(/  /g,""),url:t}}async fromDoi(t){const e=`https://api.crossref.org/works/${t}/transform/application/x-bibtex`;return{bibtex:await(await fetch(e,{method:"GET"})).text(),url:`https://doi.org/${t}`}}}const ge=r=>(ee("data-v-721cd2bf"),r=r(),te(),r),Za={style:{display:"flex",flexDirection:"column",gap:"10px",padding:"10px",width:"100%",height:"100%"}},ja={style:{margin:"10px"}},Va=ge(()=>n("legend",null,"Source",-1)),Ga={class:"bibsource-container"},Ja=ge(()=>n("legend",{for:"bibsource-arxiv"},"arxiv",-1)),Qa={class:"bibsource-container"},Ya=ge(()=>n("legend",{for:"bibsource-doi"},"doi",-1)),Xa={class:"bibsource-container"},en=ge(()=>n("legend",{for:"bibsource-webpage"},"webpage",-1)),tn=["placeholder"],an={key:0},nn={id:"inputDiv"},sn={id:"inputLeft"},on={id:"bibtexArea"},rn={class:"horizontal"},ln=ge(()=>n("label",{for:"bibtex"},"Bibtex",-1)),un={id:"bibtexSource",class:"horizontal"},dn={id:"urlArea"},cn=ge(()=>n("label",{for:"url"},"URL: ",-1)),pn={id:"inputRight"},hn={key:1},mn=ge(()=>n("div",{style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",height:"430px",width:"590px",border:"5px dashed var(--color-border)","border-radius":"10px",margin:"15px"}},[n("div",{style:{"font-size":"20px","font-weight":"bold","margin-bottom":"10px"}},"Drop to insert citation"),n("div",{style:{"font-size":"12px",opacity:"0.5"}},"(only support bibtex/enw/nbib)")],-1)),fn=[mn],vn=q({__name:"DataEditor",props:{datapoint:{},show:{type:Boolean}},emits:["update:show"],setup(r,{emit:t}){const e=r,a=t,s=T({get:()=>e.show,set:N=>a("update:show",N)}),i=O(),o=_(""),c=_(""),l=_({all:new E,checked:new E,unfolded:new E});function f(){let N=null;e.datapoint&&(N=e.datapoint.summary.uuid),s.value=!1,i.showPopup("Saving entry...","info"),new A().editData(N,o.value,Array.from(l.value.checked),c.value).then(I=>{i.showPopup("Saved","success")},()=>i.showPopup("Failed to save","error"))}const g=_("");ne(s,N=>{N&&(e.datapoint?o.value=e.datapoint.summary.bibtex:o.value="",e.datapoint?c.value=e.datapoint.summary.url:c.value="",l.value={all:new E(i.tagStatus.all),checked:e.datapoint?new E(e.datapoint.summary.tags):new E(i.tagStatus.checked),unfolded:e.datapoint?new E(e.datapoint.summary.tags).allParents():new E(i.tagStatus.unfolded)},g.value="")});const d=_(!1),u=_("article"),h=T(()=>Ka(u.value)),m=_(!1),p=_("arxiv"),v=new Wa,w={arxiv:N=>v.fromArxiv(N),doi:N=>v.fromDoi(N),webpage:N=>v.fromWebpage(N)},b={arxiv:"e.g. 2106.00001",doi:"e.g. 10.1145/344779.344937",webpage:"e.g. https://news.mit.edu/2021/xxx"},S=_("");function D(N){i.showPopup("Fetching from BibTeX source...","info"),m.value=!1,S.value="",w[p.value](N).then(I=>{i.showPopup("Obtained bibtex from source","success"),o.value=I.bibtex,c.value=I.url},()=>{i.showPopup("Failed to fetch from source","error")})}const $=_(!1),L=_(null),R=N=>{N.preventDefault(),$.value=!0},j=N=>{N.preventDefault(),$.value=!1},ue=N=>{var F;N.preventDefault();const I=(F=N.dataTransfer)==null?void 0:F.files;if(I&&I.length>0){const de=I[0];if(de.size<64*1024){const We=new FileReader;We.onload=vt=>{var Ze;const gt=(Ze=vt.target)==null?void 0:Ze.result;o.value=gt},We.readAsText(de)}else i.showPopup("File too large","error")}};return ne(s,N=>{N?(window.addEventListener("dragover",R),window.addEventListener("drop",ue),window.addEventListener("dragleave",j)):($.value=!1,window.removeEventListener("dragover",R),window.removeEventListener("drop",ue),window.removeEventListener("dragleave",j))}),(N,I)=>(y(),k(H,null,[C(he,{show:d.value,"onUpdate:show":I[3]||(I[3]=F=>d.value=F),onOnAccept:I[4]||(I[4]=()=>{o.value=h.value,d.value=!1}),onOnCancel:I[5]||(I[5]=F=>d.value=!1),"z-index":102,title:"Select template"},{default:B(()=>[n("div",Za,[C(pe,{onOnCheck:I[0]||(I[0]=F=>u.value="article"),checked:u.value=="article"},{default:B(()=>[U("Article")]),_:1},8,["checked"]),C(pe,{onOnCheck:I[1]||(I[1]=F=>u.value="inproceedings"),checked:u.value=="inproceedings"},{default:B(()=>[U("Inproceedings")]),_:1},8,["checked"]),C(pe,{onOnCheck:I[2]||(I[2]=F=>u.value="webpage"),checked:u.value=="webpage"},{default:B(()=>[U("Webpage")]),_:1},8,["checked"])])]),_:1},8,["show"]),C(he,{show:m.value,"onUpdate:show":I[10]||(I[10]=F=>m.value=F),onOnCancel:I[11]||(I[11]=F=>m.value=!1),onOnAccept:I[12]||(I[12]=()=>{D(S.value)}),"z-index":102,title:"Source input"},{default:B(()=>[n("div",ja,[n("fieldset",{style:Y({display:"flex",flexDirection:"row",gap:"10px",border:"1px solid var(--color-border)"})},[Va,n("div",Ga,[W(n("input",{type:"radio",id:"bibsource-arxiv",name:"bibSource",value:"arxiv","onUpdate:modelValue":I[6]||(I[6]=F=>p.value=F)},null,512),[[Re,p.value]]),Ja]),n("div",Qa,[W(n("input",{type:"radio",id:"bibsource-doi",name:"bibSource",value:"doi","onUpdate:modelValue":I[7]||(I[7]=F=>p.value=F)},null,512),[[Re,p.value]]),Ya]),n("div",Xa,[W(n("input",{type:"radio",id:"bibsource-webpage",name:"bibSource",value:"webpage","onUpdate:modelValue":I[8]||(I[8]=F=>p.value=F)},null,512),[[Re,p.value]]),en])],4),W(n("input",{type:"text","onUpdate:modelValue":I[9]||(I[9]=F=>S.value=F),placeholder:b[p.value],style:{width:"100%",marginTop:"10px"}},null,8,tn),[[J,S.value]])])]),_:1},8,["show"]),C(he,{show:s.value,"onUpdate:show":I[19]||(I[19]=F=>s.value=F),title:N.datapoint?N.datapoint.authorAbbr():"new","show-cancel":!1,onOnAccept:f,onOnCancel:I[20]||(I[20]=()=>s.value=!1)},{default:B(()=>[n("div",{id:"data-editor-main",ref_key:"dataEditorComponent",ref:L},[$.value?(y(),k("div",hn,fn)):(y(),k("div",an,[n("div",nn,[n("div",sn,[n("div",on,[n("div",rn,[ln,n("div",un,[n("div",{class:"button",onClick:I[13]||(I[13]=F=>d.value=!0)},"template"),n("div",{class:"button",onClick:I[14]||(I[14]=F=>m.value=!0)},"from-source")])]),W(n("textarea",{id:"bibtex","onUpdate:modelValue":I[15]||(I[15]=F=>o.value=F),placeholder:"bibtex / enw / nbib"},null,512),[[J,o.value]])]),n("div",dn,[cn,W(n("input",{id:"url","onUpdate:modelValue":I[16]||(I[16]=F=>c.value=F),placeholder:"url",type:"text"},null,512),[[J,c.value]])])]),n("div",pn,[C(lt,{"tag-status":l.value,"onUpdate:tagStatus":I[17]||(I[17]=F=>l.value=F),"tag-input-value":g.value,"onUpdate:tagInputValue":I[18]||(I[18]=F=>g.value=F)},null,8,["tag-status","tag-input-value"])])])]))],512)]),_:1},8,["show","title"])],64))}}),dt=M(vn,[["__scopeId","data-v-721cd2bf"]]),gn={key:0,id:"arrow"},yn=["onKeydown","onClick"],wn=q({__name:"Menu",props:{show:{type:Boolean},menuItems:{},position:{},blocker:{type:Boolean,default:!1},middleTop:{type:Boolean,default:!1},zIndex:{default:100},arrow:{type:Boolean,default:!1}},emits:["update:show"],setup(r,{emit:t}){const e=r,a=t,s=T({get:()=>e.show,set:o=>{a("update:show",o)}});function i(){s.value=!1}return(o,c)=>(y(),k(H,null,[o.blocker?(y(),k("div",{key:0,id:"blocker",onClick:i,style:Y({zIndex:e.zIndex-1})},null,4)):z("",!0),n("div",{id:"floatingMenu",style:Y({left:e.position.x+"px",top:e.position.y+"px",visibility:s.value?"visible":"hidden",transform:e.middleTop?"translate(-50%, 0)":"",zIndex:e.zIndex})},[e.arrow?(y(),k("div",gn)):z("",!0),(y(!0),k(H,null,X(e.menuItems,(l,f)=>(y(),k("div",{class:ve(`non-selectable floatingMenuItem${f!==e.menuItems.length-1?"":" floatingMenuItemLast"}`),tabindex:"0",onKeydown:Oe(g=>{l.action(),i()},["enter"]),onClick:g=>{l.action(),i()}},P(l.name),43,yn))),256))],4)],64))}}),_n=M(wn,[["__scopeId","data-v-c6b659c7"]]),He=q({name:"file-select-button",props:{asLink:{type:Boolean,default:!1},text:{type:String,default:"Upload"},action:{type:Function,required:!0}},setup(r,t){const e=_(null),a=i=>{const o=i.target;if(o.files&&o.files.length>0){const c=o.files[0];r.action(c)}};function s(){e.value.click()}return t.expose({click:s}),()=>C("div",{class:"upload-button",style:"display:flex"},[C("input",{type:"file",id:"upload-file",onChange:a,ref:e,style:{display:"none"}},null),r.asLink?C("a",{class:"btn upload-btn",rel:"noopener noreferrer",onClick:()=>e.value.click()},[r.text]):C("button",{type:"button",class:"btn upload-btn",onClick:()=>e.value.click()},[r.text])])}}),Ke=q({name:"editable-paragraph",props:{contentEditable:{type:Boolean,default:!0},style:{type:Object,default:()=>({})}},emits:["finish","change"],setup(r,t){const e=_(null),a=d=>{e.value.innerText=d},s=d=>{e.value.contentEditable=d.toString()},i=d=>e.value.contains(d),o=function(){return document.activeElement===e.value},c=T({get(){return e.value.innerText},set(d){e.value.innerText=d}});t.expose({setText:a,setEditable:s,contains:i,innerText:c,hasFocus:o});const l=()=>{t.emit("change",e.value.innerText)},f=()=>{t.emit("finish",e.value.innerText)},g=d=>{if(d.key==="Enter")if(d.ctrlKey||d.metaKey){d.preventDefault();const u=window.getSelection(),h=u==null?void 0:u.getRangeAt(0);if(h){const m=document.createElement("br");h.insertNode(m),h.setStartAfter(m),h.setEndAfter(m),u==null||u.removeAllRanges(),u==null||u.addRange(h)}}else e.value.blur()};return()=>C("p",{class:"editable-paragraph",contenteditable:r.contentEditable,ref:e,onInput:l,onBlur:f,onKeydown:g,style:r.style},[t.slots.default&&t.slots.default()])}}),ct=q({name:"menu-attached",props:{menuItems:{type:Array,required:!0}},setup(r,t){const e=_(!1),a=_(null),s=_({x:0,y:0});return ne(e,i=>{if(i){const o=a.value.getBoundingClientRect();s.value={x:o.left+o.width/2,y:o.bottom+5}}else s.value={x:0,y:0}}),()=>C("div",null,[C("div",{ref:a,onClick:()=>e.value=!e.value,onKeydown:i=>{i.key==="Enter"&&(i.preventDefault(),e.value=!e.value)}},[t.slots.default&&t.slots.default()]),C(_n,{show:e.value,"onUpdate:show":i=>e.value=i,menuItems:r.menuItems,position:s.value,middleTop:!0,arrow:!0},null)])}}),bn=q({name:"CircularImage",props:{href:{type:String,required:!0},size:{type:String,required:!0},alt:{type:String,default:""}},emits:["click"],setup(r,t){const e={width:`${r.size}`,height:`${r.size}`,borderRadius:"50%",border:"1px solid var(--color-border)",overflow:"hidden"};return()=>C("img",{src:r.href,alt:r.alt,style:e,onClick:()=>t.emit("click")},null)}}),ye=r=>(ee("data-v-bacf3243"),r=r(),te(),r),kn={class:"layout"},Sn={id:"info"},$n=ye(()=>n("td",null,[n("b",null,"Authors")],-1)),Dn={id:"authorTD"},Cn=["onClick"],xn={key:0,id:"otherPubTR"},Tn={colspan:"2"},Pn={id:"authorPapers"},In=ye(()=>n("td",null,[n("b",null,"Publication")],-1)),Ln=ye(()=>n("td",null,[n("b",null,"Year")],-1)),Un=ye(()=>n("td",null,[n("b",null,"Tags")],-1)),Rn=ye(()=>n("td",null,[n("b",null,"Type")],-1)),An={id:"shortSummary"},Bn={id:"shortSummaryTitle"},qn=ye(()=>n("b",null,"AI Summary",-1)),On=ye(()=>n("summary",null,[n("b",null,"Related Articles")],-1)),En=q({__name:"DataSummary",props:{datapoint:{}},setup(r){const t=r,e=K(),a=_([]),s=_([]),i=T(()=>Object.fromEntries(a.value.map((v,w)=>[v.summary.uuid,s.value[w].toPrecision(3)]))),o=new A,c=_(null),l=_("");function f(v=!1){l.value="Loading...";let w="";o.reqAISummary(t.datapoint.summary.uuid,b=>{b.replace(/\\n/g,"<br>"),w+=b,l.value=w},()=>{g(),console.log("finished")},v)}async function g(){let v=null;if(t.datapoint.supp.abstract?v=t.datapoint.supp.abstract:v=await t.datapoint.fetchAbstract(),!v)if(l.value&&!l.value.startsWith("Error")&&!l.value.startsWith("Loading"))v=l.value;else throw new Error("No content to search for related articles");if(v=="")return;const b=await new A().search("searchFeature",{pattern:v,n_return:9}),S=new Array,D=new Array;for(const $ of e.database.getDataByTags([]))if(b[$.summary.uuid]){S.push($);const L=b[$.summary.uuid].score;D.push(L)}[a.value,s.value]=Me.sortByScore(S,D,!1),a.value&&a.value[0].summary.uuid==t.datapoint.summary.uuid&&(a.value.shift(),s.value.shift())}const d=_(""),u=_([]);function h(v){v=be(v),console.log("check publication of author: ",v),u.value=e.authorPublicationMap[v],u.value=u.value.filter(w=>w.summary.uuid!=t.datapoint.summary.uuid),d.value===v?d.value="":d.value=v}function m(v){const w=e.authorPublicationMap;return v=be(v),!(v in w)||w[v].length==1?null:w[v].length-1}ke(()=>{f(!1)});const p=T(()=>{const D=(Math.min(Math.max(window.innerWidth-600,0)/1800,1)-.5)*Math.PI,$=(Math.sin(D)+1)*.5*1200,L=Math.round($);return`${window.innerWidth-L}px`});return(v,w)=>(y(),k("div",{id:"main",style:Y({width:p.value})},[n("h2",null,P(v.datapoint.summary.title),1),n("div",kn,[n("div",Sn,[n("table",null,[n("tr",null,[$n,n("td",Dn,[(y(!0),k(H,null,X(v.datapoint.summary.authors,b=>(y(),k("div",null,[n("span",null,P(b),1),m(b)!==null?(y(),k("a",{key:0,onClick:()=>h(b)}," ("+P(m(b))+") ",9,Cn)):z("",!0)]))),256))])]),C($e,{name:"slideDown"},{default:B(()=>[d.value?(y(),k("tr",xn,[n("td",Tn,[n("b",null,P(`Other publications from ${d.value.toUpperCase()}:`),1),n("div",Pn,[C(Ce,{datapoints:u.value},null,8,["datapoints"])])])])):z("",!0)]),_:1}),n("tr",null,[In,n("td",null,P(v.datapoint.summary.publication),1)]),n("tr",null,[Ln,n("td",null,P(v.datapoint.summary.year),1)]),n("tr",null,[Un,n("td",null,P(v.datapoint.summary.tags.toString()),1)]),n("tr",null,[Rn,n("td",null,P(v.datapoint.docType()+`${v.datapoint.summary.has_file?" ("+v.datapoint.summary.doc_size.toString()+"M)":""}`),1)])])]),n("div",An,[n("div",Bn,[qn,n("div",{class:"button",onClick:w[0]||(w[0]=b=>f(!0))},"↻")]),n("p",{id:"aiSummary",ref_key:"aiSummaryParagraph",ref:c},P(l.value),513)]),n("details",null,[On,C(Ce,{datapoints:a.value,scores:i.value},null,8,["datapoints","scores"])])])],4))}}),Mn=M(En,[["__scopeId","data-v-bacf3243"]]),Fn=r=>(ee("data-v-688f89ab"),r=r(),te(),r),zn={id:"citations",style:{textAlign:"left"}},Nn=["onClick"],Hn={class:"citation-text",style:{overflowX:"hidden",whiteSpace:"nowrap"}},Kn={key:0},Wn={key:0,id:"moreMain"},Zn={class:"row",id:"buttons"},jn={key:0,class:"row",id:"actions"},Vn={id:"abstract"},Gn=Fn(()=>n("summary",null,"Abstract",-1)),Jn=q({__name:"FileRowMore",props:{datapoint:{},show:{type:Boolean}},setup(r,{expose:t}){const e=r,a=O(),s=_(null),i=async b=>{b.target instanceof HTMLDetailsElement&&!b.target.open||(s.value.setEditable(!1),s.value.innerText="Loading...",e.datapoint.fetchAbstract().then(S=>{s.value.innerText=S,s.value.setEditable(!0)},()=>{s.value.innerText="Failed to load abstract."}))},o=async b=>{b&&(await e.datapoint.uploadAbstract(b),await e.datapoint.update())},c=_(!1);function l(b,S){return[b,`${S.length>80?S.slice(0,80)+"...":S}`,S]}function f(b){Et(b).then(S=>{S?a.showPopup("Copied to clipboard.","info"):a.showPopup("Failed to copy to clipboard.","error")})}const g=_(!1);function d(b){a.showPopup("uploading..."),e.datapoint.uploadDocument(b).then(S=>{e.datapoint.update(S),a.showPopup("Document uploaded","success")},()=>a.showPopup("Failed to upload document","error"))}function u(){window.confirm(`Free document? 
${e.datapoint.toString()}`)&&e.datapoint.freeDocument().then(b=>{e.datapoint.update(b),a.showPopup("Document deleted","info")},()=>a.showPopup("Failed to free document","error"))}function h(){const b=e.datapoint.summary.uuid;window.confirm(`[IMPORTANT] Delete? 
${e.datapoint.toString()}`)&&new A().deleteData(b).then(S=>{a.showPopup("Deleted")})}const m=_(!1);function p(){m.value=!0}const v=T(()=>s.value===null?!m.value:!m.value&&!s.value.hasFocus());t({editThisDatapoint:p,shouldEnableEditDatapoint:v});const w=_(!1);return(b,S)=>{const D=Xe("router-link");return y(),k(H,null,[C(De,{show:w.value,"onUpdate:show":S[0]||(S[0]=$=>w.value=$),title:"Summary"},{default:B(()=>[C(Mn,{datapoint:b.datapoint},null,8,["datapoint"])]),_:1},8,["show"]),C(De,{show:c.value,"onUpdate:show":S[1]||(S[1]=$=>c.value=$),title:"Citations"},{default:B(()=>[(y(!0),k(H,null,X([l("Title",`${b.datapoint.summary.title}`),l("Author-year",`${b.datapoint.authorAbbr()} (${b.datapoint.summary.year})`),l("APA",`${b.datapoint.authorAbbr()} (${b.datapoint.summary.year}). ${b.datapoint.summary.title}. ${b.datapoint.summary.publication}.`),l("Bibtex",b.datapoint.summary.bibtex),l("DocURL",b.datapoint.getRawDocURL()),l("Markdown",`[${b.datapoint.authorAbbr()} (${b.datapoint.summary.year})](${b.datapoint.getRawDocURL()})`)],($,L)=>(y(),k("div",zn,[n("div",{onClick:()=>{f($[2]),c.value=!1},style:{cursor:"pointer",display:"flex",flexDirection:"row"}},[n("div",{class:"citation-type",style:Y({marginLeft:"10px",marginRight:"10px",borderRadius:"5px",backgroundColor:"var(--color-background-mute)",padding:"3px",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center"})},P($[0]),5),n("p",Hn,P($[1]),1)],8,Nn),L!==5?(y(),k("hr",Kn)):z("",!0)]))),256))]),_:1},8,["show"]),C(dt,{show:m.value,"onUpdate:show":S[2]||(S[2]=$=>m.value=$),datapoint:b.datapoint},null,8,["show","datapoint"]),C($e,{name:"expand-transition"},{default:B(()=>[b.show?(y(),k("div",Wn,[n("div",Zn,[C(D,{to:`/reader/${e.datapoint.summary.uuid}`},{default:B(()=>[U("Reader")]),_:1},8,["to"]),n("a",{rel:"noopener noreferrer",onClick:S[3]||(S[3]=()=>w.value=!w.value)},"Summary"),n("a",{rel:"noopener noreferrer",onClick:S[4]||(S[4]=()=>c.value=!c.value)},"Cite"),n("a",{rel:"noopener noreferrer",onClick:S[5]||(S[5]=()=>g.value=!g.value)},"Actions")]),C($e,{name:"actions"},{default:B(()=>[g.value?(y(),k("div",jn,[n("a",{rel:"noopener noreferrer",class:"btn",onClick:p},"Edit"),b.datapoint.summary.has_file?(y(),k("a",{key:1,rel:"noopener noreferrer",onClick:u,class:"danger btn"},"Free document")):(y(),G(x(He),{key:0,action:$=>d($),text:"Upload document","as-link":!0},null,8,["action"])),n("a",{rel:"noopener noreferrer",onClick:h,class:"danger btn"},"Delete")])):z("",!0)]),_:1}),n("div",Vn,[n("details",{onToggle:i},[Gn,C(x(Ke),{id:"abstractParagraph",ref_key:"abstractParagraph",ref:s,style:{minHeight:"20px"},onFinish:S[6]||(S[6]=$=>o($))},null,512)],32)])])):z("",!0)]),_:1})],64)}}}),Qn=M(Jn,[["__scopeId","data-v-688f89ab"]]),Je=[];class V{static registerThemeChangeCallback(t){Je.push(t)}static toggleDarkMode(){document.documentElement.classList.contains("light")?V.setDarkMode(!0):document.documentElement.classList.contains("dark")?V.setDarkMode(!1):(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,V.setDarkMode(!0))}static isDefaultDarkMode(){return!!(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)}static isDarkMode(){return document.documentElement.classList.contains("light")?!1:!!document.documentElement.classList.contains("dark")}static setDefaultDarkMode(){const t=localStorage.getItem("themeMode");t==="dark"?V.setDarkMode(!0):t=="light"?V.setDarkMode(!1):V.isDefaultDarkMode()&&!V.isDarkMode()&&V.toggleDarkMode()}static setDarkMode(t){t?(document.documentElement.classList.remove("light"),document.documentElement.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"));const e=t?"dark":"light";if(localStorage.getItem("themeMode")!==e){localStorage.setItem("themeMode",t?"dark":"light");for(let a of Je)a(t)}}}function Qe(r,t){let e=r.parentNode;for(;e!=null;){if(e==t)return!0;e=e.parentNode}return!1}function Se(r){if(r===null||typeof r!="object")return r;let t=Array.isArray(r)?[]:{};for(let e in r)t[e]=Se(r[e]);return t}const Yn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120v-640q0-33%2023.5-56.5T280-840h400q33%200%2056.5%2023.5T760-760v640L480-240%20200-120Zm80-122%20200-86%20200%2086v-518H280v518Zm0-518h400-400Z'/%3e%3c/svg%3e",Xn="data:image/svg+xml,%3c?xml%20version='1.0'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20width='24px'%20height='24px'%3e%3cpath%20d='M%206%202%20C%205.861875%202%205.7278809%202.0143848%205.5976562%202.0410156%20C%204.686084%202.2274316%204%203.033125%204%204%20L%204%2022%20L%2012%2019%20L%2020%2022%20L%2020%204%20C%2020%203.8625%2019.985742%203.7275391%2019.958984%203.5976562%20C%2019.799199%202.8163086%2019.183691%202.2008008%2018.402344%202.0410156%20C%2018.272119%202.0143848%2018.138125%202%2018%202%20L%206%202%20z'/%3e%3c/svg%3e",es={class:"left row"},ts={id:"marks"},as=["src"],ns=["src"],ss={id:"title",class:"text"},os={class:"right row"},rs={id:"statusDiv"},is={class:"status"},ls={key:0,src:_a,alt:"",class:"icon"},us={key:1,src:Ne,alt:"",class:"icon placeholder"},ds={class:"status"},cs={key:0,src:ba,alt:"",class:"icon"},ps={key:1,src:ka,alt:"",class:"icon"},hs={key:2,src:Ne,alt:"",class:"icon placeholder"},ms={class:"status"},fs={key:0,src:Sa,alt:"",class:"icon"},vs={key:1,src:$a,alt:"",class:"icon"},gs={key:2,src:Ne,alt:"",class:"icon placeholder"},ys=12,ws=1,_s=q({__name:"FileRow",props:{datapoint:{},unfoldedIds:{},hoveredIds:{},line_number:{default:0},compact:{type:Boolean,default:!1}},emits:["update:unfoldedIds","update:hoveredIds"],setup(r,{emit:t}){const e=r,a=t,s=T({get:()=>e.unfoldedIds,set:L=>a("update:unfoldedIds",L)}),i=T({get:()=>e.hoveredIds,set:L=>a("update:hoveredIds",L)}),o=T(()=>s.value.includes(e.datapoint.summary.uuid)),c=_(!1),l=_(null),f=_(null),g=_(null),d=_(null),u=_(null);let h=!1;function m(L){if(Qe(L.target,l.value)){if(L.target.id=="authorYear"){const R=e.datapoint.getOpenDocURL();R!==""&&Ie(R),h=!0}if(!Qe(L.target,g.value)){if(h){h=!1;return}o.value?s.value=s.value.filter(R=>R!==e.datapoint.summary.uuid):s.value=[e.datapoint.summary.uuid]}}}function p(){c.value=!0}function v(){c.value=!1}const w=T(()=>{if(c.value){const R=e.datapoint.docType();return R===""?"_":R}else return e.datapoint.yearAuthor(" :: ")}),b=_(!1);ne(b,L=>{L?i.value.push(e.datapoint.summary.uuid):i.value=i.value.filter(R=>R!==e.datapoint.summary.uuid)});const S=T(()=>b.value?"var(--color-background-theme-highlight)":s.value.includes(e.datapoint.summary.uuid)?"var(--color-background-theme)":!e.compact||e.line_number%2==0?"var(--color-background-ssoft)":"var(--color-background)");function D(L){const R=e.datapoint.summary.tags.slice();L?R.push("* Bookmark"):R.splice(R.indexOf("* Bookmark"),1);const j=e.datapoint.summary.uuid;new A().editData(j,null,R).then(ue=>{e.datapoint.update(ue),O().updateShownData()},()=>O().showPopup("Failed to save","error")),h=!0}function $(L){var R,j;L.code==="Space"&&s.value.includes(e.datapoint.summary.uuid)&&b.value&&document.activeElement===document.body&&(R=d.value)!=null&&R.shouldEnableEditDatapoint&&((j=d.value)==null||j.editThisDatapoint(),L.preventDefault())}return ne(()=>s.value,L=>{L.includes(e.datapoint.summary.uuid)?window.addEventListener("keydown",$):window.removeEventListener("keydown",$)}),(L,R)=>(y(),k("div",{id:"fileRow",class:ve(`${e.compact&&!o.value?" compact":""}${o.value?" unfolded":""}`),onClick:m,onMouseover:R[2]||(R[2]=j=>b.value=!0),onMouseleave:R[3]||(R[3]=j=>b.value=!1),ref_key:"dataCard",ref:l,style:Y({backgroundColor:S.value})},[n("div",{id:"init",class:"row",ref_key:"initDiv",ref:f},[n("div",es,[n("div",{id:"leadingStatus",class:"row",ref_key:"leadingStatus",ref:u},[n("div",{id:"authorYear",class:"row text",onMouseover:p,onMouseleave:v},P(w.value),33),n("div",ts,[L.datapoint.summary.tags.includes("* Bookmark")?(y(),k("img",{key:0,src:x(Xn),alt:"",class:"icon redIcon",onClick:R[0]||(R[0]=()=>D(!1))},null,8,as)):(y(),k("img",{key:1,src:x(Yn),alt:"",class:"icon",onClick:R[1]||(R[1]=()=>D(!0))},null,8,ns))])],512),n("div",ss,P(L.datapoint.summary.title),1),me(L.$slots,"default",{},void 0,!0)]),n("div",os,[n("div",rs,[n("div",is,[L.datapoint.summary.has_abstract?(y(),k("img",ls)):(y(),k("img",us))]),n("div",ds,[L.datapoint.summary.file_type==".pdf"?(y(),k("img",cs)):L.datapoint.summary.url?(y(),k("img",ps)):(y(),k("img",hs))]),n("div",ms,[L.datapoint.summary.note_linecount>ys?(y(),k("img",fs)):L.datapoint.summary.note_linecount>ws?(y(),k("img",vs)):(y(),k("img",gs))])])])],512),n("div",{id:"more",ref_key:"moreDiv",ref:g},[C(Qn,{datapoint:L.datapoint,show:o.value,ref_key:"moreComponent",ref:d},null,8,["datapoint","show"])],512)],38))}}),bs=M(_s,[["__scopeId","data-v-4d7047f6"]]),ks={id:"datacard-container-main"},Ss={key:0,class:"relatedArticleScore"},$s={key:0,id:"datacard-container-footer"},Ds=["disabled"],Cs={style:{"margin-left":"10px","margin-right":"10px",display:"flex",gap:"5px"}},xs=["disabled"],Ts=q({__name:"FileRowContainer",props:{datapoints:{},unfoldedIds:{default:null},hoveredIds:{default:null},scores:{default:null},compact:{type:Boolean,default:!0}},emits:["update:datapoints","update:unfoldedIds","update:hoveredIds"],setup(r,{emit:t}){const e=r,a=t,s=_([]),i=T({get:()=>e.unfoldedIds==null?s.value:e.unfoldedIds,set:w=>{e.unfoldedIds==null?s.value=w:a("update:unfoldedIds",w)}}),o=_([]),c=T({get:()=>e.hoveredIds==null?o.value:e.hoveredIds,set:w=>{e.hoveredIds==null?o.value=w:a("update:hoveredIds",w)}}),l=T({get:()=>e.datapoints,set:w=>a("update:datapoints",w)}),f=_(null),g=_(null),d=_(0),u=_(100),h=T(()=>{const w=d.value*u.value,b=Math.min(w+u.value,l.value.length);return l.value.slice(w,b)}),m=()=>{var w;d.value>=Math.ceil(l.value.length/u.value)-1||(d.value++,g.value.setText(""+(d.value+1)),(w=f.value)==null||w.scrollTo({top:0,behavior:"auto"}))},p=()=>{var w;d.value!=0&&(d.value--,g.value.setText(""+(d.value+1)),(w=f.value)==null||w.scrollTo({top:0,behavior:"auto"}))},v=w=>{const b=w.target;b.scrollTop==0||b.scrollTop+b.clientHeight>=b.scrollHeight};return(w,b)=>(y(),k("div",ks,[n("div",{id:"datacard-container",style:Y({gap:w.compact?"0px":"5px"}),ref_key:"datacardContainer",ref:f,onScroll:v,class:"scrollable"},[(y(!0),k(H,null,X(h.value,(S,D)=>(y(),G(bs,{datapoint:S,"unfolded-ids":i.value,"onUpdate:unfoldedIds":b[0]||(b[0]=$=>i.value=$),"hovered-ids":c.value,"onUpdate:hoveredIds":b[1]||(b[1]=$=>c.value=$),line_number:D,compact:w.compact},{default:B(()=>[e.scores!=null&&e.scores[S.summary.uuid]!=null?(y(),k("label",Ss,P(e.scores[S.summary.uuid]),1)):z("",!0)]),_:2},1032,["datapoint","unfolded-ids","hovered-ids","line_number","compact"]))),256))],36),l.value.length>u.value?(y(),k("div",$s,[n("button",{onClick:p,disabled:d.value==0},"Prev",8,Ds),n("span",Cs,[C(x(Ke),{ref_key:"pageIndicatorEditableParagrah",ref:g,onFinish:b[2]||(b[2]=S=>{/^\d+$/.test(S)&&parseInt(S)>0&&parseInt(S)<=Math.ceil(l.value.length/u.value)&&(d.value=parseInt(S)-1)})},{default:B(()=>[U(P(d.value+1),1)]),_:1},512),U(" / "),n("p",null,P(Math.ceil(l.value.length/u.value)),1)]),n("button",{onClick:m,disabled:d.value>=Math.ceil(l.value.length/u.value)-1},"Next",8,xs)])):z("",!0)]))}}),Ce=M(Ts,[["__scopeId","data-v-aa1ed799"]]),Ps=["title"],Is=["src","alt"],Ls={for:"icon",class:"iconLabel non-selectable"},Us=q({__name:"BannerIcon",props:{iconSrc:{},labelText:{},title:{default:""},shortcut:{default:null}},emits:["onClick","click"],setup(r,{expose:t,emit:e}){const a=r,s=T(()=>a.title+(a.shortcut===null?"":` (${a.shortcut})`)),i=e,o=_(null);t({getBoundingClientRect:()=>{var d;return(d=o.value)==null?void 0:d.getBoundingClientRect()}});function l(){i("onClick"),i("click")}function f(d){if(d===null)return null;const u=d.toLowerCase().split("+");return h=>{u.includes("ctrl")&&!h.ctrlKey||u.includes("alt")&&!h.altKey||u.includes("shift")&&!h.shiftKey||u.includes("meta")&&!h.metaKey||u.includes(h.key.toLowerCase())&&(console.log("shortcut triggered: "+d+" | "+a.labelText),l(),h.preventDefault())}}const g=f(a.shortcut);return qe(()=>{g!==null&&window.addEventListener("keydown",g)}),et(()=>{g!==null&&window.removeEventListener("keydown",g)}),(d,u)=>(y(),k("span",{class:"hoverMaxout105 button non-selecable",onClick:l,onKeydown:Oe(l,["enter"]),tabindex:0,title:`${s.value}`,ref_key:"button",ref:o},[n("img",{id:"icon",class:"icon",src:d.iconSrc,alt:d.labelText.toUpperCase()+"_ICON"},null,8,Is),n("label",Ls,P(d.labelText),1)],40,Ps))}}),re=M(Us,[["__scopeId","data-v-fc643a9e"]]),Rs="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M180%20936q-24%200-42-18t-18-42V276q0-24%2018-42t42-18h291v60H180v600h291v60H180Zm486-185-43-43%20102-102H375v-60h348L621%20444l43-43%20176%20176-174%20174Z'/%3e%3c/svg%3e",As="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='m263-263%20290-143%20143-290-290%20143-143%20290Zm217-177q-17%200-28.5-11.5T440-480q0-17%2011.5-28.5T480-520q17%200%2028.5%2011.5T520-480q0%2017-11.5%2028.5T480-440Zm0%20360q-82%200-155-31.5t-127.5-86Q143-252%20111.5-325T80-480q0-83%2031.5-156t86-127Q252-817%20325-848.5T480-880q83%200%20156%2031.5T763-763q54%2054%2085.5%20127T880-480q0%2082-31.5%20155T763-197.5q-54%2054.5-127%2086T480-80Zm0-60q142%200%20241-99.5T820-480q0-142-99-241t-241-99q-141%200-240.5%2099T140-480q0%20141%2099.5%20240.5T480-140Zm0-340Z'/%3e%3c/svg%3e",Bs="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='m887%20489-23-50-50-23%2050-23%2023-50%2023%2050%2050%2023-50%2023-23%2050ZM760%20314l-35-74-74-35%2074-35%2035-74%2035%2074%2074%2035-74%2035-35%2074ZM360%20976q-34%200-57.5-23.5T279%20895h162q0%2034-23.5%2057.5T360%20976ZM198%20833v-60h324v60H198Zm5-121q-66-43-104.5-107.5T60%20459q0-122%2089-211t211-89q122%200%20211%2089t89%20211q0%2081-38%20145.5T517%20712H203Zm22-60h271q48-32%2076-83t28-110q0-99-70.5-169.5T360%20219q-99%200-169.5%2070.5T120%20459q0%2059%2028%20110t77%2083Zm135%200Z'/%3e%3c/svg%3e",qs="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-200h120v-240h240v240h120v-360L480-740%20240-560v360Zm-80%2080v-480l320-240%20320%20240v480H520v-240h-80v240H160Zm320-350Z'/%3e%3c/svg%3e",Os={class:"button"},Es=q({__name:"Banner",props:{returnHome:{type:Boolean,default:!0}},setup(r){const t=r,e=fe();function a(){zt()}V.setDefaultDarkMode();const s=_(V.isDarkMode()),i=T(function(){return s.value?"LightMode":"DarkMode"});function o(){V.toggleDarkMode(),s.value=!s.value}const c=_(null);let l=0;return window.addEventListener("scroll",function(){const f=window.scrollY||document.documentElement.scrollTop;f<=l||l<10?c.value&&c.value.classList.contains("hidden")&&c.value.classList.remove("hidden"):c.value&&!c.value.classList.contains("hidden")&&c.value.classList.add("hidden"),l=f}),(f,g)=>(y(),k("div",{class:"main-banner shadow",ref_key:"mainDiv",ref:c},[n("div",Os,[t.returnHome?(y(),G(re,{key:0,iconSrc:x(qs),labelText:"Home",shortcut:"ctrl+h",onOnClick:g[0]||(g[0]=()=>{x(e).push("/")}),title:"home"},null,8,["iconSrc"])):(y(),G(re,{key:1,iconSrc:x(Rs),labelText:"Logout",shortcut:"ctrl+q",onOnClick:a,title:"logout"},null,8,["iconSrc"])),C(x(ct),{menuItems:[{name:"Home",action:()=>{x(e).push("/")}},{name:"Dashboard",action:()=>{x(e).push(`/dashboard/${x(K)().user.username}`)}},{name:"Arxiv daily",action:()=>{x(e).push("/feed")}},{name:"About",action:()=>{x(e).push("/about")}}]},{default:B(()=>[C(re,{iconSrc:x(As),labelText:"Explore",shortcut:"ctrl+e",title:"look around"},null,8,["iconSrc"])]),_:1},8,["menuItems"]),C(re,{iconSrc:x(Bs),labelText:i.value,shortcut:"ctrl+t",onOnClick:g[1]||(g[1]=()=>o()),title:"change theme"},null,8,["iconSrc","labelText"])]),me(f.$slots,"default",{},void 0,!0)],512))}}),xe=M(Es,[["__scopeId","data-v-18159abb"]]),Ms="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M453-280h60v-166h167v-60H513v-174h-60v174H280v60h173v166Zm27.266%20200q-82.734%200-155.5-31.5t-127.266-86q-54.5-54.5-86-127.341Q80-397.681%2080-480.5q0-82.819%2031.5-155.659Q143-709%20197.5-763t127.341-85.5Q397.681-880%20480.5-880q82.819%200%20155.659%2031.5Q709-817%20763-763t85.5%20127Q880-563%20880-480.266q0%2082.734-31.5%20155.5T763-197.684q-54%2054.316-127%2086Q563-80%20480.266-80Zm.234-60Q622-140%20721-239.5t99-241Q820-622%20721.188-721%20622.375-820%20480-820q-141%200-240.5%2098.812Q140-622.375%20140-480q0%20141%2099.5%20240.5t241%2099.5Zm-.5-340Z'/%3e%3c/svg%3e",Fs="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M559-97q-18%2018-43.5%2018T472-97L97-472q-10-10-13.5-21T80-516v-304q0-26%2017-43t43-17h304q12%200%2024%203.5t22%2013.5l373%20373q19%2019%2019%2044.5T863-401L559-97Zm-41-41%20304-304-378-378H140v304l378%20378ZM245-664q21%200%2036.5-15.5T297-716q0-21-15.5-36.5T245-768q-21%200-36.5%2015.5T193-716q0%2021%2015.5%2036.5T245-664ZM140-820Z'/%3e%3c/svg%3e",pt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M480-160q-133%200-226.5-93.5T160-480q0-133%2093.5-226.5T480-800q85%200%20149%2034.5T740-671v-129h60v254H546v-60h168q-38-60-97-97t-137-37q-109%200-184.5%2075.5T220-480q0%20109%2075.5%20184.5T480-220q83%200%20152-47.5T728-393h62q-29%20105-115%20169t-195%2064Z'/%3e%3c/svg%3e",zs={class:"loading-popout"},Ns={class:"bar",id:"bar"},Hs=q({__name:"LoadingProgressPopout",props:{text:{default:"Progress: "},perc:{}},setup(r){const t=r,e=T(()=>({width:t.perc*120+"px"}));return(a,s)=>(y(),k("div",zs,[n("label",null,P(t.text),1),n("div",Ns,[n("div",{class:"bar",id:"barCurrent",style:Y(e.value)},null,4)])]))}}),Ks=M(Hs,[["__scopeId","data-v-30a64108"]]),Ws=q({__name:"Plot3d",props:{data:{}},setup(r,{expose:t}){const e=_(null),a=r,s=T(()=>a.data.map(m=>({x:m.x,y:m.y,z:m.z,mode:"markers",type:"scatter3d",hoverinfo:"text",hoverlabel:{bgcolor:"#181818",font:{color:"white"}},text:m.text,marker:{size:3.5,opacity:m.opacity,color:m.color}}))),i={autosize:!0,margin:{l:0,r:0,b:0,t:0},showlegend:!1,scene:{xaxis:{title:"",showticklabels:!1,tickfont:{size:10}},yaxis:{title:"",showticklabels:!1,tickfont:{size:10}},zaxis:{title:"",showticklabels:!1,tickfont:{size:10}}},paper_bgcolor:"#f6f6f6",plot_bgcolor:"#f6f6f6"},o={...i,paper_bgcolor:"#151515",plot_bgcolor:"#151515",font:{color:"white"}},c=_(V.isDarkMode()?"dark":"light");V.registerThemeChangeCallback(()=>{c.value=V.isDarkMode()?"dark":"light",d()});const l=T(()=>c.value==="dark"?o:i),f={modeBarButtonsToRemove:["toImage","sendDataToCloud","resetCameraLastSave3d","resetCameraDefault3d"],displaylogo:!1,responsive:!0};let g=null;function d(){if(!e.value)return;Ae.react(e.value,s.value,l.value,f),e.value.layout.scene&&g&&Ae.relayout(e.value,"scene.camera",g)}return t({update:d}),ke(()=>{Ae.newPlot(e.value,s.value,l.value,f).then(()=>{e.value.on("plotly_relayout",u=>{if(console.log("plotly_relayout",u),!u["scene.camera"])return;const h=u["scene.camera"];g=Se(h)})}),e.value.on("plotly_click",function(u){u.points||console.log("Not clicking on any data.");const h=u.points[0].x,m=u.points[0].y,p=u.points[0].z,v=u.points[0].pointNumber;console.log(`You clicked on ${h}, ${m}, ${p} (point ${v})}`)}),ne(s,()=>{d()})}),(u,h)=>(y(),k("div",{id:"ploty-chart",ref_key:"plotlyChart",ref:e},null,512))}}),Zs=M(Ws,[["__scopeId","data-v-e21cc654"]]),js=r=>(ee("data-v-58a0ba98"),r=r(),te(),r),Vs={id:"main-filtervis"},Gs=["open"],Js=js(()=>n("summary",null,"Visualization",-1)),Qs={id:"plot3dDiv"},Ys={key:0,id:"loadingDiv",class:"full"},Xs={key:1,class:"status"},eo=q({__name:"FilterVis",setup(r){const t=K(),e=_(null),a=O(),s=Z(),i=_(null),o=T(()=>{if(i.value===null)return{};const u=Object.keys(t.database.data),h={};for(const m of u)i.value[m]&&(h[m]=i.value[m]);return h});function c(u,h="rgb(100, 100, 200)"){const m=o.value;if(!m)u=[];else for(let $=u.length-1;$>=0;$--)m[u[$]]===void 0&&u.splice($,1);const p=u.length,v=new Float32Array(p),w=new Float32Array(p),b=new Float32Array(p),S=new Array(p);for(const[$,L]of u.entries()){let R=m[L];if(R==null)throw new Error("uid not found in feats: "+L);v[$]=R[0],w[$]=R[1],b[$]=R[2];const j=t.database.get(L);S[$]=`${j.authorYear()}<br>${j.summary.title}`}let D;if(typeof h=="string")D=h;else if(h instanceof Array)if(typeof h[0]=="string")D=h;else{const $=h,L=Math.max(...$),R=Math.min(...$),j={0:V.isDarkMode()?[50,50,50]:[220,220,220],1:[50,200,150]};D=$.map(N=>{const I=(N-R)/(L-R),F=Array(3);for(let de=0;de<3;de++)F[de]=Math.round(j[0][de]*(1-I)+j[1][de]*I);return`rgb(${F[0]}, ${F[1]}, ${F[2]})`})}else throw new Error("Invalid color type");return{x:v,y:w,z:b,opacity:.75,color:D,text:S}}const l=T(()=>{const u=a.shownDataScores;let h;u?h=c(Se(a.shownDataUIDs),u):h=c(Se(a.shownDataUIDs));const p=Object.keys(t.database.data).filter(b=>a.shownDataUIDs.indexOf(b)==-1),v=c(p,V.isDarkMode()?"rgb(50, 50, 50)":"rgb(220, 220, 220)"),w=c(Se(a.unfoldedDataUIDs),"rgb(255, 0, 0)");return[h,v,w]}),f=T(()=>Object.keys(o.value).length>0);async function g(){i.value=null;const u=(await new A().status()).n_data;let h;u<50?h=-1:u<100?h=5:u<300?h=8:u<500?h=12:h=15,console.log("dataset size: ",u,"perp: ",h),new A().reqDatabaseFeatureTSNE("doc_feature",3,h).then(m=>{i.value=m})}function d(u){u.target instanceof HTMLDetailsElement&&(u.target.open?(s.setShow3DScatterPlot(!0),g()):s.setShow3DScatterPlot(!1))}return(u,h)=>(y(),k("div",Vs,[n("details",{onToggle:d,open:x(s).show3DScatterPlot},[Js,n("div",Qs,[C(Zs,{data:l.value,ref_key:"plot3DRef",ref:e},null,8,["data"]),f.value?z("",!0):(y(),k("div",Ys,[i.value===null?(y(),G(Ue,{key:0})):(y(),k("p",Xs,"Data not ready"))]))])],40,Gs)]))}}),to=M(eo,[["__scopeId","data-v-58a0ba98"]]),ao=r=>(ee("data-v-6ce0f084"),r=r(),te(),r),no={id:"bannerAddons"},so={class:"searchbar"},oo=["value"],ro={id:"main-home",class:"gradIn"},io={class:"horizontal fullHeight"},lo={key:0,id:"left-panel"},uo={id:"right-panel",class:"panel1"},co={class:"fullWidth"},po={class:"scrollable",id:"fileSelector"},ho={key:1,id:"blankPlaceholder"},mo={key:0,style:{"font-size":"xx-large","font-weight":"bold","user-select":"none"}},fo={style:{"font-size":"medium"}},vo=ao(()=>n("br",null,null,-1)),go={name:"Home",inheritAttrs:!1,customOptions:{}},yo=q({...go,setup(r){const t=O(),e=K(),a=Z();window.innerWidth<768&&a.setShowTagPanel(!1);const i=fe().currentRoute.value.query.tags;i!=null&&(t.tagStatus.checked=new E(i.split("&&")),t.tagStatus.unfolded=t.tagStatus.checked.allParents());const o=["general","title","author","note","publication","feature","uuid"],c=_(""),l=_(null);function f(){const h={searchBy:l.value.value,content:c.value};t.searchState=h,console.log(h),t.updateShownData()}const g=st(f,200),d=_(!1);function u(){t.reloadDatabase(),Le().reset()}return(h,m)=>(y(),k(H,null,[C(dt,{datapoint:null,show:d.value,"onUpdate:show":m[0]||(m[0]=p=>d.value=p)},null,8,["show"]),C(xe,{"return-home":!1},{default:B(()=>[n("div",no,[C(re,{iconSrc:x(Ms),labelText:"New",title:"Add new data to database",onClick:m[1]||(m[1]=p=>d.value=!0),shortcut:"ctrl+n"},null,8,["iconSrc"]),C(re,{"icon-src":x(Fs),"label-text":"Tags",title:"Tag utilities",onClick:m[2]||(m[2]=()=>x(a).setShowTagPanel(!x(a).showTagPanel))},null,8,["icon-src"]),C(re,{iconSrc:x(pt),labelText:"Reload",title:"Reload database",onClick:u},null,8,["iconSrc"]),U(" | "),n("div",so,[n("select",{ref_key:"searchSelector",ref:l,name:"search_type",id:"searchType",onChange:f},[(y(),k(H,null,X(o,p=>n("option",{value:p},P(p),9,oo)),64))],544),W(n("input",{id:"searchbar",type:"text","onUpdate:modelValue":m[3]||(m[3]=p=>c.value=p),onInput:m[4]||(m[4]=(...p)=>x(g)&&x(g)(...p)),placeholder:"search"},null,544),[[J,c.value]])])])]),_:1}),n("div",ro,[n("div",io,[C($e,{name:"left-in"},{default:B(()=>[x(a).showTagPanel?(y(),k("div",lo,[C(wa,{onOnCheck:m[5]||(m[5]=()=>x(t).updateShownData())})])):z("",!0)]),_:1}),n("div",uo,[n("div",co,[C(to)]),n("div",po,[x(t).shownDataUIDs.length>0?(y(),G(Ce,{key:0,datapoints:x(e).database.getMany(x(t).shownDataUIDs),unfoldedIds:x(t).unfoldedDataUIDs,"onUpdate:unfoldedIds":m[6]||(m[6]=p=>x(t).unfoldedDataUIDs=p)},null,8,["datapoints","unfoldedIds"])):(y(),k("div",ho,[x(e).database.initialized?(y(),k("p",mo,[U(" Nothing to show "),n("p",fo,[U(" Add your first enty by clicking the "),n("b",null,[n("a",{onClick:m[7]||(m[7]=p=>d.value=!0),style:{cursor:"pointer","border-radius":"5px","padding-inline":"3px","background-color":"var(--color-background-soft)"}},"⊕ New")]),U(" button above."),vo])])):(y(),G(Ue,{key:1}))])),C($e,{name:"fade"},{default:B(()=>[x(e).database.initialized?z("",!0):(y(),G(Ks,{key:0,perc:x(t).databaseLoadingProgress,text:x(t).databaseLoadingStatus.nTotal>=0?`${x(t).databaseLoadingStatus.nCurrent} / ${x(t).databaseLoadingStatus.nTotal}`:"_"},null,8,["perc","text"]))]),_:1})])])])])],64))}}),wo=M(yo,[["__scopeId","data-v-6ce0f084"]]),ht=r=>(ee("data-v-7cd91163"),r=r(),te(),r),_o={id:"authorPapers"},bo={id:"tag-selector"},ko={id:"feed-main",class:"slideInFast"},So={class:"articleBlock"},$o={class:"titleBlock"},Do={class:"titleId"},Co={class:"authors"},xo=ht(()=>n("label",null,"[Authors] ",-1)),To={class:"authorSpan"},Po=["onClick"],Io=["onClick"],Lo={key:1},Uo={class:"actions"},Ro=ht(()=>n("summary",null,"Abstract",-1)),Ao={id:"relatedArticles"},Bo=q({__name:"ArticleBlock",props:{article:{}},setup(r){const t=r,e=K(),a=_(!1),s=_(null),i=T({set:p=>{p&&(s.value={all:new E(O().tagStatus.all),checked:new E,unfolded:new E}),a.value=p},get:()=>a.value});function o(){var w;const p=ut(t.article),v=(w=s.value)==null?void 0:w.checked;new A().editData(null,p,Array.from(v||[]),t.article.link).then(()=>{O().showPopup(`collected ${t.article.id}`,"success")},()=>O().showPopup(`failed to collect ${t.article.id}, check log for details`,"warning"))}function c(p){const v=e.authorPublicationMap;return p=be(p),p in v?v[p].length:null}const l=_(!1),f=_([]);function g(p){p=be(p),console.log("check publication of author: ",p),f.value=e.authorPublicationMap[p],l.value=!0}const d=_([]),u=_([]),h=T(()=>{const p={};for(let v=0;v<d.value.length;v++)p[d.value[v].summary.uuid]=u.value[v].toPrecision(4);return p});function m(){d.value.length>0||new A().search("searchFeature",{pattern:t.article.abstract,n_return:8}).then(p=>{var S;const v=new Array,w=new Array;for(const D of Object.keys(p))v.push((S=p[D])==null?void 0:S.score),w.push(D);const b=Me.sortByScore(w,v);d.value=b[0].map(D=>e.database.get(D)),u.value=b[1]})}return(p,v)=>(y(),k(H,null,[C(De,{show:l.value,"onUpdate:show":v[0]||(v[0]=w=>l.value=w),title:"Publications in the database",onOnClose:v[1]||(v[1]=w=>f.value=[])},{default:B(()=>[n("div",_o,[C(Ce,{datapoints:f.value},null,8,["datapoints"])])]),_:1},8,["show"]),C(he,{show:i.value,"onUpdate:show":v[3]||(v[3]=w=>i.value=w),title:`Adding ${t.article.id}`,onOnAccept:v[4]||(v[4]=()=>{o(),i.value=!1}),onOnCancel:v[5]||(v[5]=()=>i.value=!1)},{default:B(()=>[n("div",bo,[C(lt,{tagStatus:s.value,"onUpdate:tagStatus":v[2]||(v[2]=w=>s.value=w)},null,8,["tagStatus"])])]),_:1},8,["show","title"]),n("div",ko,[n("div",So,[n("div",$o,[n("h2",null,P(t.article.title),1),n("label",Do,P(t.article.id),1)]),n("div",Co,[xo,(y(!0),k(H,null,X(t.article.authors,(w,b)=>(y(),k("span",To,[n("a",{onClick:()=>x(Ie)(`https://arxiv.org/search/?query=${w}&searchtype=author`)},P(w),9,Po),c(w)?(y(),k("a",{key:0,class:"pubCount",onClick:()=>g(w)},P(` (${c(w)})`),9,Io)):z("",!0),b<t.article.authors.length-1?(y(),k("span",Lo,", ")):z("",!0)]))),256))]),n("div",Uo,[n("a",{onClick:v[6]||(v[6]=()=>x(Ie)(`https://arxiv.org/abs/${p.article.id}`))},"Arxiv"),U(" | "),n("a",{onClick:v[7]||(v[7]=()=>x(Ie)(`https://arxiv.org/pdf/${p.article.id}.pdf`))},"PDF"),U(" | "),n("a",{onClick:v[8]||(v[8]=()=>i.value=!0)},"Collect")]),n("p",null,"Published: "+P(t.article.publishedTime),1),n("details",null,[Ro,n("p",null,P(t.article.abstract),1)]),n("details",null,[n("summary",{onClick:m},"Related articles"),n("div",Ao,[C(Ce,{datapoints:d.value,scores:h.value},null,8,["datapoints","scores"])])])])])],64))}}),qo=M(Bo,[["__scopeId","data-v-7cd91163"]]),Te=r=>(ee("data-v-5c5b2886"),r=r(),te(),r),Oo={id:"banner"},Eo={id:"main"},Mo=["src"],Fo={id:"settings"},zo=Te(()=>n("option",{value:"cat:cs.CV OR cat:cs.AI OR stat.ML"},"ALL",-1)),No=Te(()=>n("option",{value:"cat:cs.CV"},"cs.CV",-1)),Ho=Te(()=>n("option",{value:"cat:cs.AI"},"cs.AI",-1)),Ko=Te(()=>n("option",{value:"cat:stat.ML"},"stat.ML",-1)),Wo=[zo,No,Ho,Ko],Zo={key:0,id:"loadingPlaceholder"},jo=Te(()=>n("b",null,"Fetching...",-1)),Vo=q({__name:"Feed",setup(r){const t=new A,e=_("cat:cs.CV OR cat:cs.AI OR stat.ML"),a=_(""),s=_(null),i=_([]),o=T(function(){return[...i.value].sort((p,v)=>{if(s.value===null||!p.features||!v.features)return 0;{const w=p.features,b=v.features,S=s.value,D=w.reduce((L,R,j)=>L+(R-S[j])**2,0),$=b.reduce((L,R,j)=>L+(R-S[j])**2,0);return D-$}})});function c(){if(a.value.trim()===""){s.value=null;return}new A().featurize(a.value).then(m=>{s.value=new Float32Array(m)},()=>{console.log("failed to featurize")})}const l=st(c,100),f=fe();let g=parseInt(f.currentRoute.value.query.maxResults)||100;g>200&&(window.alert("maxResults cannot be larger than 200"),g=200);let d=f.currentRoute.value.query.search||"";d!==""&&(a.value=d);const u=_(null);async function h(){i.value=[];const m=await Na(g,e.value);console.log(`Got ${m.length} entries.`);for(const p of m){const v=p;v.features=_(null),i.value.push(v),t.featurize(p.abstract,!0).then(w=>{v.features.value=new Float32Array(w)},()=>{console.log("failed to featurize: ",p.id)})}c()}return ke(()=>{h().then(()=>u.value.classList.remove("spin"),()=>{u.value.classList.remove("spin"),window.alert("Failed to fetch articles")})}),(m,p)=>(y(),k(H,null,[n("div",Oo,[C(xe,{ref:"banner"},null,512)]),n("div",Eo,[n("h1",null,[U(" Arxiv daily "),n("img",{ref_key:"refreshButton",ref:u,src:x(pt),alt:"",class:"icon spin",title:"refresh the page",onClick:p[0]||(p[0]=v=>{const w=v.target;w.classList.contains("spin")||(w.classList.add("spin"),h().then(()=>w.classList.remove("spin")))})},null,8,Mo)]),n("div",Fo,[W(n("select",{name:"category",id:"category-select","onUpdate:modelValue":p[1]||(p[1]=v=>e.value=v),onChange:h},Wo,544),[[St,e.value]]),W(n("input",{type:"text",placeholder:"Search",onInput:p[2]||(p[2]=(...v)=>x(l)&&x(l)(...v)),"onUpdate:modelValue":p[3]||(p[3]=v=>a.value=v),autocomplete:"off"},null,544),[[J,a.value]])]),o.value.length===0?(y(),k("div",Zo,[jo,C(Ue)])):z("",!0),(y(!0),k(H,null,X(o.value,v=>(y(),G(qo,{article:v},null,8,["article"]))),256))])],64))}}),Go=M(Vo,[["__scopeId","data-v-5c5b2886"]]),mt=r=>(ee("data-v-8f0a3868"),r=r(),te(),r),Jo={class:"main"},Qo={id:"login",class:"slideIn"},Yo={class:"loginLine"},Xo={class:"loginLine"},er=["type"],tr=mt(()=>n("summary",null,"Settings",-1)),ar={id:"settings"},nr=mt(()=>n("label",{for:"backendHostInput"},"Backend: ",-1)),sr={class:"options"},or={key:0,class:"error"},rr=q({__name:"LoginInput",setup(r){const t=_(""),e=_(""),a=_(""),s=_(!0),i=_(!1),o=T(()=>i.value?"text":"password"),c=_("Login"),l=fe(),f=_(""),g=_("");l.isReady().then(()=>{$t(()=>{f.value=Z().backendHost,g.value=Z().backendPort})});function d(){Z().setBackendHost(f.value),Z().setBackendPort(g.value),c.value="Connecting...";const u=Ht(t.value,e.value);new A().authUsr(u).then(m=>{Fe(u,m,s.value),a.value="";const p=l.currentRoute.value.query.from;p?(console.log("Redirecting to",p),l.push(p)):l.push("/"),c.value="Login"},m=>{a.value=m,c.value="Login"})}return(u,h)=>(y(),k("div",Jo,[n("div",Qo,[n("form",null,[n("div",Yo,[W(n("input",{class:"key-input",type:"text",id:"username-input","onUpdate:modelValue":h[0]||(h[0]=m=>t.value=m),placeholder:"Username",autocomplete:"off"},null,512),[[J,t.value]])]),n("div",Xo,[W(n("input",{class:"key-input",type:o.value,id:"password-input","onUpdate:modelValue":h[1]||(h[1]=m=>e.value=m),placeholder:"Password"},null,8,er),[[Dt,e.value]])]),n("details",null,[tr,n("div",ar,[nr,W(n("input",{type:"text",id:"backendHostInput","onUpdate:modelValue":h[2]||(h[2]=m=>f.value=m)},null,512),[[J,f.value]]),U(" : "),W(n("input",{type:"text",id:"port","onUpdate:modelValue":h[3]||(h[3]=m=>g.value=m)},null,512),[[J,g.value]]),n("div",sr,[C(pe,{checked:s.value,onOnCheck:h[4]||(h[4]=()=>{s.value=!s.value})},{default:B(()=>[U("Stay login")]),_:1},8,["checked"]),C(pe,{checked:i.value,onOnCheck:h[5]||(h[5]=()=>{i.value=!i.value})},{default:B(()=>[U("Show key")]),_:1},8,["checked"])])])]),n("button",{type:"submit",onClick:Ct(d,["prevent"])},P(c.value),1)]),a.value?(y(),k("p",or,P(a.value),1)):z("",!0)])]))}}),ir=M(rr,[["__scopeId","data-v-8f0a3868"]]),lr={id:"main"},ur={id:"container"},dr={for:"login",id:"info"},cr=["href"],pr=q({__name:"Login",setup(r){V.setDefaultDarkMode();function t(){alert(`Not implemented yet. 
Please contact the maintainer for registration.`)}return(e,a)=>(y(),k("div",lr,[n("div",ur,[C(ir),n("label",dr,[U(" Need assistant? - "),n("a",{onClick:t},"Register"),U(" | "),n("a",{href:`mailto:${x(qt).email}`},"Contact me",8,cr)])])]))}}),hr=M(pr,[["__scopeId","data-v-a2e2514f"]]);class mr{constructor(t){oe(this,"router");this.router=t}getURLParams(){const t={},e=this.router.currentRoute.value.query;for(const a in e)t[a]=e[a];return t}setURLParam(t,e){const a=this.getURLParams();a[t]=e,this.router.push({query:a})}updateURLWithParam(t,e){const a=this.getURLParams();return a[t]=e,this.router.resolve({query:a}).href}}function fr(r,{router:t=null,datapoint:e=null}){const a=t?new mr(t):null;return e&&(r=r.replace(new RegExp("./misc/","g"),`${Q()}/img/${e.summary.uuid}\\?fname=`),a&&(window.location.href.includes("/reader/")?r=r.replace(new RegExp("\\$\\{doc\\}#","g"),a.updateURLWithParam("docHashMark","")):r=r.replace(new RegExp("\\$\\{doc\\}#","g"),`${e.getOpenDocURL()}#`))),r}const vr={id:"noteEditor"},gr=q({__name:"NoteEditor",props:{datapoint:{},theme:{default:"light"}},setup(r,{expose:t}){const e=r,a=fe(),s=_(""),i=T(()=>fr(s.value,{router:a,datapoint:e.datapoint})),o=_(null);function c(){e.datapoint.fetchNote().then(d=>{console.log("Note fetched"),s.value=d,d.trim().length>0&&(g.value=!0)},d=>{console.error(d)})}c(),ne(()=>e.datapoint,()=>{c(),console.log("datapoint changed, fetching note")});function l(){e.datapoint.uploadNote(s.value).then(()=>{console.log("Note saved"),O().showPopup("Note saved","success")},d=>{console.error(d),O().showPopup("Failed to save","warning")})}const f=async d=>{e.datapoint.uploadImages(d).then(u=>{console.log("Images uploaded"),u.map(h=>o.value.insert(()=>({targetValue:`![image](${h})`,select:!1,deviationStart:0,deviationEnd:0}))),l()},u=>{console.error(u)})},g=_(!1);return t({preview:g,fetchNote:c}),(d,u)=>(y(),k("div",vr,[n("div",{class:"editor",onDblclick:u[1]||(u[1]=h=>g.value=!1)},[g.value?(y(),G(x(Ut),{key:1,"model-value":i.value,theme:d.theme},null,8,["model-value","theme"])):(y(),G(x(Lt),{key:0,ref_key:"mdEditor",ref:o,modelValue:s.value,"onUpdate:modelValue":u[0]||(u[0]=h=>s.value=h),preview:!1,language:"en-US",theme:d.theme,onOnSave:l,onOnUploadImg:f,toolbars:["bold","underline","italic","-","strikeThrough","title","quote","unorderedList","orderedList","task","-","link","-","revoke","next","save","=","catalog"]},null,8,["modelValue","theme"]))],32)]))}}),yr=M(gr,[["__scopeId","data-v-d1883f51"]]),wr={id:"body"},_r=["src"],br=q({__name:"ReaderBody",props:{datapoint:{},layoutType:{}},setup(r,{expose:t}){const e=r,a=fe(),s=T(()=>{const b=a.currentRoute.value.query.docHashMark;return b||""}),i=_(null),o=_(null),c=_(null),l=_(!1),f=_(null);t({noteEditor:f});function g(w){c.value&&c.value.contains(w.target)&&(l.value=!0)}function d(){l.value=!1}const u=T({get:()=>O().preferredReaderLeftPanelWidthPerc,set:w=>{O().preferredReaderLeftPanelWidthPerc=w}});function h(w){if(l.value&&i.value&&o.value&&c.value){const S=("touches"in w?w.touches[0].clientX:w.clientX)-i.value.getBoundingClientRect().left;i.value.style.width=`${S}px`,o.value.style.width=`calc(100% - ${S}px)`,u.value=S/(S+o.value.getBoundingClientRect().width),u.value=Math.max(.1,Math.min(.9,u.value))}}window.addEventListener("mousedown",g),window.addEventListener("touchstart",g),window.addEventListener("mouseup",d),window.addEventListener("touchend",d),window.addEventListener("mousemove",h),window.addEventListener("touchmove",h);function m(w){w==0?(i.value.style.width="100%",o.value.style.width="0%"):w==1?(i.value.style.width="0%",o.value.style.width="100%"):w==2&&(i.value.style.width=`${u.value*100}%`,o.value.style.width=`${(1-u.value)*100}%`),Z().setReaderLayoutType(w)}ne(()=>e.layoutType,(w,b)=>{console.log("layoutType changed:",b,"->",w),m(w)});const p=_(V.isDarkMode()?"dark":"light");V.registerThemeChangeCallback(()=>p.value=V.isDarkMode()?"dark":"light");const v=T(()=>`${e.datapoint.getOpenDocURL({extraPDFViewerParams:{"color-mode":p.value},urlHashMark:s.value})}`);return ke(()=>{m(e.layoutType)}),(w,b)=>(y(),k("div",wr,[n("div",{class:"pane",id:"left-pane",ref_key:"leftPane",ref:i},[n("iframe",{src:v.value,title:"doc",frameborder:"0",style:Y({"pointer-events":l.value?"none":"auto"})},null,12,_r)],512),w.layoutType==2?(y(),k("div",{key:0,id:"splitter",ref_key:"splitter",ref:c,onMousedown:g,onTouchstart:g},null,544)):z("",!0),n("div",{class:"pane",id:"right-pane",ref_key:"rightPane",ref:o},[C(yr,{datapoint:w.datapoint,theme:p.value,ref_key:"noteEditor",ref:f},null,8,["datapoint","theme"])],512)]))}}),kr=M(br,[["__scopeId","data-v-312e7b1f"]]),Sr="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M180-120q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H180Zm390%200q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H570Zm210-660H570v600h210v-600ZM570-180h210-210Z'/%3e%3c/svg%3e",$r="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M220-160q-24%200-42-18t-18-42v-143h60v143h520v-143h60v143q0%2024-18%2042t-42%2018H220Zm230-153v-371L330-564l-43-43%20193-193%20193%20193-43%2043-120-120v371h-60Z'/%3e%3c/svg%3e",Dr="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M480.118-330Q551-330%20600.5-379.618q49.5-49.617%2049.5-120.5Q650-571%20600.382-620.5q-49.617-49.5-120.5-49.5Q409-670%20359.5-620.382q-49.5%2049.617-49.5%20120.5Q310-429%20359.618-379.5q49.617%2049.5%20120.5%2049.5Zm-.353-58Q433-388%20400.5-420.735q-32.5-32.736-32.5-79.5Q368-547%20400.735-579.5q32.736-32.5%2079.5-32.5Q527-612%20559.5-579.265q32.5%2032.736%2032.5%2079.5Q592-453%20559.265-420.5q-32.736%2032.5-79.5%2032.5ZM480-200q-146%200-264-83T40-500q58-134%20176-217t264-83q146%200%20264%2083t176%20217q-58%20134-176%20217t-264%2083Zm0-300Zm-.169%20240Q601-260%20702.5-325.5%20804-391%20857-500q-53-109-154.331-174.5-101.332-65.5-222.5-65.5Q359-740%20257.5-674.5%20156-609%20102-500q54%20109%20155.331%20174.5%20101.332%2065.5%20222.5%2065.5Z'/%3e%3c/svg%3e",Cr={id:"bannerOps"},xr={id:"recently-read"},Tr={id:"main-reader",class:"gradIn"},Pr={name:"Reader",inheritAttrs:!1,customOptions:{}},Ir=q({...Pr,setup(r){const t=K(),e=O(),a=tt(),s=fe(),i=T(()=>a.params.id),o=_(t.database.get(i.value));ne(()=>a.params.id,()=>{o.value=t.database.get(a.params.id),c()});function c(){e.addRecentlyReadDataUID(i.value)}c();const l=T(()=>{const w=[];for(const b of e.recentlyReadDataUIDs){if(b===a.params.id)continue;const S=t.database.get(b);w.push({name:S.authorYear(),action:()=>{s.push("/reader/"+b)}})}return w}),f=_(Z().readerLayoutType);window.innerWidth<800&&(f.value=0);function g(){if(window.innerWidth<800)f.value=(f.value+1)%2;else switch(f.value){case 0:f.value=2;break;case 1:f.value=2;break;case 2:f.value=0;break}}const d=_(null);function u(w){function b(){o.value.uploadDocument(w).then(S=>{o.value.update(S),e.showPopup("Document uploaded","success")},()=>e.showPopup("Failed to upload document","error"))}o.value.summary.has_file?o.value.freeDocument().then(S=>{o.value.update(S),b()},()=>e.showPopup("Failed to free document","error")):b()}const h=_(null),m=T(()=>{try{return h.value.noteEditor.preview}catch{return!1}}),p=T(()=>m.value?"edit":"preview");function v(){h.value.noteEditor.preview=!h.value.noteEditor.preview}return ke(()=>{if(Object.keys(t.database.data).length===0){O().showPopup("Database not loaded or empty database.","alert");const w=setInterval(()=>{O().showPopup("Trying to update datapoint...","warning",2e3),Object.keys(t.database.data).length!==0&&(clearInterval(w),o.value=t.database.get(i.value),O().showPopup("Datapoint updated.","success",3e3))},750)}}),(w,b)=>(y(),k(H,null,[C(x(He),{action:u,ref_key:"fileSelectionBtn",ref:d,style:{display:"none"}},null,512),C(xe,null,{default:B(()=>[n("div",Cr,[C(re,{iconSrc:x(Sr),labelText:"layout",shortcut:"ctrl+r",onOnClick:g,title:"change layout"},null,8,["iconSrc"]),C(re,{iconSrc:x($r),labelText:"upload",shortcut:"ctrl+u",onOnClick:b[0]||(b[0]=()=>d.value.click()),title:"upload a new document"},null,8,["iconSrc"]),C(re,{iconSrc:x(Dr),labelText:p.value,shortcut:"ctrl+p",onOnClick:v,title:"preview or edit markdown note"},null,8,["iconSrc","labelText"]),C(x(ct),{"menu-items":l.value},{default:B(()=>[n("div",xr,P(`${o.value.authorAbbr()} (${o.value.summary.year})`),1)]),_:1},8,["menu-items"])])]),_:1}),n("div",Tr,[C(kr,{datapoint:o.value,layoutType:f.value,ref_key:"readerBody",ref:h},null,8,["datapoint","layoutType"])])],64))}}),Lr=M(Ir,[["__scopeId","data-v-6e064c89"]]),ie=r=>(ee("data-v-470d7ba6"),r=r(),te(),r),Ur={class:"banner"},Rr={id:"about-main",class:"slideIn"},Ar=ie(()=>n("h1",null,"About",-1)),Br={id:"about-div",class:"content"},qr=ie(()=>n("br",null,null,-1)),Or=ie(()=>n("a",{href:"https://github.com/MenxLi/Lires",target:"_blank"},"GitHub - MenxLi/Lires",-1)),Er=ie(()=>n("br",null,null,-1)),Mr=["href"],Fr=ie(()=>n("b",null,"Server status: ",-1)),zr=ie(()=>n("b",null,"Backend",-1)),Nr=ie(()=>n("b",null,"Version",-1)),Hr=ie(()=>n("b",null,"Uptime",-1)),Kr=ie(()=>n("b",null,"Number of documents",-1)),Wr=ie(()=>n("b",null,"Number of connections",-1)),Zr={id:"versionHistory",class:"content"},jr={class:"block"},Vr={key:0},Gr={key:1},Jr=q({__name:"About",setup(r){const t=_([]),e=_(!1),a=()=>{new A().changelog().then(f=>{t.value=f},f=>{console.error(f)})},s=_(-1),i=T(()=>{if(s.value===-1)return"N/A";const f=Math.floor(s.value/3600),g=Math.floor((s.value-f*3600)/60),d=Math.floor(s.value-f*3600-g*60);return`${f}h ${g}m ${d}s`}),o=_({backend:Q(),version:"",uptime:i,_uptime:-1,numDocs:-1,numConnections:-1}),c=()=>{new A().status().then(f=>{s.value=f.uptime,o.value.version=f.version,o.value.numDocs=f.n_data,o.value.numConnections=f.n_connections},f=>{console.error(f)})},l=T(()=>t.value.slice().reverse());return a(),c(),window.setInterval(()=>s.value++,1e3),ae("login",()=>o.value.numConnections++),ae("logout",()=>o.value.numConnections--),(f,g)=>(y(),k(H,null,[n("div",Ur,[C(xe)]),n("div",Rr,[Ar,n("div",Br,[n("p",null,[U(" Lires is a self-hosted web application for research literature management. "),qr,U(" It is open source and available at "),Or,U(". "),Er,U(" The user manual is available at "),n("a",{href:x(Bt),target:"_blank"},"here",8,Mr),U(". ")]),n("p",null,[Fr,n("ul",null,[n("li",null,[zr,U(": "+P(o.value.backend),1)]),n("li",null,[Nr,U(": "+P(o.value.version),1)]),n("li",null,[Hr,U(": "+P(o.value.uptime),1)]),n("li",null,[Kr,U(": "+P(o.value.numDocs),1)]),n("li",null,[Wr,U(": "+P(o.value.numConnections),1)])])]),n("a",{onClick:g[0]||(g[0]=d=>e.value=!0),style:{cursor:"pointer"}},"View change log")]),C(De,{show:e.value,"onUpdate:show":g[1]||(g[1]=d=>e.value=d),title:"Change log"},{default:B(()=>[n("div",Zr,[(y(!0),k(H,null,X(l.value.length,d=>(y(),k("div",jr,[n("h2",null,P(l.value[d-1][0].toString()),1),n("ul",null,[(y(!0),k(H,null,X(l.value[d-1][1],u=>(y(),k("li",null,[typeof u=="string"?(y(),k("div",Vr,P(u),1)):typeof u=="object"?(y(),k("div",Gr,[U(P(Object.keys(u)[0])+" ",1),n("ul",null,[(y(!0),k(H,null,X(u[Object.keys(u)[0]],h=>(y(),k("li",null,P(h),1))),256))])])):z("",!0)]))),256))])]))),256))])]),_:1},8,["show"])])],64))}}),Qr=M(Jr,[["__scopeId","data-v-470d7ba6"]]),Yr={},Xr={id:"widget-container-main"};function ei(r,t){return y(),k("div",Xr,[me(r.$slots,"default",{},void 0,!0)])}const Ye=M(Yr,[["render",ei],["__scopeId","data-v-257ac3c4"]]),ti="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120q-33%200-56.5-23.5T120-200v-560q0-33%2023.5-56.5T200-840h357l-80%2080H200v560h560v-278l80-80v358q0%2033-23.5%2056.5T760-120H200Zm280-360ZM360-360v-170l367-367q12-12%2027-18t30-6q16%200%2030.5%206t26.5%2018l56%2057q11%2012%2017%2026.5t6%2029.5q0%2015-5.5%2029.5T897-728L530-360H360Zm481-424-56-56%2056%2056ZM440-440h56l232-232-28-28-29-28-231%20231v57Zm260-260-29-28%2029%2028%2028%2028-28-28Z'/%3e%3c/svg%3e",ft=r=>(ee("data-v-03f9714f"),r=r(),te(),r),ai={id:"usercard-main"},ni={id:"user-settings"},si=ft(()=>n("hr",null,null,-1)),oi=ft(()=>n("summary",null,"Change password",-1)),ri={id:"password-container"},ii={id:"info"},li={id:"user-desc"},ui={id:"name-edit"},di={id:"name"},ci=["src"],pi={key:0,class:"admin_hint"},hi={id:"backendurl"},mi=q({__name:"UserCard",props:{userInfo:{}},emits:["update:userInfo"],setup(r,{emit:t}){const e=r,a=t,s=T(()=>K().user.id===e.userInfo.id),i=_(null),o=T(()=>(console.log("avatarURL updated"),`${Q()}/user-avatar/${e.userInfo.username}?t=${Date.now()}&size=256`));function c(m){if(!m.type.startsWith("image/")){O().showPopup("Please select an image file","error");return}O().showPopup("Uploading avatar..."),new A().uploadUserAvatar(e.userInfo.username,m).then(p=>{a("update:userInfo",p)},p=>{O().showPopup(p,"error")})}const l=_(!1),f=_(""),g=_(""),d=_(""),u=_("");function h(){if(f.value===""||f.value===e.userInfo.name||f.value!==e.userInfo.name&&new A().updateUserNickname(f.value).then(m=>{a("update:userInfo",m),l.value=!1},m=>{O().showPopup(m,"error")}),d.value!==""||u.value!==""){if(d.value===""){O().showPopup("Please enter the new password","error");return}if(d.value!==u.value){O().showPopup("The new passwords do not match","error");return}if(Z().encKey!==ce(e.userInfo.username+ce(g.value))){O().showPopup("The old password is incorrect","error");return}new A().updateUserPassword(d.value).then(m=>{const p=ce(e.userInfo.username+d.value);Z().setEncKey(p,!0),g.value="",d.value="",u.value="",l.value=!1},m=>{O().showPopup(m,"error")})}}return(m,p)=>(y(),k("div",ai,[C(he,{show:l.value,"onUpdate:show":p[4]||(p[4]=v=>l.value=v),title:"User settings",onOnCancel:p[5]||(p[5]=v=>l.value=!1),onOnAccept:h},{default:B(()=>[n("div",ni,[n("b",null,P(e.userInfo.username),1),W(n("input",{type:"text","onUpdate:modelValue":p[0]||(p[0]=v=>f.value=v),placeholder:"Nickname",class:"input"},null,512),[[J,f.value]]),si,n("details",null,[oi,n("div",ri,[W(n("input",{type:"password","onUpdate:modelValue":p[1]||(p[1]=v=>g.value=v),placeholder:"Old password",class:"input"},null,512),[[J,g.value]]),W(n("input",{type:"password","onUpdate:modelValue":p[2]||(p[2]=v=>d.value=v),placeholder:"New password",class:"input"},null,512),[[J,d.value]]),W(n("input",{type:"password","onUpdate:modelValue":p[3]||(p[3]=v=>u.value=v),placeholder:"Confirm new password",class:"input"},null,512),[[J,u.value]])])])])]),_:1},8,["show"]),n("div",ii,[n("div",{id:"avatar",style:Y(s.value?{cursor:"pointer",borderRadius:"50%"}:{})},[C(x(bn),{href:o.value,size:"168px",onClick:p[6]||(p[6]=v=>{var w;return s.value?(w=i.value)==null?void 0:w.click():()=>{}})},null,8,["href"]),C(x(He),{text:"Change avatar",action:c,ref_key:"avatarUploadBtn",ref:i,style:{display:"none"}},null,512)],4),n("div",li,[n("div",ui,[n("h1",di,P(e.userInfo.name),1),s.value?(y(),k("img",{key:0,src:x(ti),alt:"",class:"icon",id:"edit-settings-icon",onClick:p[7]||(p[7]=v=>l.value=!0)},null,8,ci)):z("",!0)]),n("p",null,[U(P(e.userInfo.username)+" ",1),e.userInfo.is_admin?(y(),k("label",pi,"admin")):z("",!0)]),n("p",hi,P(x(Q)()),1)])])]))}}),fi=M(mi,[["__scopeId","data-v-03f9714f"]]),vi="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M160-400v-80h280v80H160Zm0-160v-80h440v80H160Zm0-160v-80h440v80H160Zm360%20560v-123l221-220q9-9%2020-13t22-4q12%200%2023%204.5t20%2013.5l37%2037q8%209%2012.5%2020t4.5%2022q0%2011-4%2022.5T863-380L643-160H520Zm300-263-37-37%2037%2037ZM580-220h38l121-122-18-19-19-18-122%20121v38Zm141-141-19-18%2037%2037-18-19Z'/%3e%3c/svg%3e",le=r=>(ee("data-v-2a0c8094"),r=r(),te(),r),gi={id:"users-widget-main"},yi={id:"user-editor-main"},wi={class:"horizontal"},_i=["src"],bi={id:"user-editor"},ki={class:"horizontal"},Si={class:"horizonal"},$i={class:"full-width left-align"},Di=le(()=>n("b",null,"Mandatory Tags:",-1)),Ci={id:"delete-user-dialog-main"},xi={id:"create-user-table"},Ti=le(()=>n("td",null,"Username:",-1)),Pi=le(()=>n("td",null,"Name:",-1)),Ii=le(()=>n("td",null,"Password:",-1)),Li=le(()=>n("td",null,"Mandatory Tags:",-1)),Ui={colspan:"2"},Ri={id:"user-widget-header"},Ai=le(()=>n("div",null,[n("b",null," Users ")],-1)),Bi={key:0},qi=le(()=>n("th",null," Avatar ",-1)),Oi=le(()=>n("th",null," Username ",-1)),Ei=le(()=>n("th",null," Name ",-1)),Mi=le(()=>n("th",null," Accessibility ",-1)),Fi={class:"user-line"},zi={key:0},Ni=["onClick"],Hi=["src"],Ki={class:"center full-width full-height"},Wi=["src"],Zi={class:"username"},ji={key:1,class:"admin_hint"},Vi={key:0,colspan:"5"},Gi=q({__name:"UsersWidget",setup(r){const t=_([]),e=T(()=>K().user.is_admin),a=_(!1),s=_({});function i(S){if(!e.value)return;const D=JSON.parse(JSON.stringify(S));s.value=D,a.value=!0}function o(S){const D=S.split(";").map($=>$.trim());D.length===1&&D[0]===""?s.value.mandatory_tags=[]:s.value.mandatory_tags=D}function c(){console.log(s.value),new A().setUserAccess(s.value.username,s.value.is_admin,s.value.mandatory_tags).then(S=>{a.value=!1},S=>{console.log(S),O().showPopup(S,"error")})}const l=_(!1),f=_("");function g(){if(f.value!==s.value.username){O().showPopup("Wrong input","error");return}new A().deleteUser(s.value.username).then(S=>{O().showPopup(`User ${s.value.username} deleted`,"info"),l.value=!1,a.value=!1},S=>{console.log(S),O().showPopup(S,"error")})}const d=_(!1),u=_(""),h=_(Pe[Math.floor(Math.random()*Pe.length)]),m=_(""),p=_(!1),v=_("");function w(){d.value=!1,u.value="",h.value=Pe[Math.floor(Math.random()*Pe.length)],m.value="",p.value=!1,v.value=""}function b(){if(u.value===""){O().showPopup("Please enter the username","error");return}const S=v.value.split(";").map(D=>D.trim());S.length===1&&S[0]===""&&S.splice(0,1),new A().createUser(u.value,h.value,m.value,p.value,S).then(D=>{O().showPopup(`User ${u.value} created`,"success"),w()},D=>{console.log(D),O().showPopup(D,"error")})}return ke(()=>{new A().reqUserList().then(S=>{t.value=S},S=>{console.log(S)})}),ae("add_user",S=>{const D=S.user_info;t.value.push(D)}),ae("update_user",S=>{const D=S.user_info;t.value.map(($,L)=>{$.id===D.id&&(t.value[L]=D)})}),ae("delete_user",S=>{const D=S.username;t.value=t.value.filter($=>$.username!==D)}),(S,D)=>(y(),k("div",gi,[C(he,{show:a.value,"onUpdate:show":D[3]||(D[3]=$=>a.value=$),title:"editor",onOnAccept:c,onOnCancel:D[4]||(D[4]=()=>a.value=!1)},{default:B(()=>[n("div",yi,[n("div",wi,[n("img",{src:`${x(Q)()}/user-avatar/${s.value.username}?size=128`,alt:"",class:"avatar-big"},null,8,_i),n("div",bi,[n("div",ki,[n("h2",null,P(s.value.name),1),U(" ("+P(s.value.username)+") ",1)]),n("div",Si,[C(pe,{checked:s.value.is_admin,onOnCheck:D[0]||(D[0]=()=>{s.value.is_admin=!s.value.is_admin})},{default:B(()=>[U(" Administrator")]),_:1},8,["checked"])]),n("div",$i,[Di,n("div",{id:"mandatory-tag-edit",class:ve(s.value.is_admin?"mute":"")},[C(x(Ke),{style:{width:"100%"},"content-editable":!s.value.is_admin,onFinish:D[1]||(D[1]=$=>o($))},{default:B(()=>[U(P(s.value.mandatory_tags.join("; ")),1)]),_:1},8,["content-editable"])],2)])])]),n("input",{id:"delete-user-button",type:"button",value:"Delete user",onClick:D[2]||(D[2]=()=>{l.value=!0})})])]),_:1},8,["show"]),C(he,{show:l.value,"onUpdate:show":D[6]||(D[6]=$=>l.value=$),title:"Delete user",onOnCancel:D[7]||(D[7]=()=>l.value=!1),onOnAccept:g},{default:B(()=>[n("div",Ci,[n("p",null,[U(" Are you sure to delete user "),n("b",null,P(s.value.name)+" ("+P(s.value.username)+")",1),U("? ")]),U(" Type "),n("b",null,P(s.value.username),1),U(" to confirm: "),W(n("input",{type:"text",id:"delete-user-input","onUpdate:modelValue":D[5]||(D[5]=$=>f.value=$),autocomplete:"off"},null,512),[[J,f.value]])])]),_:1},8,["show"]),C(he,{show:d.value,"onUpdate:show":D[13]||(D[13]=$=>d.value=$),onOnCancel:w,onOnAccept:b,onOnClose:w},{default:B(()=>[n("table",xi,[n("tr",null,[Ti,n("td",null,[W(n("input",{type:"text","onUpdate:modelValue":D[8]||(D[8]=$=>u.value=$),autocomplete:"off",class:"create-user-input"},null,512),[[J,u.value]])])]),n("tr",null,[Pi,n("td",null,[W(n("input",{type:"text","onUpdate:modelValue":D[9]||(D[9]=$=>h.value=$),autocomplete:"off",class:"create-user-input"},null,512),[[J,h.value]])])]),n("tr",null,[Ii,n("td",null,[W(n("input",{type:"text","onUpdate:modelValue":D[10]||(D[10]=$=>m.value=$),autocomplete:"off",class:"create-user-input"},null,512),[[J,m.value]])])]),n("tr",null,[Li,n("td",null,[W(n("input",{type:"text","onUpdate:modelValue":D[11]||(D[11]=$=>v.value=$),autocomplete:"off",class:"create-user-input",placeholder:"Separate with semicolon ';'"},null,512),[[J,v.value]])])]),n("tr",null,[n("td",Ui,[C(pe,{checked:p.value,onOnCheck:D[12]||(D[12]=()=>{p.value=!p.value})},{default:B(()=>[U(" Administrator")]),_:1},8,["checked"])])])])]),_:1},8,["show"]),n("div",Ri,[Ai,e.value?(y(),k("div",{key:0,id:"add-user-div",onClick:D[14]||(D[14]=()=>d.value=!0)},"+")):z("",!0)]),n("table",null,[n("tr",null,[e.value?(y(),k("th",Bi)):z("",!0),qi,Oi,Ei,Mi]),(y(!0),k(H,null,X(t.value,$=>(y(),k("tr",Fi,[e.value?(y(),k("td",zi,[n("div",{class:"edit-button",onClick:()=>i($)},[n("img",{src:x(vi),alt:"",class:"icon"},null,8,Hi)],8,Ni)])):z("",!0),n("td",null,[n("div",Ki,[n("img",{src:`${x(Q)()}/user-avatar/${$.username}?size=60`,alt:"",class:"avatar"},null,8,Wi)])]),n("td",Zi,P($.username),1),n("td",null,P($.name),1),n("td",null,[$.is_admin?(y(),k("label",ji,"ADMIN")):(y(),G(it,{key:0,tags:$.mandatory_tags,"max-width":200,"middle-align":!0},null,8,["tags"]))])]))),256)),n("tr",null,[t.value.length===0?(y(),k("td",Vi," No users ")):z("",!0)])])]))}}),Ji=M(Gi,[["__scopeId","data-v-2a0c8094"]]),Qi={id:"main-dashboard",class:"slideIn"},Yi=q({__name:"Dashboard",setup(r){const t=tt(),e=new A,a=T(()=>K().user.id===s.value.id),s=_({id:0,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1});function i(){e.reqUserInfo(t.params.username).then(o=>{s.value=o},o=>{O().showPopup(o,"error")})}return qe(i),window.onhashchange=i,ae("update_user",o=>{o.username===s.value.username&&i()}),(o,c)=>(y(),k(H,null,[C(xe),n("div",Qi,[C(Ye,null,{default:B(()=>[C(fi,{"user-info":s.value},null,8,["user-info"])]),_:1}),C(Ye,null,{default:B(()=>[a.value?(y(),G(Ji,{key:0})):z("",!0)]),_:1})])],64))}}),Xi=M(Yi,[["__scopeId","data-v-0b108cda"]]),el=[{path:"/",component:wo},{path:"/feed",component:Go},{path:"/login",component:hr},{path:"/reader/:id",component:Lr},{path:"/about",component:Qr},{path:"/dashboard/:username",component:Xi}],tl=Pt({history:It(),routes:el}),al=Tt();xt(ta).use(al).use(tl).mount("#app");
