(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9247],{15739:function(e,t,n){"use strict";n.d(t,{Z:function(){return el}});var o,l=n(57437),r=n(2265),a=n(5909),i=n(68447),s=n(45987),u=n(25799),d=n(84920),c=n(99505);let p={TimeStamp:{id:"TimeStamp",label:(0,l.jsx)(s.VE,{className:"w-5 h-5"}),value:"TimeStamp"},TimeInterval:{id:"TimeInterval",label:(0,l.jsx)(s.jE,{className:"w-5 h-5"}),value:"TimeInterval"},BoundingBox:{id:"BoundingBox",label:(0,l.jsx)(s.Iz,{className:"w-5 h-5"}),value:"BoundingBox"},LineString:{id:"LineString",label:(0,l.jsx)(s.yb,{className:"w-5 h-5"}),value:"LineString"}};function m(e){let{isDrawing:t,isDeleting:n,isSelecting:o,isEditing:r,geometryType:a,disabled:m=!1,onDraw:v,onDelete:f,onSelect:g,onSelectGeometryType:y}=e;return m?(0,l.jsx)("div",{className:"flex space-x-2",children:(0,l.jsx)(c.Z,{tooltip:(0,l.jsxs)("div",{className:"inline-flex gap-1",children:["Select",(0,l.jsx)("span",{className:"text-xs",children:(0,l.jsx)(u.Z,{code:"s"})})]}),placement:"bottom",autoPlacement:!1,children:(0,l.jsx)(i.Z,{variant:o?"primary":"secondary",onClick:g,children:(0,l.jsx)(s.GV,{className:"w-5 h-5"})})})}):(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)(c.Z,{tooltip:(0,l.jsxs)("div",{className:"inline-flex gap-1",children:["Create",(0,l.jsx)("span",{className:"text-xs",children:(0,l.jsx)(u.Z,{code:"a"})})]}),placement:"bottom",autoPlacement:!1,children:(0,l.jsx)(i.Z,{variant:t?"primary":"secondary",onClick:v,children:(0,l.jsx)(s.O4,{className:"w-5 h-5"})})}),r?(0,l.jsx)(i.Z,{variant:"warning",onClick:g,children:(0,l.jsx)(s.dY,{className:"w-5 h-5"})}):(0,l.jsx)(c.Z,{tooltip:(0,l.jsxs)("div",{className:"inline-flex gap-1",children:["Select",(0,l.jsx)("span",{className:"text-xs",children:(0,l.jsx)(u.Z,{code:"s"})})]}),placement:"bottom",autoPlacement:!1,children:(0,l.jsx)(i.Z,{variant:o?"primary":"secondary",onClick:g,children:(0,l.jsx)(s.GV,{className:"w-5 h-5"})})}),(0,l.jsx)(c.Z,{tooltip:(0,l.jsxs)("div",{className:"inline-flex gap-1",children:["Delete",(0,l.jsx)("span",{className:"text-xs",children:(0,l.jsx)(u.Z,{code:"d"})})]}),placement:"bottom",autoPlacement:!1,children:(0,l.jsx)(i.Z,{variant:n?"danger":"secondary",onClick:f,children:(0,l.jsx)(s.pJ,{className:"w-5 h-5"})})}),(0,l.jsx)(d.Z,{placement:"bottom",options:Object.values(p),selected:p[a],onChange:e=>null==y?void 0:y(e)})]})}var v=n(87006),f=n(30143),g=n(37618),y=n(31698),h=n(88670),x=n(32526),b=n(32379),C=n(27372),w=n(22149),k=n(5249),S=n(32605),Z=n(39043),E=n(83747);let j="rgb(16 185 129)",A={borderColor:j,fillColor:j,borderWidth:2,borderDash:[5,5],fillAlpha:.2};var M=n(86820),T=n(24547),N=n(18567);function B(e){let{viewport:t,dimensions:n,annotations:o,enabled:l=!0}=e,[a,i]=(0,r.useState)(null),s=(0,r.useMemo)(()=>{if(!l)return[];let{min:e,max:n}=t.time,{min:r,max:a}=t.freq;return o.filter(t=>{let{geometry:o}=t.sound_event;if(null==o)return!1;switch(o.type){case"Point":let[l,i]=o.coordinates;return l>=e&&l<=n&&i>=r&&i<=a;case"TimeStamp":let s=o.coordinates;return s>=e&&s<=n;case"TimeInterval":let[u,d]=o.coordinates;return d>=e&&u<=n;case"BoundingBox":let[c,p,m,v]=o.coordinates;return m>=e&&c<=n&&v>=r&&p<=a}return!0})},[l,o,t]),u=(0,r.useMemo)(()=>l?s.map(e=>{let{sound_event:{geometry:o}}=e;return(0,k.w9)(n,o,t)}):[],[l,s,t,n]),d=(0,r.useCallback)(e=>{if(!l)return;let{time:o,freq:r}=e,[a,d]=(0,k.f8)(n,[o,r],t),c=u.findIndex(e=>(0,k.MR)([a,d],e));if(c<0){i(null);return}let p=s[c];i(null!=p?p:null)},[u,s,t,n,l]);return(0,r.useEffect)(()=>{l||null==a||i(null)},[l,a]),{props:function(e){let{viewport:t,dimensions:n,enabled:o=!0,onHover:l}=e,a=(0,r.useMemo)(()=>({onMouseMove:e=>{if(!o)return;let r={x:e.nativeEvent.offsetX,y:e.nativeEvent.offsetY},a=(0,k._l)(r,t,n);null==l||l(a)}}),[t,n,o,l]);return o?a:{}}({enabled:l,viewport:t,dimensions:n,onHover:d}),hoveredAnnotation:a,clear:(0,r.useCallback)(()=>i(null),[])}}let D={borderColor:N.hM,fillColor:N.hM,borderWidth:3,fillAlpha:.2};var _=n(77916);let P={borderColor:N.Ej,borderWidth:1,size:7};function K(e,t){let{size:n=6,...o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:P,[l,r]=t;(0,N.F6)(e,o),e.strokeRect(l-n/2,r-n/2,n,n)}var L=n(87048);let F=N.ZA,q=N.ZA,I="rgb(16 185 129)",W={borderColor:I,fillColor:I,borderWidth:2,borderDash:[6,6],fillAlpha:.2};function G(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{length:n}=e.coordinates;return[...e.coordinates.map((e,t)=>({id:"vertex-".concat(t),type:"Keypoint",coords:e,drag:(e,n,o)=>{let l=[...e.coordinates],r=o.x-n.x,a=o.y-n.y,i=l[t];return l[t]=[i[0]+r,i[1]+a],{type:"LineString",coordinates:l}}})),...e.coordinates.slice(t?0:1).map((o,l)=>{let r=e.coordinates[t?(n+l-1)%n:l];return{id:"edge-".concat(l),type:"Edge",coords:[r,o],drag:(e,o,r)=>{let a=t?(n+l-1)%n:l,i=t?l:l+1,s=[...e.coordinates],u=r.x-o.x,d=r.y-o.y,c=s[a];s[a]=[c[0]+u,c[1]+d];let p=s[i];return s[i]=[p[0]+u,p[1]+d],{type:"LineString",coordinates:s}}}})]}function z(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[];return e.coordinates.forEach((e,o)=>{n.push(...G({type:"LineString",coordinates:e},t).map(e=>(function(e,t){let{drag:n,id:o}=e;return{...e,id:"".concat(o,"-").concat(t),drag:(e,o,l)=>{let r=[...e.coordinates],a=n({type:"LineString",coordinates:r[t]},o,l).coordinates;return r[t]=a,{type:"MultiLineString",coordinates:r}}}})(e,o)))}),n}function R(e){let{drag:t}=e;return{...e,drag:(e,n,o)=>({type:"Polygon",coordinates:t({type:"MultiLineString",coordinates:e.coordinates},n,o).coordinates})}}function X(e){let t=z({type:"MultiLineString",coordinates:e.coordinates},!0).map(R),n={id:"area",type:"Area",coords:e.coordinates,drag:(e,t,n)=>(0,k.zM)(e,[t.x,t.y],[n.x,n.y])};return t.push(n),t}let Y=(o=function(e,t){let{type:n}=e;switch(n){case"TimeStamp":return function(e,t){let{height:n}=t,o=e.coordinates;return[{id:"onset",type:"Edge",coords:[[o,0],[o,n]],drag:(e,t,n)=>{let o=n.x-t.x;return{type:"TimeStamp",coordinates:e.coordinates+o}}}]}(e,t);case"TimeInterval":return function(e,t){let{height:n}=t,[o,l]=e.coordinates;return[{id:"left",type:"Edge",coords:[[o,0],[o,n]],drag:(e,t,n)=>{let o=n.x-t.x,[l,r]=e.coordinates;return{type:"TimeInterval",coordinates:[l+o,r]}}},{id:"right",type:"Edge",coords:[[l,0],[l,n]],drag:(e,t,n)=>{let o=n.x-t.x,[l,r]=e.coordinates;return{type:"TimeInterval",coordinates:[l,r+o]}}},{id:"area",type:"Area",coords:[[[o,n],[o,0],[l,0],[l,n]]],drag:(e,t,n)=>{let o=n.x-t.x,[l,r]=e.coordinates;return{type:"TimeInterval",coordinates:[l+o,r+o]}}}]}(e,t);case"BoundingBox":return function(e){let[t,n,o,l]=e.coordinates;return[{id:"top-left",type:"Keypoint",coords:[t,n],drag:(e,t,n)=>{let o=n.x-t.x,l=n.y-t.y,[r,a,i,s]=e.coordinates;return{type:"BoundingBox",coordinates:[r+o,a+l,i,s]}}},{id:"bottom-left",type:"Keypoint",coords:[t,l],drag:(e,t,n)=>{let o=n.x-t.x,l=n.y-t.y,[r,a,i,s]=e.coordinates;return{type:"BoundingBox",coordinates:[r+o,a,i,s+l]}}},{id:"bottom-right",type:"Keypoint",coords:[o,n],drag:(e,t,n)=>{let o=n.x-t.x,l=n.y-t.y,[r,a,i,s]=e.coordinates;return{type:"BoundingBox",coordinates:[r,a+l,i+o,s]}}},{id:"top-right",type:"Keypoint",coords:[o,l],drag:(e,t,n)=>{let o=n.x-t.x,l=n.y-t.y,[r,a,i,s]=e.coordinates;return{type:"BoundingBox",coordinates:[r,a,i+o,s+l]}}},{id:"left",type:"Edge",coords:[[t,n],[t,l]],drag:(e,t,n)=>{let o=n.x-t.x,[l,r,a,i]=e.coordinates;return{type:"BoundingBox",coordinates:[l+o,r,a,i]}}},{id:"bottom",type:"Edge",coords:[[t,l],[o,l]],drag:(e,t,n)=>{let o=n.y-t.y,[l,r,a,i]=e.coordinates;return{type:"BoundingBox",coordinates:[l,r,a,i+o]}}},{id:"right",type:"Edge",coords:[[o,l],[o,n]],drag:(e,t,n)=>{let o=n.x-t.x,[l,r,a,i]=e.coordinates;return{type:"BoundingBox",coordinates:[l,r,a+o,i]}}},{id:"top",type:"Edge",coords:[[o,n],[t,n]],drag:(e,t,n)=>{let o=n.y-t.y,[l,r,a,i]=e.coordinates;return{type:"BoundingBox",coordinates:[l,r+o,a,i]}}},{id:"area",type:"Area",coords:[[[t,n],[t,l],[o,l],[o,n]]],drag:(e,t,n)=>{let o=n.x-t.x,l=n.y-t.y,[r,a,i,s]=e.coordinates;return{type:"BoundingBox",coordinates:[r+o,a+l,i+o,s+l]}}}]}(e);case"Point":return[{id:"point",type:"Keypoint",coords:e.coordinates,drag:(e,t,n)=>{let o=n.x-t.x,l=n.y-t.y,[r,a]=e.coordinates;return{type:"Point",coordinates:[r+o,a+l]}}}];case"MultiPoint":return e.coordinates.map((e,t)=>({id:"point-".concat(t),type:"Keypoint",coords:e,drag:(e,n,o)=>{let l=[...e.coordinates],r=o.x-n.x,a=o.y-n.y,[i,s]=e.coordinates[t];return l[t]=[i+r,s+a],{type:"MultiPoint",coordinates:l}}}));case"LineString":return G(e);case"MultiLineString":return z(e);case"Polygon":return X(e);case"MultiPolygon":return function(e){let t=[];return e.coordinates.forEach((e,n)=>{t.push(...X({type:"Polygon",coordinates:e}).map(e=>(function(e,t){let{drag:n,id:o}=e;return{...e,id:"".concat(o,"-").concat(t),drag:(e,o,l)=>{let r=[...e.coordinates],a=n({type:"Polygon",coordinates:r[t]},o,l).coordinates;return r[t]=a,{type:"MultiPolygon",coordinates:r}}}})(e,n)))}),t}(e);default:throw Error}},function(e){let{dimensions:t,object:n,enabled:l,style:a=W,onChange:i,onDrop:s,onDeselect:u}=e,[d,c]=(0,r.useState)(null),[p,m]=(0,r.useState)({shiftKey:!1,ctrlKey:!1}),{hovered:v,hoverProps:f}=function(e){let{elements:t,enabled:n=!0}=e,[o,l]=(0,r.useState)(null);return{hovered:o,hoverProps:function(e){let{enabled:t=!0,onHover:n}=e,o=(0,r.useMemo)(()=>({onMouseMove:e=>{n({position:{x:e.nativeEvent.offsetX,y:e.nativeEvent.offsetY},shift:e.shiftKey,ctrl:e.ctrlKey})}}),[n]);return t?o:{}}({onHover:(0,r.useCallback)(e=>{let{position:n}=e,o=t.find(e=>{let t=function(e){let{type:t}=e;switch(t){case"Keypoint":return{type:"Point",coordinates:e.coords};case"Edge":return{type:"LineString",coordinates:e.coords};case"Area":return{type:"Polygon",coordinates:e.coords};default:throw Error()}}(e);return(0,k.MR)([n.x,n.y],t)});if(!o){l(null);return}l(o)},[t]),enabled:n})}}({elements:(0,r.useMemo)(()=>null==n?[]:o(n,t),[n,t]),enabled:l}),{props:g,isDragging:y}=function(e){let{enabled:t=!0,onClick:n,onMoveStart:o,onMove:l,onMoveEnd:a}=e,[i,s]=(0,r.useState)(!1),[u,d]=(0,r.useState)({x:0,y:0}),[c,p]=(0,r.useState)(null),m=(0,r.useMemo)(()=>{if(!t)return{};let e=e=>{if(!t)return;let o={x:e.nativeEvent.offsetX,y:e.nativeEvent.offsetY};p(o),null==n||n({position:o,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,altKey:e.altKey})};return{onMouseDown:e,onPointerDown:e,onClick:e}},[t,n]),v=(0,r.useCallback)(function(){let{shiftKey:e,ctrlKey:n,altKey:l,metaKey:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t&&(d({x:0,y:0}),s(!0),null==o||o({shiftKey:e,ctrlKey:n,altKey:l,metaKey:r}))},[t,o]),f=(0,r.useCallback)(e=>{let{deltaX:n,deltaY:o,shiftKey:r,ctrlKey:a,altKey:i,metaKey:s}=e;t&&null!=c&&(d(e=>{let{x:t,y:l}=e;return{x:t+n,y:l+o}}),null==l||l({initial:c,current:{x:c.x+u.x+n,y:c.y+u.y+o},shiftKey:r,ctrlKey:a,altKey:i,metaKey:s}))},[t,c,u,l]),g=(0,r.useCallback)(function(){let{shiftKey:e,ctrlKey:n,altKey:o,metaKey:l}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t&&(p(null),s(!1),d({x:0,y:0}),null==a||a({shiftKey:e,ctrlKey:n,altKey:o,metaKey:l}))},[t,a]),{moveProps:y}=(0,M.r_)({onMoveStart:v,onMove:f,onMoveEnd:g});return{props:t?(0,T.dG)(y,m):{},isDragging:i}}({onMoveStart:(0,r.useCallback)(()=>{l&&(m({shiftKey:!1,ctrlKey:!1}),c(n))},[l,n]),onMoveEnd:(0,r.useCallback)(function(){let{ctrlKey:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l&&(c(null),null!=d&&d!==n&&(e?null==s||s(d):null==i||i(d)),m({shiftKey:!1,ctrlKey:!1}))},[l,n,d,i,s]),onMove:(0,r.useCallback)(e=>{let{initial:t,current:o,shiftKey:l=!1,ctrlKey:r=!1}=e;null!=v&&null!=n&&(m({shiftKey:l,ctrlKey:r}),l?c((0,k.vZ)(n,[t.x,t.y],[o.x,o.y])):c(v.drag(n,t,o)))},[v,n])}),h=(0,r.useCallback)(()=>{l&&null==v&&!y&&(null==u||u())},[l,v,y,u]),{pressProps:x}=(0,M.r7)({onPress:h}),b=(0,r.useCallback)(e=>{l&&null!=n&&(e.canvas.style.cursor="default",null!=v&&(e.canvas.style.cursor="pointer"),null!=d&&(e.canvas.style.cursor="grabbing",p.ctrlKey&&(e.canvas.style.cursor="copy")),o(null!=d?d:n,{width:e.canvas.width,height:e.canvas.height}).forEach(t=>(function(e,t,n,o){let{type:l}=t;switch(l){case"Keypoint":!function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];K(e,t.coords,{size:n?10:5,borderColor:n?q:F,borderWidth:n?3:1})}(e,t,o);break;case"Edge":!function(e,t,n){let{borderColor:o,borderWidth:l,borderAlpha:r,borderDash:a}=n,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],[s,u]=t.coords,d=[(s[0]+u[0])/2,(s[1]+u[1])/2];(0,Z.s6)(e,{type:"LineString",coordinates:[s,u]},{borderColor:i?N.ZA:o,borderWidth:i?3:l,borderAlpha:r,borderDash:a}),K(e,d,{size:i?10:5,borderColor:i?q:F,borderWidth:i?3:1})}(e,t,n,o);break;case"Area":!function(e,t,n){let{fillAlpha:o,fillColor:l,borderColor:r}=n,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(0,L.is)(e,{type:"Polygon",coordinates:t.coords},{fillAlpha:a?.3:o,fillColor:a?N.ZA:null!=l?l:r,borderWidth:0,borderAlpha:0})}(e,t,n,o)}})(e,t,a,t.id===(null==v?void 0:v.id))))},[l,n,a,v,d,p.ctrlKey]);return{props:l?(0,T.dG)(g,x,f):{},object:n,tmpObject:d,isEditing:null!=d,active:l,hovered:v,draw:b}}),J="rgb(16 185 129)",O={borderColor:J,fillColor:J,borderWidth:2,borderDash:[6,6],fillAlpha:.2},V={borderColor:N.ud,fillColor:N.ud,borderWidth:2,fillAlpha:.2};var H=n(79792),U=n(57195),Q=n(12353),$=n(76254),ee=n(7746),et=n(86674),en=n(52572),eo=n(79205);function el(e){var t,n;let{clipAnnotation:o,tagFilter:i,parameters:s=a._z,disabled:u=!1,height:d=384,withBar:c=!0,withPlayer:p=!0,withControls:j=!0,withSettings:N=!0,withAudioShortcuts:P=!0,withSpectrogramShortcuts:K=!0,defaultTags:L,onAddSoundEventTag:F,onRemoveSoundEventTag:q,onCreateSoundEventAnnotation:I,onUpdateSoundEventAnnotation:W,onDeleteSoundEventAnnotation:G,onParameterSave:z,onSelectAnnotation:R}=e,[X,J]=(0,r.useState)(!1),el=(0,r.useRef)(null),er=null!==(n=null===(t=el.current)||void 0===t?void 0:t.getBoundingClientRect())&&void 0!==n?n:{width:0,height:0},{clip:ea}=o,{recording:ei}=ea,es=(0,r.useMemo)(()=>({time:{min:ea.start_time,max:ea.end_time},freq:{min:0,max:ei.samplerate/2}}),[ea.start_time,ea.end_time,ei.samplerate]),eu=(0,r.useMemo)(()=>(0,eo.AX)({startTime:ea.start_time,endTime:ea.end_time,samplerate:ei.samplerate,parameters:s}),[ei.samplerate,ea.start_time,ea.end_time,s]),ed=(0,$.Z)({recording:ei,endTime:es.time.max,startTime:es.time.min,withShortcuts:P}),ec=(0,r.useCallback)(e=>{J("idle"===e),"idle"!==e&&(null==R||R(null))},[R]),{seek:ep}=ed,em=(0,r.useCallback)(e=>{let{position:t}=e;ep(t.time)},[ep]),ev=(0,et.Z)({dimensions:er,recording:ei,bounds:es,initial:eu,parameters:s,onDoubleClick:em,onModeChange:ec,enabled:!X&&!ed.isPlaying,withShortcuts:K}),{centerOn:ef}=ev,eg=(0,r.useCallback)(e=>ef({time:e}),[ef]),{draw:ey,enabled:eh}=(0,en.Z)({viewport:ev.viewport,currentTime:ed.currentTime,isPlaying:ed.isPlaying,onTimeChange:eg}),ex=(0,r.useCallback)(e=>J("idle"!==e),[]),eb=(0,r.useCallback)(()=>{J(!1),null==R||R(null)},[R]),eC=function(e){let{clipAnnotation:t,viewport:n,dimensions:o,defaultTags:l,mode:a="select",active:i=!0,disabled:s=!1,onModeChange:u,onSelectAnnotation:d,onCreateAnnotation:c,onAddAnnotationTag:p,onRemoveAnnotationTag:m,onUpdateAnnotation:v,onDeleteAnnotation:f,onDeselect:g}=e,{mode:y,geometryType:h,selectedAnnotation:x,setMode:j,setGeometryType:N,setSelectedAnnotation:P}=function(e){let{mode:t="select",geometryType:n="BoundingBox",selectedAnnotation:o=null,onChangeMode:l,onSelectAnnotation:a,onChangeGeometryType:i,disabled:s=!1}=e,[u,d]=(0,r.useState)(t),[c,p]=(0,r.useState)(n),[m,v]=(0,r.useState)(o),f=(0,r.useCallback)(e=>{if(s&&"idle"!==e&&"select"!==e)throw Error("Cannot change mode when disabled");d(e),null==l||l(e),"edit"==e||s||(v(null),null==a||a(null)),"idle"===e&&s&&(v(null),null==a||a(null))},[l,a,s]),g=(0,r.useCallback)(e=>{p(e),null==i||i(e)},[i]),y=(0,r.useCallback)(e=>{v(e),null==a||a(e),s||f("edit")},[a,f,s]);return{mode:u,geometryType:c,selectedAnnotation:m,setMode:f,setSelectedAnnotation:y,setGeometryType:g}}({mode:a,geometryType:"BoundingBox",onSelectAnnotation:d,onChangeMode:u}),{data:K,addSoundEvent:{mutate:L},removeSoundEvent:{mutate:F},updateSoundEvent:{mutate:q},addTagToSoundEvent:{mutate:I},removeTagFromSoundEvent:{mutate:W}}=(0,H.Z)({uuid:t.uuid,clipAnnotation:t,onAddSoundEventAnnotation:c,onUpdateSoundEventAnnotation:v,onDeleteSoundEventAnnotation:f,onAddTagToSoundEventAnnotation:p,onRemoveTagFromSoundEventAnnotation:m}),G=(0,r.useMemo)(()=>(null==K?void 0:K.sound_events)||[],[K]),z=(0,r.useCallback)(e=>{s||L({geometry:e,tags:l||[]},{onSuccess:e=>{P(e)}})},[l,L,s,P]),{props:R,draw:X}=function(e){let{viewport:t,dimensions:n,enabled:o=!0,geometryType:l="TimeStamp",onCreate:a}=e,{props:i,draw:s}=function(e){let{viewport:t,dimensions:n,enabled:o,style:l=b.y,onCreate:a}=e,[i,s]=(0,r.useState)(null),u=(0,r.useCallback)(()=>{s(null)},[]),d=(0,r.useCallback)(e=>{let{initial:t,shift:n}=e;s({type:"BoundingBox",coordinates:[Math.min(t.time,t.time+n.time),Math.min(t.freq,t.freq-n.freq),Math.max(t.time,t.time+n.time),Math.max(t.freq,t.freq-n.freq)]})},[]),c=(0,r.useCallback)(()=>{null!=i&&(null==a||a(i),s(null))},[i,a]),{props:p,isDragging:m}=(0,w.Z)({enabled:o,viewport:t,dimensions:n,onMoveStart:u,onMove:d,onMoveEnd:c});return(0,r.useEffect)(()=>{o||null==i||s(null)},[o,i]),{props:p,draw:(0,r.useCallback)(e=>{if(!o||null==i)return;let r=(0,k.w9)(n,i,t);(0,C.Z)(e,r,l)},[o,i,l,t,n]),isDragging:m}}({viewport:t,dimensions:n,onCreate:a,style:A,enabled:o&&"BoundingBox"===l}),{props:u,draw:d}=function(e){let{viewport:t,dimensions:n,enabled:o=!0,style:l=S.X,onCreate:a}=e,[i,s]=(0,r.useState)(null),u=(0,r.useCallback)(()=>{s(null)},[]),d=(0,r.useCallback)(e=>{let{initial:t,shift:n}=e;s({type:"TimeInterval",coordinates:[Math.min(t.time,t.time+n.time),Math.max(t.time,t.time+n.time)]})},[]),c=(0,r.useCallback)(()=>{null!=i&&(null==a||a(i))},[i,a]),{props:p,isDragging:m}=(0,w.Z)({enabled:o,viewport:t,dimensions:n,onMoveStart:u,onMove:d,onMoveEnd:c});return(0,r.useEffect)(()=>{o||null==i||s(null)},[o,i]),{props:p,draw:(0,r.useCallback)(e=>{if(!o||!m||null==i)return;let r=(0,k.w9)(n,i,t);(0,C.Z)(e,r,l)},[o,i,l,m,n,t]),isDragging:m}}({viewport:t,dimensions:n,onCreate:a,style:A,enabled:o&&"TimeInterval"===l}),{props:c,draw:p}=function(e){let{viewport:t,dimensions:n,enabled:o=!0,style:l=E.n,onCreate:a}=e,[i,s]=(0,r.useState)(null),u=(0,r.useCallback)(()=>{s(null)},[]),d=(0,r.useCallback)(e=>{let{initial:t,shift:n}=e;s({type:"TimeStamp",coordinates:t.time+n.time})},[]),c=(0,r.useCallback)(()=>{null!=i&&(null==a||a(i))},[i,a]),{props:p,isDragging:m}=(0,w.Z)({enabled:o,viewport:t,dimensions:n,onMoveStart:u,onMove:d,onMoveEnd:c});return(0,r.useEffect)(()=>{o||null==i||s(null)},[o,i]),{props:p,draw:(0,r.useCallback)(e=>{if(!o||null==i)return;let r=(0,k.w9)(n,i,t);(0,C.Z)(e,r,l)},[o,i,l,n,t]),isDragging:m}}({viewport:t,dimensions:n,onCreate:a,style:A,enabled:o&&"TimeStamp"===l}),{props:m,draw:v}=function(e){let{viewport:t,dimensions:n,enabled:o=!0,style:l=Z.nK,onCreate:a}=e,[i,s]=(0,r.useState)(null),[u,d]=(0,r.useState)(null),c=(0,r.useCallback)(()=>{s(e=>{var t;return null!==(t=null==e?void 0:e.slice(0,-1))&&void 0!==t?t:null}),d(null)},[]),p=(0,r.useCallback)(e=>{let{initial:t,shift:n}=e;d({time:t.time+n.time,freq:t.freq-n.freq})},[]),m=(0,r.useCallback)(e=>{let{point:t,shiftKey:n=!1,ctrlKey:o=!1}=e;if(o)return;if(null==i||i.length<2||!n){s(e=>null==e?[[t.time,t.freq]]:[...e,[t.time,t.freq]]);return}let l=null==i?[[t.time,t.freq]]:[...i,[t.time,t.freq]];null==a||a({type:"LineString",coordinates:l}),s(null)},[i,a]),v=(0,r.useCallback)(e=>{let{position:t,shiftKey:n=!1,ctrlKey:o=!1}=e;m({point:t,shiftKey:n,ctrlKey:o})},[m]),f=(0,r.useCallback)(function(){let{ctrlKey:e=!1,shiftKey:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null!=u&&(m({point:u,ctrlKey:e,shiftKey:t}),d(null))},[u,m]),{props:g,isDragging:y}=(0,w.Z)({enabled:o,viewport:t,dimensions:n,onClick:v,onMoveStart:c,onMove:p,onMoveEnd:f}),h=(0,r.useCallback)(e=>{if(o){if(null!=i){let o=(0,k.w9)(n,{type:"LineString",coordinates:i},t);(0,C.Z)(e,o,l)}if(null!=u){let o=(0,k.w9)(n,{type:"Point",coordinates:[u.time,u.freq]},t);(0,C.Z)(e,o,l)}if(null!=i&&null!=u&&i.length>0){let o={type:"LineString",coordinates:[i[i.length-1],[u.time,u.freq]]},r=(0,k.w9)(n,o,t);(0,C.Z)(e,r,l)}}},[o,i,l,t,n,u]);return(0,r.useEffect)(()=>{o||null==i||s(null)},[o,i]),{props:g,isDragging:y,draw:h,clear:(0,r.useCallback)(()=>{s(null),d(null)},[])}}({viewport:t,dimensions:n,onCreate:a,style:A,enabled:o&&"LineString"===l});switch(l){case"BoundingBox":return{props:i,draw:s};case"TimeInterval":return{props:u,draw:d};case"TimeStamp":return{props:c,draw:p};case"LineString":return{props:m,draw:v};default:throw Error("Invalid geometry type: ".concat(l))}}({viewport:n,dimensions:o,geometryType:h,enabled:i&&"draw"===y&&!s,onCreate:z}),{props:J,draw:$}=function(e){let{annotations:t,viewport:n,dimensions:o,enabled:l=!0,onSelect:a,onDeselect:i}=e,{props:s,hoveredAnnotation:u}=B({viewport:n,dimensions:o,annotations:t,enabled:l}),d=(0,r.useCallback)(()=>{l&&(null==u?null==i||i():null==a||a(u))},[u,l,a,i]),{pressProps:c}=(0,M.r7)({onPress:d,isDisabled:!l}),p=(0,r.useCallback)(e=>{if(!l||null==u)return;e.canvas.style.cursor="pointer";let t=(0,k.w9)({width:e.canvas.width,height:e.canvas.height},u.sound_event.geometry,n);(0,C.Z)(e,t,V)},[n,u,l]);return{props:(0,T.dG)(c,s),draw:p}}({viewport:n,dimensions:o,annotations:G,onSelect:P,onDeselect:g,enabled:i&&"select"===y}),{props:ee,draw:et}=function(e){let{annotations:t,viewport:n,dimensions:o,enabled:l=!0,onDelete:a,onDeselect:i}=e,{props:s,hoveredAnnotation:u,clear:d}=B({viewport:n,dimensions:o,annotations:t,enabled:l}),c=(0,r.useCallback)(()=>{l&&(null==u?null==i||i():(null==a||a(u),d()))},[u,l,a,i,d]),{pressProps:p}=(0,M.r7)({onPress:c,isDisabled:!l}),m=(0,r.useCallback)(e=>{if(!l||null==u)return;e.canvas.style.cursor="pointer";let t=(0,k.w9)({width:e.canvas.width,height:e.canvas.height},u.sound_event.geometry,n);(0,C.Z)(e,t,D)},[n,u,l]);return{props:(0,T.dG)(p,s),draw:m}}({viewport:n,dimensions:o,annotations:G,onDelete:(0,r.useCallback)(e=>{s||(F(e),j("idle"))},[F,j,s]),onDeselect:g,enabled:i&&"delete"===y&&!s}),en=(0,r.useCallback)(e=>{null==x||s||q({soundEventAnnotation:x,geometry:e},{onSuccess:e=>{P(e)}})},[x,q,P,s]),{props:eo,draw:el}=function(e){let{viewport:t,dimensions:n,annotation:o,enabled:l=!0,onEdit:a,onCopy:i,onDeselect:s}=e,u=(0,r.useCallback)(e=>{null!==o&&(null==i||i(o,e))},[o,i]),{draw:d,props:c}=function(e){var t;let{viewport:n,dimensions:o,soundEventAnnotation:l,enabled:a=!0,onChange:i,onCopy:s,onDeselect:u,style:d}=e,{geometry:c}=null!==(t=null==l?void 0:l.sound_event)&&void 0!==t?t:{},p=(0,r.useMemo)(()=>null==c?null:(0,k.w9)(o,c,n),[c,n,o]),m=(0,r.useCallback)(e=>{if(null==e)return;let t=(0,k.WC)(o,e,n);null==i||i(t)},[i,n,o]),v=(0,r.useCallback)(e=>{if(null==e)return;let t=(0,k.WC)(o,e,n);null==s||s(t)},[s,n,o]),f=Y({dimensions:o,object:p,enabled:a,style:d,onDrop:v,onChange:m,onDeselect:u}),g=(0,r.useMemo)(()=>null===f.object?null:(0,k.WC)(o,f.object,n),[o,n,f.object]);return{...f,geometry:g}}({viewport:t,dimensions:n,soundEventAnnotation:o,enabled:l,onChange:a,onCopy:u,onDeselect:s,style:O});return{draw:d,props:c}}({viewport:n,dimensions:o,annotation:x,onDeselect:g,onEdit:en,onCopy:(0,r.useCallback)((e,t)=>{s||L({geometry:t,tags:e.tags||[]},{onSuccess:e=>{P(e)}})},[L,P,s]),enabled:i&&"edit"===y&&!s}),er=(0,r.useCallback)((e,t)=>{s||W({soundEventAnnotation:e,tag:t})},[W,s]),ea=(0,r.useCallback)((e,t)=>{s||I({soundEventAnnotation:e,tag:t})},[I,s]),ei=(0,U.Z)({annotations:G,viewport:n,dimensions:o,onClickTag:er,onAddTag:ea,active:"draw"!==y&&"delete"!==y,disabled:s}),es=(0,_.Z)({viewport:n,annotations:G}),eu={};if(i)switch(y){case"select":eu=J;break;case"delete":eu=ee;break;case"draw":eu=R;break;case"edit":eu=eo;break;default:eu={}}let ed=(0,r.useMemo)(()=>{if(!i)return es;let e={select:$,delete:et,edit:el,draw:X,idle:()=>void 0}[y];return t=>{es(t),e(t)}},[i,y,es,X,$,et,el]),ec=(0,r.useCallback)(()=>{j("delete")},[j]),ep=(0,r.useCallback)(()=>{j("select")},[j]),em=(0,r.useCallback)(()=>{j("draw")},[j]),ev=(0,r.useCallback)(()=>{j("edit")},[j]),ef=(0,r.useCallback)(()=>{j("idle")},[j]);return(0,Q.Z)({onGoCreate:em,onGoDelete:ec,onGoSelect:ep,enabled:!s}),{mode:y,props:eu,draw:ed,geometryType:h,selectedAnnotation:x,enabled:"idle"!==y&&i,isSelecting:"select"===y&&i,isDrawing:"draw"===y&&i,isEditing:"edit"===y&&i,isDeleting:"delete"===y&&i,enableDelete:ec,enableSelect:ep,enableDraw:em,enableEdit:ev,disable:ef,setGeometryType:N,tags:ei}}({clipAnnotation:o,viewport:ev.viewport,dimensions:er,defaultTags:L,onModeChange:ex,onDeselect:eb,active:X&&!ed.isPlaying,onSelectAnnotation:R,disabled:u,onAddAnnotationTag:F,onRemoveAnnotationTag:q,onCreateAnnotation:I,onUpdateAnnotation:W,onDeleteAnnotation:G}),{props:ew,draw:ek,isLoading:eS}=ev,{props:eZ,draw:eE}=eC,ej=(0,r.useMemo)(()=>eS?e=>{e.canvas.style.cursor="wait"}:eh?e=>{ek(e),ey(e),eE(e)}:e=>{ek(e),eE(e)},[ek,ey,eE,eS,eh]);return(0,ee.Z)({ref:el,draw:ej}),(0,l.jsxs)(f.Z,{children:[(0,l.jsxs)("div",{className:"flex flex-row gap-4",children:[j&&(0,l.jsx)(y.Z,{canDrag:ev.canDrag,canZoom:ev.canZoom,onReset:ev.reset,onDrag:ev.enableDrag,onZoom:ev.enableZoom}),!u&&j&&(0,l.jsx)(m,{disabled:u,isDrawing:eC.isDrawing,isDeleting:eC.isDeleting,isSelecting:eC.isSelecting,isEditing:eC.isEditing,geometryType:eC.geometryType,onDraw:eC.enableDraw,onDelete:eC.enableDelete,onSelect:eC.enableSelect,onSelectGeometryType:eC.setGeometryType}),N&&(0,l.jsx)(h.Z,{samplerate:ei.samplerate,settings:ev.parameters,onChange:ev.setParameters,onReset:ev.resetParameters,onSave:()=>null==z?void 0:z(ev.parameters)}),p&&(0,l.jsx)(v.Z,{...ed})]}),(0,l.jsx)("div",{className:"relative overflow-hidden rounded-md",style:{height:d},children:(0,l.jsx)(x.ZP,{disabled:u,tags:eC.tags,filter:i,children:(0,l.jsx)("canvas",{ref:el,...X?eZ:ew,className:"absolute w-full h-full"})})}),c&&(0,l.jsx)(g.Z,{bounds:ev.bounds,viewport:ev.viewport,onMove:ev.zoom})]})}},32526:function(e,t,n){"use strict";n.d(t,{ZP:function(){return g}});var o=n(57437),l=n(73999),r=n(3870),a=n(54440),i=n.n(a),s=n(2265),u=n(45987),d=n(98023),c=n(97197);function p(e){let{onClose:t,onAdd:n,onCreate:l,filter:r,...a}=e;return(0,o.jsx)(d.Z,{onSelect:e=>{null==n||n(e)},onCreate:l,autoFocus:!0,onKeyDown:e=>{"Escape"===e.key?null==t||t():"Enter"===e.key&&(null==t||t())},initialFilter:r,...a})}function m(e){let{tag:t,onClick:n,disabled:l=!1}=e,r=(0,c.Z)(e=>e.getTagColor)(t),a=(0,s.useMemo)(()=>"bg-".concat(r.color,"-500"),[r]);return(0,o.jsxs)("span",{className:"flex flex-row gap-1 -my-2 items-center px-2 rounded-full transition-all group bg-stone-200/0 dark:bg-stone-800/0 hover:bg-stone-200 hover:dark:bg-stone-800",children:[(0,o.jsx)("span",{className:"inline-block my-2 w-2 h-2 rounded-full ".concat(a," ring-1 ring-stone-900 opacity-100")}),(0,o.jsxs)("button",{type:"button",className:"hidden flex-row gap-1 items-center opacity-0 transition-all group-hover:flex group-hover:opacity-100 hover:text-red-500 text-stone-800 dark:text-stone-400",onClick:n,children:[(0,o.jsx)("span",{className:"hidden text-xs font-thin whitespace-nowrap opacity-0 transition-all group-hover:inline-block group-hover:opacity-100",children:t.key}),(0,o.jsx)("span",{className:"hidden text-sm font-medium whitespace-nowrap opacity-0 transition-all group-hover:inline-block group-hover:opacity-100",children:t.value}),!l&&(0,o.jsx)(u.Tw,{className:"inline-block w-3 h-3 stroke-2"})]})]})}function v(e){let{filter:t,onCreate:n,onAdd:a}=e;return(0,o.jsx)(l.J,{as:"div",children:(0,o.jsxs)(r.bv,{placement:"bottom",offset:4,zIndex:20,enter:"transition duration-200 ease-out",enterFrom:"scale-95 opacity-0",enterTo:"scale-100 opacity-100",leave:"transition duration-150 ease-in",leaveFrom:"scale-100 opacity-100",leaveTo:"scale-95 opacity-0",portal:!0,children:[(0,o.jsxs)(l.J.Button,{className:"rounded hover:text-emerald-500 focus:ring-4 focus:outline-none group focus:ring-emerald-500/50 z-20",children:["+",(0,o.jsx)(u.lO,{className:"inline-block ml-1 w-4 h-4 stroke-2"}),(0,o.jsx)("span",{className:"hidden absolute ml-1 whitespace-nowrap opacity-0 transition-all duration-200 group-hover:inline-block group-hover:opacity-100",children:"Add tag"})]}),(0,o.jsx)(l.J.Panel,{className:"w-52",focus:!0,unmount:!0,children:e=>{let{close:l}=e;return(0,o.jsx)(p,{filter:t,onClose:l,onCreate:e=>{null==n||n(e),l()},onAdd:e=>{null==a||a(e),l()}})}})]})})}function f(e){let{group:t,filter:n,onCreate:l,disabled:r=!1}=e,{x:a,y:s}=t.position;return(0,o.jsxs)("div",{className:i()({"pointer-events-none":!t.active},"h-5 flex flex-col absolute px-2 text-stone-300 hover:z-50 z-40"),style:{left:a,top:s},children:[(0,o.jsx)("div",{className:"-ms-2 relative flex flex-col right-0 hover:gap-2",children:t.tags.map(e=>(0,o.jsx)(m,{...e,disabled:r},"".concat(e.tag.key,":").concat(e.tag.value)))}),!r&&(0,o.jsx)(v,{filter:n,onCreate:e=>{var n;null==l||l(e),null===(n=t.onAdd)||void 0===n||n.call(t,e)},onAdd:e=>{var n;null===(n=t.onAdd)||void 0===n||n.call(t,e)}})]})}function g(e){let{tags:t,children:n,filter:l,onCreate:r,disabled:a=!1}=e;return(0,o.jsxs)("div",{className:"relative w-full h-full rounded",children:[n,t.map(e=>(0,o.jsx)(f,{group:e,filter:l,onCreate:r,disabled:a},e.annotation.uuid))]})}},12353:function(e,t,n){"use strict";n.d(t,{Y:function(){return r},Z:function(){return a}});var o=n(57477),l=n(38727);let r=[{label:"Add Annotation",shortcut:"a",description:"Add a new annotation"},{label:"Select Annotation",shortcut:"s",description:"Select an annotation"},{label:"Delete Annotation",shortcut:"d",description:"Delete an annotation"}];function a(e){let{onGoCreate:t,onGoSelect:n,onGoDelete:r,enabled:a=!0}=e;(0,o.Z)((0,l.Z)({enabled:a,key:"a"}),t),(0,o.Z)((0,l.Z)({enabled:a,key:"s"}),n),(0,o.Z)((0,l.Z)({enabled:a,key:"d"}),r)}},77916:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var o=n(2265),l=n(27372),r=n(18567),a=n(5249);let i={borderColor:r.Ej,fillColor:r.Ej,borderWidth:2,fillAlpha:.1};function s(e){let{viewport:t,annotations:n}=e;return(0,o.useCallback)(e=>{for(let o of n){let n=(0,a.w9)({width:e.canvas.width,height:e.canvas.height},o.sound_event.geometry,t);(0,l.Z)(e,n,i)}},[t,n])}},79792:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var o=n(23588),l=n(81698),r=n(41095);function a(e){let{uuid:t,clipAnnotation:n,onDelete:a,onAddTag:i,onRemoveTag:s,onAddNote:u,onRemoveNote:d,onError:c,onAddSoundEventAnnotation:p,onDeleteSoundEventAnnotation:m,onUpdateSoundEventAnnotation:v,onAddTagToSoundEventAnnotation:f,onRemoveTagFromSoundEventAnnotation:g,enabled:y=!0}=e,{query:h,useMutation:x,useDestruction:b,setData:C,client:w}=(0,r.ZP)({name:"clip_annotation",uuid:t,initial:n,enabled:y,getFn:l.Z.clipAnnotations.get,onError:c}),k=b({mutationFn:l.Z.clipAnnotations.delete,onSuccess:a}),S=x({mutationFn:l.Z.clipAnnotations.addTag,onSuccess:i}),Z=x({mutationFn:l.Z.clipAnnotations.removeTag,onSuccess:s}),E=x({mutationFn:l.Z.clipAnnotations.addNote,onSuccess:u}),j=x({mutationFn:l.Z.clipAnnotations.removeNote,onSuccess:d}),A=(0,o.D)({mutationFn:e=>{let{geometry:t,tags:n}=e;if(null==h.data)throw Error("No clip annotation to add to.");return l.Z.soundEventAnnotations.create(h.data,{geometry:t,tags:n})},onSuccess:e=>{null==p||p(e),C(t=>{if(null==t)throw Error("No clip annotation to add to.");return{...t,sound_events:[...t.sound_events||[],e]}})}}),M=(0,o.D)({mutationFn:e=>{let{soundEventAnnotation:t,geometry:n}=e;return l.Z.soundEventAnnotations.update(t,{geometry:n})},onSuccess:e=>{w.setQueryData(["sound_event_annotation",e.uuid],e),null==v||v(e),C(t=>{if(null==t)throw Error("No clip annotation to add to.");return{...t,sound_events:(t.sound_events||[]).map(t=>t.uuid===e.uuid?e:t)}})}}),T=(0,o.D)({mutationFn:e=>l.Z.soundEventAnnotations.delete(e),onSuccess:e=>{null==m||m(e),C(t=>{if(null==t)throw Error("No clip annotation to add to.");return{...t,sound_events:(t.sound_events||[]).filter(t=>t.uuid!==e.uuid)}})}}),N=(0,o.D)({mutationFn:e=>{let{soundEventAnnotation:t,tag:n}=e;return l.Z.soundEventAnnotations.addTag(t,n)},onSuccess:e=>{null==f||f(e),C(t=>{if(null==t)throw Error("No clip annotation to add to.");return{...t,sound_events:(t.sound_events||[]).map(t=>t.uuid===e.uuid?e:t)}})}}),B=(0,o.D)({mutationFn:e=>{let{soundEventAnnotation:t,tag:n}=e;return l.Z.soundEventAnnotations.removeTag(t,n)},onSuccess:e=>{null==g||g(e),C(t=>{if(null==t)throw Error("No clip annotation to add to.");return{...t,sound_events:(t.sound_events||[]).map(t=>t.uuid===e.uuid?e:t)}})}});return{...h,delete:k,addTag:S,removeTag:Z,addNote:E,removeNote:j,addSoundEvent:A,updateSoundEvent:M,removeSoundEvent:T,addTagToSoundEvent:N,removeTagFromSoundEvent:B}}},57195:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var o=n(2265),l=n(5249),r=n(4004);function a(e){let{annotations:t,viewport:n,dimensions:a,onClickTag:i,onAddTag:s,active:u=!0,disabled:d=!1}=e,c=(0,o.useMemo)(()=>t.filter(e=>(0,l.PT)(e.sound_event.geometry,n)),[t,n]);return(0,o.useMemo)(()=>c.map(e=>{var t;let o=(0,r.D)(e,n,a);return{tags:(null===(t=e.tags)||void 0===t?void 0:t.map(t=>({tag:t,onClick:()=>null==i?void 0:i(e,t)})))||[],onAdd:t=>null==s?void 0:s(e,t),position:o,annotation:e,active:u,disabled:d}}),[c,n,a,u,i,s,d])}},61396:function(e,t,n){e.exports=n(25250)}}]);