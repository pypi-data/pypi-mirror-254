(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3440],{23550:function(e,t,n){Promise.resolve().then(n.bind(n,10815))},10815:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ey}});var s=n(57437),a=n(24033),l=n(2265),r=n(5925),o=n(57305),i=n(5909),c=n(68447),d=n(57760),u=n(59913),x=n(97486),m=n(30818),f=n(45987);let h=[{field:"pending",name:"Pending",render:e=>{let{value:t,clear:n}=e;return(0,s.jsx)(x.Z,{field:"Pending",value:t?"Yes":"No",onRemove:n})},selector:e=>{let{setFilter:t}=e;return(0,s.jsx)(m.vN,{onChange:e=>t("pending",e)})},description:"Select only tasks that are pending",icon:(0,s.jsx)(f.dY,{className:"h-5 w-5 inline-block text-stone-500 mr-1 align-middle"})},{field:"verified",name:"Verified",render:e=>{let{value:t,clear:n}=e;return(0,s.jsx)(x.Z,{field:"Verified",value:t?"Yes":"No",onRemove:n})},selector:e=>{let{setFilter:t}=e;return(0,s.jsx)(m.vN,{onChange:e=>t("verified",e)})},description:"Select tasks by their verified status",icon:(0,s.jsx)(f.SA,{className:"h-5 w-5 inline-block text-stone-500 mr-1 align-middle"})},{field:"rejected",name:"Needs Review",render:e=>{let{value:t,clear:n}=e;return(0,s.jsx)(x.Z,{field:"Needs Review",value:t?"Yes":"No",onRemove:n})},selector:e=>{let{setFilter:t}=e;return(0,s.jsx)(m.vN,{onChange:e=>t("rejected",e)})},description:"Select tasks by their review status",icon:(0,s.jsx)(f.wv,{className:"h-5 w-5 inline-block text-stone-500 mr-1 align-middle"})},{field:"dataset",name:"Dataset",render:e=>{let{value:t,clear:n}=e;return(0,s.jsx)(x.Z,{field:"Dataset",value:t.name,onRemove:n})},selector:e=>{let{setFilter:t}=e;return(0,s.jsx)(m.Z,{onChange:e=>t("dataset",e)})},description:"Select tasks that come from a specific dataset",icon:(0,s.jsx)(f.lQ,{className:"h-5 w-5 inline-block text-stone-500 mr-1 align-middle"})},{field:"recording_tag",name:"Recording Tag",render:e=>{let{value:t,clear:n}=e;return(0,s.jsx)(x.Z,{field:"Recording Tag",value:"".concat(t.key,": ").concat(t.value),onRemove:n})},selector:e=>{let{setFilter:t}=e;return(0,s.jsx)(m.D3,{onChange:e=>t("recording_tag",e)})},description:"Select task that come from a recording with a specific tag",icon:(0,s.jsx)(f.lO,{className:"h-5 w-5 inline-block text-stone-500 mr-1 align-middle"})}];var g=n(96883),j=n(62622),v=n(99505),p=n(20841),b=n(25799),k=n(57477),N=n(38727);function w(){let{shortcuts:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,n]=(0,l.useState)(!1);return(0,k.Z)((0,N.Z)({key:"h"}),()=>n(e=>!e)),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.Z,{mode:"text",variant:"info",type:"button",onClick:()=>n(!0),children:(0,s.jsx)(f.by,{className:"inline-block w-4 h-4 align-middle"})}),(0,s.jsx)(p.t,{title:"Keyboard Shortcuts",isOpen:t,onClose:()=>n(!1),children:()=>(0,s.jsxs)("table",{className:"border-collapse border border-stone-500 table-auto",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-1 border border-stone-500 text-center",children:"Key"}),(0,s.jsx)("th",{className:"p-1 border border-stone-500 text-center",children:"Action"}),(0,s.jsx)("th",{className:"p-1 border border-stone-500 text-center",children:"Description"})]})}),(0,s.jsxs)("tbody",{children:[(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"p-2 border border-stone-500 text-center",children:(0,s.jsx)(b.Z,{code:"h"})}),(0,s.jsx)("td",{className:"p-2 border border-stone-500 text-center font-bold",children:"Help"}),(0,s.jsx)("td",{className:"p-2 border border-stone-500 text-left",children:"Show this help."})]}),null==e?void 0:e.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"p-2 border border-stone-500 text-center",children:(0,s.jsx)(b.Z,{code:e.shortcut.trim()||"Space"})}),(0,s.jsx)("td",{className:"p-2 border border-stone-500 text-center font-bold",children:e.label}),(0,s.jsx)("td",{className:"p-2 border border-stone-500 text-left",children:e.description})]},e.shortcut))]})]})})]})}var Z=n(77997),C=n(51775),y=n(41738),T=n(12353);let S=[...C.c,...y.a,...T.Y];function A(e){var t;let{current:n,instructions:a,tasks:r,filter:o,onNext:i,onPrevious:x}=e,{missing:m,completed:k,verified:N,needReview:C,total:y}=(0,l.useMemo)(()=>(0,Z.q)(r),[r]);return(0,s.jsxs)("div",{className:"inline-flex gap-1 items-center h-full w-full",children:[(0,s.jsx)(v.Z,{tooltip:(0,s.jsxs)("div",{className:"inline-flex gap-2 items-center",children:["Previous Task",(0,s.jsx)("div",{className:"text-xs",children:(0,s.jsx)(b.Z,{code:"p"})})]}),placement:"bottom",children:(0,s.jsx)(c.Z,{mode:"text",padding:"p-1",onClick:x,children:(0,s.jsx)(f.jJ,{className:"inline-block w-8 h-8"})})}),(0,s.jsxs)("div",{className:"inline-flex gap-4 items-center px-2 h-full rounded-lg border grow dark:border-stone-800",children:[(0,s.jsxs)("div",{className:"inline-flex gap-3 items-center",children:[(0,s.jsx)(w,{shortcuts:S}),(0,s.jsx)(p.Z,{mode:"text",variant:"info",title:"Annotation Instructions",label:"Instructions",children:()=>(0,s.jsx)("p",{children:a})}),(0,s.jsxs)("span",{className:"inline-flex gap-1 items-center text-sm whitespace-nowrap",children:[(0,s.jsx)("span",{className:"text-stone-500",children:"#:"}),(0,s.jsx)("span",{className:"font-bold text-blue-500",children:n})]}),(0,s.jsxs)("span",{className:"text-sm inline-flex gap-1 items-center whitespace-nowrap",children:[(0,s.jsx)("span",{className:"text-stone-500",children:"Progress:"}),(0,s.jsx)("div",{className:"w-36",children:(0,s.jsx)(j.Z,{error:C,verified:N,total:y,complete:k,className:"mb-0"})})]})]}),(0,s.jsxs)("span",{className:"text-sm inline-flex gap-1 items-center whitespace-nowrap text-stone-500",children:[(0,s.jsx)("span",{children:"Remaining:"}),(0,s.jsx)("span",{className:"font-medium text-blue-500",children:m}),"/",y]}),(0,s.jsxs)("div",{className:"inline-flex gap-1 items-center",children:[(0,s.jsx)("span",{className:"text-sm text-stone-500",children:"Pending:"}),(0,s.jsx)(g.Z,{label:"Only Pending",isSelected:null!==(t=o.get("pending"))&&void 0!==t&&t,onChange:e=>{e?o.set("pending",e,!0):o.clear("pending",!0)}})]}),(0,s.jsx)(u.Z,{filter:o,filterDef:h,className:(0,c.y)({variant:"info",mode:"text",padding:"p-1"}),button:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.k1,{className:"inline-block mr-1 w-5 h-5"}),(0,s.jsx)("span",{className:"text-sm align-middle whitespace-nowrap",children:"Filters"})]})}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsx)(d.Z,{withLabel:!1,filter:o,filterDef:h})})]}),(0,s.jsx)(v.Z,{tooltip:(0,s.jsxs)("div",{className:"inline-flex gap-2 items-center",children:["Next Task",(0,s.jsx)("div",{className:"text-xs",children:(0,s.jsx)(b.Z,{code:"n"})})]}),placement:"bottom",children:(0,s.jsx)(c.Z,{mode:"text",padding:"p-1",onClick:i,children:(0,s.jsx)(f.Ne,{className:"inline-block w-8 h-8"})})})]})}var E=n(30143),_=n(2964),P=n(78471),F=n(98023),R=n(97197);function D(e){let{tags:t,tagFilter:n,onClick:a,onAddTag:l,onRemoveTag:r,onClearTags:o}=e,i=(0,R.Z)(e=>e.getTagColor);return(0,s.jsxs)(E.Z,{children:[(0,s.jsx)(_.H4,{className:"text-center",children:(0,s.jsxs)(v.Z,{tooltip:(0,s.jsx)("div",{className:"w-48 text-center",children:"The tags selected here will be automatically attached to newly created annotations."}),placement:"top",children:[(0,s.jsx)(f.oE,{className:"inline-block w-5 h-5 mr-1"}),(0,s.jsx)("span",{className:"cursor-help",children:"Tag Palette"})]})}),(0,s.jsxs)("div",{className:"flex flex-row gap-1 w-full",children:[(0,s.jsx)(v.Z,{tooltip:"Clear tags",placement:"top",children:(0,s.jsx)(c.Z,{onClick:o,mode:"text",variant:"danger",children:(0,s.jsx)(f.pJ,{className:"w-5 h-5"})})}),(0,s.jsx)("div",{className:"grow",children:(0,s.jsx)(F.Z,{onSelect:l,onCreate:l,initialFilter:n,placeholder:"Add tags..."})})]}),(0,s.jsx)("div",{className:"flex flex-row flex-wrap gap-1",children:t.map(e=>(0,s.jsx)(P.ZP,{tag:e,...i(e),onClick:()=>null==a?void 0:a(e),onClose:()=>null==r?void 0:r(e)},"".concat(e.key,"-").concat(e.value)))})]})}var M=n(28215),H=n(48992),L=n(66358),V=n(52887),B=n(50261),U=n(41819);function Q(e){var t;let{recording:n,onTagClick:a}=e,{path:l}=n,r=(0,L.yZ)(null!==(t=(0,L.eb)(l))&&void 0!==t?t:"");return(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsxs)("div",{className:"flex flex-row justify-start gap-8 items-center",children:[(0,s.jsxs)("div",{className:"inline-flex items-center text-stone-500",children:[(0,s.jsx)(f.He,{className:"inline-block mr-1 w-5 h-5 text-stone-600"}),(0,s.jsxs)(M.Z,{mode:"text",padding:"p-0",variant:"secondary",href:"/recordings/detail/?recording_uuid=".concat(n.uuid),className:"max-w-xl whitespace-nowrap",children:[r,(0,s.jsx)("span",{className:"text-sm text-stone-600",children:".WAV"})]})]}),(0,s.jsx)(V.Z,{latitude:n.latitude,longitude:n.longitude,disabled:!0}),(0,s.jsx)(U.Z,{time:n.time,disabled:!0}),(0,s.jsx)(H.Z,{date:n.date,disabled:!0}),(0,s.jsxs)("div",{className:"text-stone-500 text-sm",children:[(0,s.jsx)("span",{className:"font-semibold",children:"SR"})," ",n.samplerate.toLocaleString()," Hz"]}),(0,s.jsxs)("div",{className:"text-stone-500 text-sm",children:[(0,s.jsx)("span",{className:"font-semibold",children:"C"})," ",n.channels.toLocaleString()]}),(0,s.jsxs)("div",{className:"text-stone-500 text-sm",children:[(0,s.jsx)("span",{className:"font-semibold",children:"TE"})," ",n.time_expansion.toLocaleString()]})]}),(0,s.jsx)(B.Z,{label:"Recording Tags",recording:n,onTagClick:a,disabled:!0})]})}var q=n(89684);function O(e){var t;let{soundEventAnnotation:n}=e;return(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)(_.H4,{className:"text-center",children:"Sound Event Details"}),(0,s.jsx)(q.iV,{children:"Geometry Type"}),(0,s.jsx)(q.pj,{children:n.sound_event.geometry_type}),(0,s.jsx)("div",{className:"flex flex-row flex-wrap gap-4",children:null===(t=n.sound_event.features)||void 0===t?void 0:t.map(e=>(0,s.jsxs)("div",{children:[(0,s.jsx)(q.iV,{children:e.name}),(0,s.jsx)(q.pj,{children:e.value.toLocaleString()})]},e.name))})]})}var Y=n(30398),K=n(26356),z=n(59371);function G(){return(0,s.jsx)(Y.Z,{padding:"p-2",children:"No notes"})}function I(e){let{soundEventAnnotation:t,currentUser:n,onCreateNote:a,onUpdateNote:r,onDeleteNote:o}=e,i=(0,l.useMemo)(()=>t.notes||[],[t]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(_.H4,{className:"text-center",children:[(0,s.jsx)(f.uH,{className:"inline-block mr-1 w-5 h-5"}),"Sound Event Notes"]}),null!=a&&(0,s.jsx)(K.Z,{onCreate:a}),0===i.length?(0,s.jsx)(G,{}):(0,s.jsx)(z.Z,{notes:i,currentUser:n,onUpdate:r,onDelete:o})]})}var J=n(16693);function W(){return(0,s.jsx)(Y.Z,{padding:"p-2",children:"No tags"})}function X(e){let{soundEventAnnotation:t,tagFilter:n,onAddTag:a,onRemoveTag:r,onClickTag:o}=e,i=(0,l.useMemo)(()=>t.tags||[],[t]),c=(0,R.Z)(e=>e.getTagColor);return(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsxs)(_.H4,{className:"text-center",children:[(0,s.jsx)(f.Dg,{className:"inline-block mr-1 w-5 h-5"}),"Sound Event Tags"]}),(0,s.jsxs)("div",{className:"flex flex-row items-center flex-wrap gap-1",children:[i.map(e=>(0,s.jsx)(P.ZP,{tag:e,...c(e),onClick:()=>null==o?void 0:o(e),onClose:()=>null==r?void 0:r(e)},"".concat(e.key,"-").concat(e.value))),0===i.length&&(0,s.jsx)(W,{})]}),(0,s.jsx)("div",{className:"flex flex-row justify-center gap-4 items-center",children:(0,s.jsx)(J.Z,{variant:"primary",onAdd:a,filter:n,text:"Add tags",placeholder:"Add tags..."})})]})}var $=n(35452);function ee(e){let{soundEventAnnotation:t,clipAnnotation:n,tagFilter:a,onAddTag:l,onRemoveTag:r}=e,o=(0,$.Z)({uuid:t.uuid,clipAnnotation:n,soundEventAnnotation:t,onAddTag:l,onRemoveTag:r});return(0,s.jsxs)("div",{className:"w-full flex flex-row gap-8 py-4",children:[(0,s.jsx)(E.Z,{className:"grow",children:(0,s.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,s.jsx)(O,{soundEventAnnotation:o.data||t}),(0,s.jsx)(X,{tagFilter:a,soundEventAnnotation:o.data||t,onAddTag:o.addTag.mutate,onRemoveTag:o.removeTag.mutate})]})}),(0,s.jsx)(E.Z,{className:"grow",children:(0,s.jsx)(I,{soundEventAnnotation:o.data||t,onCreateNote:o.addNote.mutate})})]})}var et=n(7933),en=n(54440),es=n.n(en);let ea={assigned:f.tB,completed:f.nQ,verified:f.SA,rejected:f.wv},el={assigned:"bg-blue-100 border-blue-200 text-blue-500",completed:"bg-emerald-100 border-emerald-200 text-emerald-500",verified:"bg-amber-100 border-amber-200 text-amber-500",rejected:"bg-red-100 border-red-200 text-red-500"};function er(e){var t;let{badge:n,onClick:a,onRemove:l}=e,{state:r}=n,o=ea[r],i=el[r];return(0,s.jsxs)("div",{className:es()(i,"flex flex-row items-center rounded-full border max-w-fit p-1"),children:[(0,s.jsxs)("button",{type:"button",className:"group focus:outline-none focus:ring-4 focus:ring-emerald-500/50 rounded-md",disabled:null==a,onClick:a,children:[(0,s.jsx)(o,{className:es()("transition-all w-6 h-6 inline-block",null!=a&&"group-hover:stroke-3")}),(0,s.jsx)("span",{className:es()("transition-all text-stone-500 text-sm font-thin ml-1",null!=a&&"group-hover:font-medium"),children:null===(t=n.user)||void 0===t?void 0:t.username})]}),null!=l&&(0,s.jsx)("button",{type:"button",className:"ml-1 group focus:outline-none focus:ring-4 focus:ring-emerald-500/50 rounded-md",onClick:l,children:(0,s.jsx)(f.Tw,{className:"transition-all w-4 h-4 group-hover:stroke-3"})})]})}function eo(e){var t;let{task:n,onDone:a,onReview:l,onVerify:r,onRemoveBadge:o}=e;return(0,s.jsxs)("div",{className:"flex flex-row justify-between items-center border rounded-md border-stone-200 dark:border-stone-800 px-6",children:[(0,s.jsx)("div",{className:"flex flex-row flex-wrap gap-2",children:null==n?(0,s.jsx)(et.Z,{}):null===(t=n.status_badges)||void 0===t?void 0:t.map(e=>{var t;return(0,s.jsx)(er,{badge:e,onRemove:()=>null==o?void 0:o(e.state)},"".concat(e.state,"-").concat(null===(t=e.user)||void 0===t?void 0:t.id))})}),(0,s.jsxs)("div",{className:"flex flex-row gap-2 justify-center",children:[(0,s.jsx)(v.Z,{tooltip:(0,s.jsxs)("div",{className:"inline-flex gap-2 items-center",children:["Task Done!",(0,s.jsx)("div",{className:"text-xs",children:(0,s.jsx)(b.Z,{code:"g"})})]}),placement:"bottom",autoPlacement:!1,children:(0,s.jsx)(c.Z,{mode:"text",variant:"primary",onClick:a,children:(0,s.jsx)(f.nQ,{className:"w-8 h-8"})})}),(0,s.jsx)(v.Z,{tooltip:(0,s.jsxs)("div",{className:"inline-flex gap-2 items-center",children:["Needs Review",(0,s.jsx)("div",{className:"text-xs",children:(0,s.jsx)(b.Z,{code:"r"})})]}),placement:"bottom",autoPlacement:!1,children:(0,s.jsx)(c.Z,{mode:"text",variant:"danger",onClick:l,children:(0,s.jsx)(f.Tw,{className:"w-8 h-8"})})}),(0,s.jsx)(v.Z,{tooltip:(0,s.jsxs)("div",{className:"inline-flex gap-2 items-center",children:["Verified",(0,s.jsx)("div",{className:"text-xs",children:(0,s.jsx)(b.Z,{code:"v"})})]}),placement:"bottom",autoPlacement:!1,children:(0,s.jsx)(c.Z,{mode:"text",variant:"warning",onClick:r,children:(0,s.jsx)(f.SA,{className:"w-8 h-8"})})})]})]})}function ei(){return(0,s.jsx)(Y.Z,{padding:"p-2",children:"No notes"})}function ec(e){let{clipAnnotation:t,currentUser:n,onCreateNote:a,onUpdateNote:r,onDeleteNote:o}=e,i=(0,l.useMemo)(()=>(null==t?void 0:t.notes)||[],[t]);return(0,s.jsxs)(E.Z,{children:[(0,s.jsxs)(_.H4,{className:"text-center",children:[(0,s.jsx)(f.uH,{className:"inline-block mr-1 w-5 h-5"}),"Clip Notes"]}),(0,s.jsx)(K.Z,{onCreate:a}),0===i.length?(0,s.jsx)(ei,{}):(0,s.jsx)(z.Z,{notes:i,currentUser:n,onUpdate:r,onDelete:o})]})}var ed=n(15739);function eu(){return(0,s.jsx)(Y.Z,{padding:"p-2",children:"No tags currently registered in this clip."})}function ex(e){let{clipAnnotation:t,tagFilter:n,onAddTag:a,onRemoveTag:r,onClickTag:o,onClearTags:i,disabled:d=!1}=e,u=(0,l.useMemo)(()=>(null==t?void 0:t.tags)||[],[t]),x=(0,R.Z)(e=>e.getTagColor);return(0,s.jsxs)(E.Z,{children:[(0,s.jsxs)(_.H4,{className:"text-center",children:[(0,s.jsx)(f.Dg,{className:"inline-block mr-1 w-5 h-5"}),"Clip Tags"]}),(0,s.jsxs)("div",{className:"flex flex-row items-center flex-wrap gap-1",children:[u.map(e=>(0,s.jsx)(P.ZP,{tag:e,...x(e),onClick:()=>null==o?void 0:o(e),onClose:()=>null==r?void 0:r(e)},"".concat(e.key,"-").concat(e.value))),0===u.length&&(0,s.jsx)(eu,{})]}),!d&&(0,s.jsxs)("div",{className:"flex flex-row justify-end gap-4 items-center",children:[(0,s.jsxs)(c.Z,{className:"flex flex-row items-center",onClick:i,mode:"text",variant:"danger",children:["Clear tags ",(0,s.jsx)(f.pJ,{className:"ms-2 w-5 h-5"})]}),(0,s.jsx)(J.Z,{variant:"primary",onAdd:a,filter:n,text:"Add tags",placeholder:"Add tags..."})]})]})}var em=n(73558),ef=n(38038),eh=n(67663),eg=n(23588),ej=n(81698),ev=n(11988),ep=n(14781);let eb={};var ek=n(79792);function eN(e){let{taskFilter:t,tagFilter:n,parameters:a=i._z,annotationTask:r,currentUser:o,instructions:c,onCreateSoundEventAnnotation:d,onUpdateSoundEventAnnotation:u,onAddSoundEventTag:x,onRemoveSoundEventTag:m,onDeleteSoundEventAnnotation:f,onChangeTask:h,onAddClipTag:g,onRemoveClipTag:j,onParameterSave:v,onCompleteTask:p,onRejectTask:b,onVerifyTask:w}=e,[Z,C]=(0,l.useState)(null),[y,T]=(0,l.useState)([]),S=function(e){let{filter:t=eb,annotationTask:n,shuffle:s=!1,onChangeTask:a,onCompleteTask:r,onRejectTask:o,onVerifyTask:i}=e,[c,d]=(0,l.useState)(null!=n?n:null),u=(0,ef.NL)(),{items:x,filter:m,isLoading:f,isError:h,queryKey:g}=(0,ev.Z)({pageSize:-1,filter:t,fixed:Object.keys(t)}),j=(0,l.useMemo)(()=>s?(0,ep.S)(x):x,[x,s]),v=(0,l.useMemo)(()=>null===c?-1:j.findIndex(e=>e.uuid===c.uuid),[c,j]),p=(0,l.useCallback)(e=>{u.setQueryData(["annotation_task",e.uuid],e),d(e),null==a||a(e)},[a,u]),b=(0,l.useMemo)(()=>-1!==v?v<j.length-1:j.length>0,[v,j.length]),w=(0,l.useCallback)(()=>{b&&(-1===v?p(j[0]):p(j[v+1]))},[v,j,b,p]),Z=(0,l.useMemo)(()=>-1!==v?v>0:j.length>0,[v,j.length]),C=(0,l.useCallback)(()=>{Z&&(-1===v?p(j[0]):p(j[v-1]))},[v,j,Z,p]),{set:y}=m,T=(0,l.useCallback)((e,t)=>{y(e,t)},[y]),S=(0,l.useCallback)(async()=>{if(null==c)throw Error("No selected task");return ej.Z.annotationTasks.getAnnotations(c)},[c]),A=(0,eh.a)({queryKey:["annotation_task",null==c?void 0:c.uuid,"annotations"],queryFn:S,enabled:null!=c}),E=(0,l.useCallback)(e=>{u.setQueryData(["annotation_task",e.uuid],e),u.setQueryData(g,t=>null==t?t:{...t,items:t.items.map(t=>t.uuid===e.uuid?e:t)}),d(e)},[u,g]),_=(0,l.useCallback)(async()=>{if(null==c)throw Error("No selected task");return ej.Z.annotationTasks.addBadge(c,"completed")},[c]),P=(0,eg.D)({mutationFn:_,onSuccess:e=>{E(e),null==r||r(e),w()}}),F=(0,l.useCallback)(async()=>{if(null==c)throw Error("No selected task");return ej.Z.annotationTasks.addBadge(c,"rejected")},[c]),R=(0,eg.D)({mutationFn:F,onSuccess:e=>{E(e),null==o||o(e),w()}}),D=(0,l.useCallback)(async()=>{if(null==c)throw Error("No selected task");return ej.Z.annotationTasks.addBadge(c,"verified")},[c]),M=(0,eg.D)({mutationFn:D,onSuccess:e=>{E(e),null==i||i(e),w()}}),H=(0,l.useCallback)(async e=>{if(null==c)throw Error("No selected task");return ej.Z.annotationTasks.removeBadge(c,e)},[c]),L=(0,eg.D)({mutationFn:H,onSuccess:e=>{E(e)}}),V=(0,l.useCallback)(()=>{if(0===j.length)return;let e=j[Math.floor(Math.random()*j.length)];d(e),null==a||a(e)},[j,a]);return(0,l.useEffect)(()=>{null==c&&j.length>0&&p(j[0])},[c,j,p]),!function(e){let{onGoNext:t,onGoPrevious:n,onMarkCompleted:s,onMarkRejected:a,onMarkVerified:l,enabled:r=!0}=e;(0,k.Z)((0,N.Z)({enabled:r,key:"n"}),t),(0,k.Z)((0,N.Z)({enabled:r,key:"p"}),n),(0,k.Z)((0,N.Z)({enabled:r,key:"g"}),s),(0,k.Z)((0,N.Z)({enabled:r,key:"r"}),a),(0,k.Z)((0,N.Z)({enabled:r,key:"v"}),l)}({onGoNext:w,onGoPrevious:C,onMarkCompleted:P.mutate,onMarkRejected:R.mutate,onMarkVerified:M.mutate}),{current:v,task:c,filter:m.filter,tasks:j,isLoading:f,isError:h,goToTask:p,hasNextTask:b,hasPrevTask:Z,nextTask:w,prevTask:C,setFilter:T,annotations:A,markCompleted:P,markRejected:R,markVerified:M,removeBadge:L,selectRandomTask:V,_filter:m}}({filter:t,annotationTask:r,onChangeTask:h,onCompleteTask:p,onRejectTask:b,onVerifyTask:w}),{data:E,isLoading:_}=S.annotations,{data:P,addTag:F,removeTag:R,addNote:M,removeNote:H}=(0,ek.Z)({uuid:null==E?void 0:E.uuid,clipAnnotation:E,onAddTag:g,onRemoveTag:j,enabled:null!=E}),L=(0,l.useCallback)(async()=>{var e;let t=null==E?void 0:null===(e=E.tags)||void 0===e?void 0:e.slice(0);if(null!=t)for(let e of t)await R.mutateAsync(e)},[E,R]),V=(0,l.useCallback)(e=>{T(t=>t.some(t=>t.key===e.key&&t.value===e.value)?t:[...t,e])},[]),B=(0,l.useCallback)(e=>{T(t=>t.filter(t=>t.key!==e.key||t.value!==e.value))},[]),U=(0,l.useCallback)(()=>{T([])},[]);return S.isLoading?(0,s.jsx)(em.Z,{}):S.isError?(0,s.jsx)("div",{children:"Error loading annotation tasks"}):null==S.task?(0,s.jsx)(Y.Z,{children:"No tasks available"}):(0,s.jsxs)("div",{className:"w-full flex flex-col gap-3",children:[(0,s.jsxs)("div",{className:"flex flex-row justify-between gap-8",children:[(0,s.jsx)("div",{className:"grow",children:(0,s.jsx)(A,{current:S.current,instructions:c,tasks:S.tasks,filter:S._filter,onNext:S.nextTask,onPrevious:S.prevTask})}),(0,s.jsx)("div",{className:"w-[30rem] flex-none",children:null!=S.task&&(0,s.jsx)(eo,{task:S.task,onReview:S.markRejected.mutate,onDone:S.markCompleted.mutate,onVerify:S.markVerified.mutate,onRemoveBadge:S.removeBadge.mutate})})]}),(0,s.jsxs)("div",{className:"flex flex-row w-full gap-8",children:[(0,s.jsx)("div",{className:"grow flex flex-col gap-2",children:_?(0,s.jsx)(em.Z,{}):null==P?(0,s.jsx)(ew,{}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Q,{recording:P.clip.recording,onTagClick:V}),(0,s.jsx)(ed.Z,{parameters:a,clipAnnotation:P,defaultTags:y,onParameterSave:v,onSelectAnnotation:C,tagFilter:n,onAddSoundEventTag:x,onRemoveSoundEventTag:m,onCreateSoundEventAnnotation:d,onUpdateSoundEventAnnotation:u,onDeleteSoundEventAnnotation:f}),null==Z?(0,s.jsx)(Y.Z,{children:"No sound event selected. Select a sound event to view details."}):(0,s.jsx)(ee,{clipAnnotation:P,tagFilter:n,soundEventAnnotation:Z,onAddTag:x,onRemoveTag:m})]})}),(0,s.jsxs)("div",{className:"w-[30rem] flex-none flex flex-col gap-4",children:[(0,s.jsx)(D,{tags:y,tagFilter:n,onClick:F.mutate,onAddTag:V,onRemoveTag:B,onClearTags:U}),(0,s.jsx)(ex,{tagFilter:n,clipAnnotation:P,onAddTag:F.mutate,onRemoveTag:R.mutate,onClearTags:L}),(0,s.jsx)(ec,{onCreateNote:M.mutate,onDeleteNote:H.mutate,clipAnnotation:P,currentUser:o})]})]})]})}function ew(){return(0,s.jsx)(Y.Z,{children:"No clip selected"})}var eZ=n(41095),eC=n(83007);function ey(){let e=(0,a.useSearchParams)(),t=(0,a.usePathname)(),n=(0,a.useRouter)(),i=(0,l.useContext)(eC.Z),c=(0,l.useContext)(o.Z),d=e.get("annotation_task_uuid"),u=function(e){let{uuid:t,annotationTask:n,enabled:s=!0,withAnnotations:a=!1,onDelete:l,onAddBadge:r,onRemoveBadge:o,onError:i}=e,{query:c,useMutation:d,useQuery:u,useDestruction:x}=(0,eZ.ZP)({uuid:t,initial:n,name:"annotation_task",enabled:s,getFn:ej.Z.annotationTasks.get,onError:i}),m=u({name:"annotations",queryFn:ej.Z.annotationTasks.getAnnotations,enabled:a});m.error&&console.error(m.error);let f=x({mutationFn:ej.Z.annotationTasks.delete,onSuccess:l}),h=d({mutationFn:ej.Z.annotationTasks.addBadge,onSuccess:r}),g=d({mutationFn:ej.Z.annotationTasks.removeBadge,onSuccess:o});return{...c,addBadge:h,removeBadge:g,delete:f,annotations:m}}({uuid:d||"",enabled:!!d}),x=(0,R.Z)(e=>e.spectrogramSettings),m=(0,R.Z)(e=>e.setSpectrogramSettings),f=(0,l.useCallback)(e=>{r.ZP.success("Spectrogram settings saved."),m(e)},[m]),h=(0,l.useCallback)(s=>{let a=function(e){let{pathname:t,search:n,param:s,value:a}=e,l=new URL(t,window.location.origin),r=new URLSearchParams(n);return r.set(s,a),"".concat(l.toString(),"?").concat(r.toString())}({pathname:t,search:e,param:"annotation_task_uuid",value:s.uuid});n.push(a)},[n,t,e]),g=(0,l.useCallback)(()=>{r.ZP.success("Task marked as complete.")},[]),j=(0,l.useCallback)(()=>{r.ZP.error("Task marked for review.")},[]),v=(0,l.useCallback)(()=>{r.ZP.success("Task verified.")},[]),p=(0,l.useMemo)(()=>({annotation_project:i}),[i]);return u.isLoading&&!u.data?(0,s.jsx)(em.Z,{}):(0,s.jsx)(eN,{instructions:i.annotation_instructions||"",taskFilter:p,tagFilter:p,annotationTask:u.data,parameters:x,onChangeTask:h,currentUser:c,onParameterSave:f,onCompleteTask:g,onRejectTask:j,onVerifyTask:v})}},83007:function(e,t,n){"use strict";let s=(0,n(2265).createContext)({name:"",description:"",tags:[],created_on:new Date,uuid:""});t.Z=s},89684:function(e,t,n){"use strict";n.d(t,{iV:function(){return c},pj:function(){return i},ue:function(){return d}});var s=n(57437),a=n(54440),l=n.n(a),r=n(2265),o=n(45987);function i(e){let{children:t,className:n,...a}=e;return(0,s.jsx)("dd",{className:l()("mt-1 text-sm leading-6 text-stone-700 dark:text-stone-400 sm:col-span-2 sm:mt-0",n),...a,children:t})}function c(e){let{children:t,className:n,...a}=e;return(0,s.jsx)("dt",{className:l()("text-sm font-medium leading-6 text-stone-900 dark:text-stone-300",n),...a,children:t})}function d(e){let{children:t,Input:n,value:a,onChange:l,...c}=e,[d,u]=(0,r.useState)(!1),[x,m]=(0,r.useState)(a);return d?(0,s.jsx)(i,{children:(0,s.jsx)(n,{value:x,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(l(x),u(!1)),"Escape"===e.key&&(m(a),u(!1))},onBlur:()=>{m(a),u(!1)},onChange:e=>m(e.target.value),...c})}):(0,s.jsxs)(i,{className:"flex flex-row justify-between",children:[t,(0,s.jsx)("button",{onClick:()=>u(!0),className:"text-sm text-stone-500 underline ml-2",children:(0,s.jsx)(o.dY,{className:"w-5 h-5 inline-block text-blue-500"})})]})}},30398:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var s=n(57437);function a(e){let{children:t,padding:n="p-8"}=e;return(0,s.jsx)("div",{className:"".concat(n," w-full"),children:(0,s.jsx)("div",{className:"flex flex-col justify-center items-center p-4 w-full text-center rounded-md border border-dashed border-stone-500 text-stone-500",children:t})})}},62622:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var s=n(57437),a=n(54440),l=n.n(a);function r(e){let{total:t,complete:n,verified:a=0,error:r=0,className:o="mb-4"}=e,i=n/t*100,c=a/t*100,d=r/t*100,u=100-i-c-d;return(0,s.jsxs)("div",{className:l()(o,"w-full flex flex-row h-4 overflow-hidden bg-stone-200 rounded-full dark:bg-stone-700"),children:[(0,s.jsx)("div",{className:"flex flex-row items-center justify-center h-4 bg-blue-600 dark:bg-blue-400 text-blue-100 dark:text-blue-900",style:{width:"".concat(u,"%")},children:u>=10?"".concat(u.toPrecision(3),"%"):""}),(0,s.jsx)("div",{className:"flex flex-row items-center justify-center h-4 bg-red-600 dark:bg-red-400 text-red-100 dark:text-red-900",style:{width:"".concat(d,"%")},children:d>=10?"".concat(d.toPrecision(3),"%"):""}),(0,s.jsx)("div",{className:"flex flex-row items-center justify-center h-4 bg-emerald-600 dark:bg-emerald-400 text-emerald-100 dark:text-emerald-500",style:{width:"".concat(i,"%")},children:i>=10?"".concat(i.toPrecision(3),"%"):""}),(0,s.jsx)("div",{className:"flex flex-row items-center justify-center h-4 bg-amber-600 dark:bg-amber-400 text-amber-100 dark:text-amber-900",style:{width:"".concat(c,"%")},children:c>=10?"".concat(c.toPrecision(3),"%"):""})]})}},11988:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var s=n(81698),a=n(35532),l=n(57022);let r={},o=[];function i(){let{filter:e=r,fixed:t=o,pageSize:n=10,enabled:i=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=(0,a.Z)({defaults:e,fixed:t}),{query:d,pagination:u,items:x,total:m,queryKey:f}=(0,l.Z)({name:"annotation_tasks",queryFn:s.Z.annotationTasks.getMany,pageSize:n,filter:c.filter,enabled:i});return{...d,items:x,filter:c,pagination:u,total:m,queryKey:f}}},35452:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var s=n(2265),a=n(81698),l=n(41095);function r(e){let{uuid:t,soundEventAnnotation:n,clipAnnotation:r,onDelete:o,onUpdate:i,onAddTag:c,onRemoveTag:d,onAddNote:u,onError:x,enabled:m=!0,withRecording:f=!1}=e,{query:h,useQuery:g,useMutation:j,useDestruction:v,client:p}=(0,l.ZP)({name:"sound_event_annotation",uuid:t,initial:n,enabled:m,getFn:a.Z.soundEventAnnotations.get,onError:x}),b=g({name:"annotations",queryFn:(0,s.useMemo)(()=>f?()=>{if(null==h.data)throw Error("Cannot get recording for sound event annotation without recording");return a.Z.soundEvents.getRecording(h.data.sound_event)}:()=>{throw Error("Cannot get recording for sound event annotation without recording")},[h.data,f]),enabled:f&&null!=h.data}),k=(0,s.useCallback)(e=>{null!=r&&p.setQueryData(["clip_annotation",r.uuid],t=>{var n;if(null!=t)return{...t,sound_events:null===(n=t.sound_events)||void 0===n?void 0:n.map(t=>t.uuid===e.uuid?e:t)}})},[p,r]),N=(0,s.useCallback)(e=>{null==i||i(e),k(e)},[i,k]),w=j({mutationFn:a.Z.soundEventAnnotations.update,onSuccess:N}),Z=(0,s.useCallback)(e=>{null==o||o(e),k(e)},[o,k]),C=v({mutationFn:a.Z.soundEventAnnotations.delete,onSuccess:Z}),y=(0,s.useCallback)(e=>{null==c||c(e),k(e)},[c,k]),T=j({mutationFn:a.Z.soundEventAnnotations.addTag,onSuccess:y}),S=(0,s.useCallback)(e=>{null==d||d(e),k(e)},[d,k]),A=j({mutationFn:a.Z.soundEventAnnotations.removeTag,onSuccess:S}),E=(0,s.useCallback)(e=>{null==u||u(e),k(e)},[u,k]),_=j({mutationFn:a.Z.soundEventAnnotations.addNote,onSuccess:E});return{...h,update:w,delete:C,addTag:T,removeTag:A,addNote:_,recording:b}}},77997:function(e,t,n){"use strict";function s(e){let t=0,n=0,s=0,a=0;for(let r of e){var l;let e=!1,o=!1,i=!1;null===(l=r.status_badges)||void 0===l||l.forEach(t=>{let{state:n}=t;switch(n){case"verified":e=!0;break;case"rejected":i=!0;break;case"completed":o=!0}}),e&&!i&&(a+=1),o&&!i?s+=1:t+=1,i&&(n+=1)}return{missing:t,needReview:n,completed:s,verified:a,total:e.length}}n.d(t,{q:function(){return s}})},14781:function(e,t,n){"use strict";function s(e){let t=e.slice(0);for(var n=t.length-1;n>0;n--){var s=Math.floor(Math.random()*(n+1)),a=t[n];t[n]=t[s],t[s]=a}return t}function a(e,t){for(var n,s,a=e.slice(0),l=e.length;l--;)n=a[s=Math.floor((l+1)*Math.random())],a[s]=a[l],a[l]=n;return a.slice(0,t)}n.d(t,{S:function(){return s},o:function(){return a}})},24033:function(e,t,n){e.exports=n(15313)}},function(e){e.O(0,[1749,9966,3475,8966,5250,7663,828,721,3917,4766,2403,5166,3302,8311,1698,262,7548,457,9440,6207,9247,610,2971,4938,1744],function(){return e(e.s=23550)}),_N_E=e.O()}]);