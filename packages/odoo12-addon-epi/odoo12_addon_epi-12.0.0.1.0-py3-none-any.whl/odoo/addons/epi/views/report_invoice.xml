<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="epi_report_invoice_document" inherit_id="account.report_invoice_document">
            <t t-set="o" t-value="o.with_context(lang=lang)" />
            <xpath expr="//div[@class='page']" position="replace">
                <div name="wrapper" style="min-height:100%; position:relative;">
                    <div class="row pt-1" style="border-top: 1px solid #bbb; font-size: 14px;">
                        <div id="invoice_no" class="col-6">
                            <p>
                                <strong t-if="o.type == 'out_invoice' and o.state in ('open', 'in_payment', 'paid')">Invoice</strong>
                                <strong t-if="o.type == 'out_invoice' and o.state == 'draft'">Draft Invoice</strong>
                                <strong t-if="o.type == 'out_invoice' and o.state == 'cancel'">Cancelled Invoice</strong>
                                <strong t-if="o.type == 'out_refund'">Credit Note</strong>
                                <strong t-if="o.type == 'in_refund'">Vendor Credit Note</strong>
                                <strong t-if="o.type == 'in_invoice'">Vendor Bill</strong>
                                <span t-field="o.number"/>
                            </p>
                        </div>
                        <div id="date" class="col-6">
                            <div t-if="o.date_invoice" name="invoice_date">
                                <strong class="float-right">Invoice Date <span t-field="o.date_invoice"/></strong>
                            </div>
                        </div>
                    </div>
                    <div class="row pb-1" style="border-bottom: 2px solid #bbb; font-size: 14px;">
                        <div class="col-12" t-if="o.date_due and o.type == 'out_invoice' and o.state in ('open', 'in_payment', 'paid')" name="due_date">
                            <p class="text-right">Due Date <span t-field="o.date_due"/></p>
                        </div>
                    </div>
                    <div class="row py-3" style="font-size: 14px;">
                        <div id="client_details" class="col-6">
                            <strong t-field="o.partner_id.name"></strong>
                            <p class="m-0" t-field="o.partner_id.street"/>
                            <p class="m-0" t-field="o.partner_id.city"/>
                            <p class="m-0" t-field="o.partner_id.country_id"/>
                            <p class="m-0" t-field="o.partner_id.vat"/>
                        </div>
                        <div id="bank_account" class="col-6">
                            <strong class="float-right">Payment by bank transference</strong>
                            <p class="float-right" t-field="o.partner_bank_id"></p>
                        </div>
                    </div>
                    <div name="container" style="width:960px; margin:0 auto; padding-bottom:150px; min-height:800px;">
                        <t t-set="display_discount" t-value="any([l.discount for l in o.invoice_line_ids])"/>

                        <table style="font-size: 14px;">
                            <thead style="border-bottom: 2px solid #bbb;">
                                <tr>
                                    <th name="th_description" class="col-3"><span>Description</span></th>
                                    <th name="th_quantity" class="col-3"><span>Quantity</span></th>
                                    <th name="th_priceunit" class="col-3"><span>Price</span></th>
                                    <t t-if="display_discount">
                                        <th name="th_discount" class="col-3"><span>Discount</span></th>
                                    </t>
                                    <th name="th_subtotal" class="col-3"><span>Amount</span></th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="o.invoice_line_ids" t-as="line">
                                    <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                                        <t t-if="not line.display_type" name="account_invoice_line_accountable">
                                            <td class="col-3" name="account_invoice_line_name"><span t-field="line.name"/></td>
                                            <td class="col-3 text-right">
                                                <span t-field="line.quantity" t-options="{'widget': 'float', 'precision': 0}"/>
                                            </td>
                                            <td class="col-3 text-right">
                                                <span t-field="line.price_unit" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                            </td>
                                            <t t-if="display_discount">
                                                <td class="col-3 text-right"><span t-field="line.discount"/>%</td>
                                            </t>
                                            <td class="col-3 text-right">
                                                <span t-field="line.price_subtotal" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                            </td>
                                        </t>
                                        <t t-if="line.display_type == 'line_section'">
                                            <td colspan="99">
                                                <span t-field="line.name"/>
                                            </td>
                                            <t t-set="current_section" t-value="line"/>
                                            <t t-set="current_subtotal" t-value="0"/>
                                        </t>
                                        <t t-if="line.display_type == 'line_note'">
                                            <td colspan="99">
                                                <span class="font-weight-bold">NOTE </span>
                                                <span t-field="line.name"/>
                                            </td>
                                        </t>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                    <div style="border-top: 1px solid #bbb; font-size: 14px; height: 100px; width: 100%; position: absolute; bottom: 0;">
                        <div class="row">
                            <p class="col-8"/>
                            <p class="col-2 text-right">Subtotal</p>
                            <span class="col-2 text-right" t-field="o.amount_untaxed"/>
                        </div>
                        <div class="row">
                            <t t-foreach="o.amount_by_group" t-as="amount_by_group">
                                <t t-if="len(o.tax_line_ids) == 1 and o.amount_untaxed == amount_by_group[2]">
                                    <p class="col-8"/>
                                    <p class="col-2 text-right" t-esc="amount_by_group[0]"/>
                                    <span class="col-2 text-right" t-esc="amount_by_group[3]"/>
                                </t>
                                <t t-else="">
                                    <span t-esc="amount_by_group[0]"/>
                                    <span>&amp;nbsp;<span>on</span>
                                        <t t-esc="amount_by_group[4]"/>
                                    </span>
                                    <span t-esc="amount_by_group[3]"/>
                                </t>
                            </t>
                        </div>
                        <div class="row bg-light pt-2">
                            <p class="col-8"/>
                            <p class="col-2 text-right font-weight-bold">Import total</p>
                            <span class="col-2 text-right font-weight-bold" t-field="o.amount_total"/>
                        </div>
                    </div>
                    <!-- <div id="total"> Added to avoid view inheritance error -->
                    <div id="total">
                        <div>
                            <table>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="footer o_standard_footer">
                    <div style="line-height: 120%; font-size: 8px;">
                        <p><t t-raw="o.company_id.footer_doc_policy_text" /></p>
                    </div>
                    <div class="text-center" style="padding-top: 20px; font-size: 12px;">
                        ENERGÍA POR LA IGUALDAD, SCCL, Ins. al Reg. General de Cooperatives de Catalunya, Inscripció 14.751 com a Serveis.
                    </div>
                </div>
            </xpath>            
        </template>
    </data>
</odoo>
