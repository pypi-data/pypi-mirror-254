"use strict";(self.webpackChunkhintbot=self.webpackChunkhintbot||[]).push([[496],{496:(e,t,n)=>{n.r(t),n.d(t,{default:()=>p});var o=n(372),a=n(392),i=n(678),r=n(778),l=n(770),s=n(29),d=n.n(s);class c extends i.ReactWidget{constructor(e){super(),this._message="",this._message=e}getValue(){var e;return null===(e=this.node.querySelector("textarea"))||void 0===e?void 0:e.value}render(){return d().createElement("div",{className:"reflection"},d().createElement("label",null,this._message,d().createElement("textarea",{name:"reflection-input",className:"reflection-input",rows:10})))}}const u=e=>(0,i.showDialog)({title:"Reflection",body:new c(e),buttons:[i.Dialog.createButton({label:"Cancel"}),i.Dialog.createButton({label:"Submit"})],hasClose:!1});var m=n(170),h=n(387);async function g(e="",t={}){const n=h.ServerConnection.makeSettings(),o=m.URLExt.join(n.baseUrl,"hintbot",e);let a;try{a=await h.ServerConnection.makeRequest(o,t,n)}catch(e){throw new h.ServerConnection.NetworkError(e)}let i=await a.text();if(i.length>0)try{i=JSON.parse(i)}catch(e){console.log("Not a JSON response body.",a)}if(!a.ok)throw new h.ServerConnection.ResponseError(a,i.message||i);return i}const b=async(e,t,n,o)=>{var a;const r=null===(a=o.getMetadata("nbgrader"))||void 0===a?void 0:a.grade_id,l=o.getMetadata("remaining_hints");if(document.getElementById("hint-banner"))(0,i.showDialog)({title:"Please review previous hint first.",buttons:[i.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]}),n.exporters.forEach((t=>{n.publishEvent(e,{eventName:"HintAlreadyExists",eventTime:Date.now(),eventInfo:{gradeId:r}},t,!1)}));else if(l<1)(0,i.showDialog)({title:"No hint left for this question.",buttons:[i.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]}),n.exporters.forEach((t=>{n.publishEvent(e,{eventName:"NotEnoughHint",eventTime:Date.now(),eventInfo:{gradeId:r}},t,!1)}));else{const a=t.get("preReflection").composite,s=t.get("postReflection").composite;if((async(e,t,n,o)=>{var a;const r=n.getMetadata("nbgrader").grade_id,l=document.createElement("div");l.id="hint-banner-placeholder",e.content.node.insertBefore(l,e.content.node.firstChild);const s=document.createElement("div");s.id="hint-banner",null===(a=e.content.node.parentElement)||void 0===a||a.insertBefore(s,e.content.node),s.innerHTML='<p><span class="loader"></span>Retrieving hint... Please do not refresh the page.</p> <p>It usually takes around 2 minutes to generate a hint. You may continue to work on the assignment in the meantime.</p>';const d=document.createElement("div");d.id="hint-banner-cancel-button",d.innerText="Cancel request",s.appendChild(d),d.onclick=async()=>{await g("cancel",{method:"POST",body:JSON.stringify({problem_id:r})})};try{const n=await g("hint",{method:"POST",body:JSON.stringify({problem_id:r,buggy_notebook_path:e.context.path})});if(console.log("create ticket",n),!(null==n?void 0:n.request_id))throw new Error("Unable to create ticket");{const n=setInterval((async()=>{const a=await g("check",{method:"POST",body:JSON.stringify({problem_id:r})});if(0!==a.status)if(1===a.status)console.log("success"),clearInterval(n),(n=>{t.exporters.forEach((o=>{t.publishEvent(e,{eventName:"HintRequestCompleted",eventTime:Date.now(),eventInfo:{hintContent:n,gradeId:r}},o,!0)})),s.innerText=n,d.remove();const a=document.createElement("div");a.id="hint-banner-buttons-container";const i=document.createElement("div");i.id="hint-banner-buttons";const c=document.createElement("button");c.classList.add("hint-banner-button"),c.innerText="Helpful ðŸ‘";const m=document.createElement("button");m.classList.add("hint-banner-button"),m.innerText="Unhelpful ðŸ‘Ž";const h=async a=>{if(t.exporters.forEach((o=>{t.publishEvent(e,{eventName:"HintEvaluated",eventTime:Date.now(),eventInfo:{gradeId:r,hintContent:n,evaluation:a}},o,!0)})),o){const o=await u("Write a brief statement of what you learned from the hint and how you will use it to solve the problem.");"Submit"===o.button.label&&(s.remove(),l.remove()),t.exporters.forEach((a=>{t.publishEvent(e,{eventName:"PostReflection",eventTime:Date.now(),eventInfo:{status:o.button.label,gradeId:r,hintContent:n,reflection:o.value}},a,!0)}))}else s.remove(),l.remove()};c.onclick=()=>{h("helpful")},m.onclick=()=>{h("unhelpful")},i.appendChild(m),i.appendChild(c),a.appendChild(i),s.appendChild(a)})(a.result.feedback);else{if(2!==a.status)throw clearInterval(n),new Error("Unable to retrieve hint");console.log("cancelled"),clearInterval(n),s.remove(),l.remove(),(0,i.showDialog)({title:"Hint Request Cancelled",buttons:[i.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]}),t.exporters.forEach((n=>{t.publishEvent(e,{eventName:"HintRequestCancelled",eventTime:Date.now(),eventInfo:{gradeId:r}},n,!1)}))}else console.log("loading")}),1e3)}}catch(n){console.log(n),s.remove(),l.remove(),(0,i.showDialog)({title:"Hint Request Error. Please try again later",buttons:[i.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]}),t.exporters.forEach((n=>{t.publishEvent(e,{eventName:"HintRequestError",eventTime:Date.now(),eventInfo:{gradeId:r}},n,!1)}))}})(e,n,o,s),o.setMetadata("remaining_hints",l-1),document.getElementById(r).innerText=`Hint (${l-1} left for this question)`,e.context.save(),a){document.getElementById("hint-banner").style.filter="blur(10px)";const t=await u("Write a brief statement of what the problem is that you are facing and why you think your solution is not working.");document.getElementById("hint-banner").style.filter="none",n.exporters.forEach((o=>{n.publishEvent(e,{eventName:"PreReflection",eventTime:Date.now(),eventInfo:{status:t.button.label,gradeId:r,reflection:t.value}},o,!0)})),"Cancel"===t.button.label&&await g("cancel",{method:"POST",body:JSON.stringify({problem_id:r})})}}},v={id:"hintbot:plugin",description:"A JupyterLab extension.",autoStart:!0,requires:[a.INotebookTracker,o.ISettingRegistry,l.IJupyterLabPioneer],activate:async(e,t,n,o)=>{const a=document.createElement("button");a.innerText="Activate HintBot Extension",a.id="hintbot-activation-button";const l=document.createElement("div");l.appendChild(a);const s=await n.load(v.id);t.widgetAdded.connect((async(e,t)=>{await t.revealed,await o.loadExporters(t),t.toolbar.insertAfter("spacer","hintbot-activation-button",new r.Widget({node:l})),a.onclick=async()=>{"Confirm activation"===(await(0,i.showDialog)({body:"The hintbot extension is a prototype and not required to be used for the course. \n The hints generated could be wrong, and it involves sending data to third party services outside of the university.",buttons:[i.Dialog.createButton({label:"Cancel"}),i.Dialog.createButton({label:"Confirm activation"})],hasClose:!1})).button.label&&(await(async(e,t,n)=>{var o,a,i,r;const l=t.get("hintQuantity").composite,s=null===(o=e.content.model)||void 0===o?void 0:o.cells;if(s&&e.model.getMetadata("etc_identifier")&&"7ca0093b-b622-4463-8696-65f1e0f33522"===e.model.getMetadata("etc_identifier"))for(let o=0;o<s.length;o++)if(s.get(o).getMetadata("nbgrader")&&"markdown"===(null===(a=s.get(o).getMetadata("nbgrader"))||void 0===a?void 0:a.cell_type)&&(null===(i=s.get(o).getMetadata("nbgrader"))||void 0===i?void 0:i.grade_id)&&"cell-018440eg2f1b6a62"!==(null===(r=s.get(o).getMetadata("nbgrader"))||void 0===r?void 0:r.grade_id)){const a=document.createElement("button");a.classList.add("hint-button"),a.id=s.get(o).getMetadata("nbgrader").grade_id,a.onclick=()=>b(e,t,n,s.get(o)),e.content.widgets[o].node.appendChild(a),void 0===s.get(o).getMetadata("remaining_hints")?(s.get(o).setMetadata("remaining_hints",l),a.innerText=`Hint (${l} left for this question)`):a.innerText=`Hint (${s.get(o).getMetadata("remaining_hints")} left for this question)`}})(t,s,o),a.remove(),o.exporters.forEach((e=>o.publishEvent(t,{eventName:"HintBotActivated",eventTime:new Date},e,!1))))}}))}},p=v}}]);