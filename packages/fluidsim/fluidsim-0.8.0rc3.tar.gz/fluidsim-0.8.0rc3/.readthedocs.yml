version: 2

build:
  os: ubuntu-22.04
  tools:
    python: "3.11"
  apt_packages:
    # workaround: bad fluidfft with false hard dependency to mpi4py
    - libopenmpi-dev
    - graphviz
  jobs:
    post_create_environment:
      - pip install pdm pip -U
    post_install:
      - pdm use -f $READTHEDOCS_VIRTUALENV_PATH
      - FLUIDFFT_TRANSONIC_BACKEND="python" pip install fluidfft
      - pdm sync -G doc -G fft -G test --no-self
      - pip install . --config-settings=setup-args=-Dtransonic-backend=python

sphinx:
  configuration: doc/conf.py
