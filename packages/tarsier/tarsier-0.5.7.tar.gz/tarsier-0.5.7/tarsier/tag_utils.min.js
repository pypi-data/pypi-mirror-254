"use strict";const tarsierId="__tarsier_id",tarsierSelector=`#${tarsierId}`,elIsClean=t=>{const o=t.getBoundingClientRect(),i=window.getComputedStyle(t),e=i.visibility==="hidden"||i.display==="none"||t.hidden||t.disabled,a=i.opacity==="0",n=o.width===0||o.height===0,s=t.tagName==="SCRIPT"||t.tagName==="STYLE";return!e&&!a&&!n&&!s},inputs=["a","button","textarea","select","details","label"],isInteractable=t=>{const o=window.getComputedStyle(t);return inputs.includes(t.tagName.toLowerCase())||t.tagName.toLowerCase()==="input"&&t.type!=="hidden"||t.role==="button"||o.cursor=="pointer"},text_input_types=["text","password","email","search","url","tel","number"],isTextInsertable=t=>t.tagName.toLowerCase()==="textarea"||t.tagName.toLowerCase()==="input"&&text_input_types.includes(t.type),emptyTagWhitelist=["input","textarea","select","button"],isEmpty=t=>{const o=t.tagName.toLowerCase();if(emptyTagWhitelist.includes(o))return!1;if("innerText"in t&&t.innerText.trim().length===0){const i=t.querySelector("svg"),e=t.querySelector("img");return i||e?!1:isElementInViewport(t)}return!1};function isElementInViewport(t){const o=t.getBoundingClientRect();return o.top>=0&&o.left>=0&&o.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&o.right<=(window.innerWidth||document.documentElement.clientWidth)}function getElementXPath(t){let o=[],i="";for(t&&t.ownerDocument!==window.document&&(i=`iframe[${t.getAttribute("iframe_index")}]`);t;){if(!t.tagName){t=t.parentNode;continue}let e=t.tagName.toLowerCase(),a=1,n=t.previousElementSibling;for(;n;)n.tagName===t.tagName&&a++,n=n.previousElementSibling;let s=t.nextElementSibling,r=!1;for(;s;){if(s.tagName===t.tagName){r=!0;break}s=s.nextElementSibling}if((a>1||r)&&(e+=`[${a}]`),t.id)return e+=`[@id="${t.id}"]`,o.unshift(e),"//"+o.join("/");if(t.className){const c=Array.from(t.classList);e+=`[@class="${t.className}"]`}o.unshift(e),t=t.parentNode}return i+"//"+o.join("/")}function create_tagged_span(t,o){let i;isInteractable(o)?isTextInsertable(o)?i=`[#${t}]`:o.tagName.toLowerCase()=="a"?i=`[@${t}]`:i=`[$${t}]`:i=`[${t}]`;let e=document.createElement("span");return e.id=tarsierId,e.style.display="inline",e.style.color="white",e.style.backgroundColor="red",e.style.padding="2px",e.style.borderRadius="5px",e.style.fontWeight="regular",e.style.fontSize="0.75em",e.style.fontFamily="monospace",e.style.margin="2px",e.style.zIndex="2140000046",e.style.clip="auto",e.style.height="fit-content",e.style.width="fit-content",e.style.minHeight="fit-content",e.style.minWidth="fit-content",e.style.maxHeight="unset",e.style.maxWidth="unset",e.textContent=i,e}window.tagifyWebpage=(t=!1)=>{window.removeTags();let o=0,i={},e=[...document.body.querySelectorAll("*")];const a=document.getElementsByTagName("iframe");for(let n=0;n<a.length;n++)try{const s=a[n];console.log("iframe!",a[n]);const c=[...(s.contentDocument||s.contentWindow?.document).querySelectorAll("*")];c.forEach(l=>l.setAttribute("iframe_index",n)),e.push(...c)}catch(s){console.error("Cross-origin iframe:",s)}e.map(n=>{isInteractable(n)&&n.childNodes.forEach(s=>{const r=e.indexOf(s);r>-1&&e.splice(r,1)})});for(let n of e)if(!(isEmpty(n)||!elIsClean(n))){if(isInteractable(n))i[o]=getElementXPath(n),o++;else if(t)for(let s of Array.from(n.childNodes))s.nodeType===Node.TEXT_NODE&&/\S/.test(s.textContent||"")&&(i[o]=getElementXPath(n),o++)}o=0;for(let n of e){if(isEmpty(n)||!elIsClean(n))continue;let s=create_tagged_span(o,n);if(isInteractable(n))isTextInsertable(n)&&n.parentElement?n.parentElement.insertBefore(s,n):n.prepend(s),o++;else if(t){for(let r of Array.from(n.childNodes))if(r.nodeType===Node.TEXT_NODE&&/\S/.test(r.textContent||"")){let c=create_tagged_span(o,n);n.insertBefore(c,r),o++}}}return absolutelyPositionMissingTags(),removeCollidingTags(),i};function absolutelyPositionMissingTags(){document.querySelectorAll(tarsierSelector).forEach(e=>{const a=e.parentElement,n=a.getBoundingClientRect(),s={x:(n.left+n.right)/2,y:(n.top+n.bottom)/2},r=e.getBoundingClientRect(),c={x:(r.left+r.right)/2,y:(r.top+r.bottom)/2},l=Math.abs(s.x-c.x),d=Math.abs(s.y-c.y);(l>500||d>500||!elIsClean(e))&&(e.style.position="absolute",e.style.left=`${n.left-20}px`,e.style.top=`${n.top-20}px`,a.removeChild(e),document.body.appendChild(e))})}function removeCollidingTags(){const t=Array.from(document.querySelectorAll(tarsierSelector)),o=new Set;t.forEach((i,e)=>{if(o.has(i))return;const a=i.getBoundingClientRect();for(let n=0;n<t.length;n++){if(n===e||o.has(t[n]))continue;const r=t[n].getBoundingClientRect();if(!(r.right<a.left||r.left>a.right||r.bottom<a.top||r.top>a.bottom)){o.add(i);break}}}),o.forEach(i=>i.remove())}window.removeTags=()=>{document.querySelectorAll(tarsierSelector).forEach(o=>o.remove())};
