"use strict";(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[1887],{31887:(e,t,s)=>{s.r(t),s.d(t,{MdxError:()=>C,QueryTimeoutError:()=>_,addMissingTotalRows:()=>J,axisIds:()=>T,createActivePivotClient:()=>E,forEachCell:()=>W,getAxisId:()=>D,getAxisLength:()=>A,getCellSetMetaData:()=>$,getHierarchyIndicesInCellSet:()=>U,getMembersByHierarchy:()=>Q,getMissingTotals:()=>z,getQueryTotalsMetaData:()=>ae,getSortedTupleKey:()=>B,getTuple:()=>O,getTupleCaption:()=>F,getTupleKey:()=>j,getVisibleCubeDrillthroughColumns:()=>k,isCellSet:()=>y,isQueryErrorOfType:()=>N,isTotal:()=>P,trimTrailingTotals:()=>G});var r=s(70314),n=s(74854),i=s(64755);class a extends n.p{_unsafeWebSocket;pingPeriod;pingIntervalId;webSocketUrl;constructor({url:e,serverVersion:t,serviceVersion:s,requestInit:r,pingPeriod:n}){super({url:e,serverVersion:t,serviceVersion:s,requestInit:r}),this.pingPeriod=n||6e4,this.webSocketUrl=((e,t)=>{const[s,r]=e.split("://"),{wsPath:n}=t;return"https"===s?`wss://${r}${n}`:`ws://${r}${n}`})(e,s)}get webSocket(){if(!this._unsafeWebSocket)throw new Error("The WebSocket connection has not been established yet.");return this._unsafeWebSocket}async ping(e){await(0,i.q)(this.url,this.serviceVersion,{...this.requestInit,...e})}async openWebSocket(){this._unsafeWebSocket||(await this.ping({credentials:"include"}),this.pingIntervalId=window.setInterval((()=>{this.ping({credentials:"include"})}),this.pingPeriod),this._unsafeWebSocket=new WebSocket(this.webSocketUrl))}closeWebSocket(){this._unsafeWebSocket&&(this._unsafeWebSocket.readyState!==WebSocket.CLOSED&&this._unsafeWebSocket.close(),this._unsafeWebSocket=void 0),this.pingIntervalId&&clearInterval(this.pingIntervalId)}}var o=s(52947),c=s(40831),d=s(58267),u=s(5129),l=s(49419),h=s(54408),m=s(60136),p=s(14618),g=s(77026);function y(e){return"cells"in e}function f(e){return"success"===e.status}class v extends Error{queryId;constructor(e){super(`No query exists for id: "${e}".`),this.queryId=e}}const b={connectionStatus:"disconnected",connectionStatusListeners:[],isDataModelLoading:!1,calculatedMembers:{},drillthroughColumns:{},nextQueryId:0,_map:{}};var L=s(62854);async function S({url:e,pivotServiceVersion:t,requestInit:s,mdxDefinitionStatement:r,owners:n,readers:i}){await(0,L.P)(`${e}${t.restPath}/cube/configuration/execute`,{...s,method:"POST",headers:{"Content-Type":"application/json",...s?.headers},body:JSON.stringify({statement:r,owners:n,readers:i})})}var w=s(62887);async function q({cubeName:e,serverUrl:t,pivotServiceVersion:s,options:r}){const{restPath:n}=s;return(await(0,L.P)(`${t}${n}/cube/configuration/calculatedMembers/${e}`,r)).json()}async function x({serverUrl:e,pivotServiceVersion:t,options:s}){const{restPath:r}=t;return(await(0,L.P)(`${e}${r}/cube/discovery`,s)).json()}async function M({url:e,pivotServiceVersion:t,cubeName:s,requestInit:r}){const{restPath:n}=t;return(await(0,L.P)(`${e}${n}/cube/query/mdx/drillthroughheaders`,{...r,method:"POST",headers:{"Content-Type":"application/json",...r?.headers},body:`{"mdx": "DRILLTHROUGH SELECT FROM [${s}]"}`})).json()}function I(e,t){const s=e.name.identifiers[0];return s.value===t?e:(0,p.produce)(e,(e=>{e.name.identifiers.unshift({elementType:"Identifier",quoting:s.quoting,value:t})}))}class R extends a{state=b;constructor({url:e,serverVersion:t,serviceVersion:s,requestInit:n,pingPeriod:i}){super({url:e,serverVersion:t,serviceVersion:s,requestInit:{...n,headers:{...n?.headers,"x-activeui-version":r.activeuiVersion}},pingPeriod:i})}static create({url:e,serviceVersion:t,serverVersion:s,requestInit:r,pingPeriod:n}){const i=new R({url:e,serverVersion:s,serviceVersion:t,requestInit:r,pingPeriod:n});return i.connect(),i}async connect(){if("connected"===this.connectionStatus)return;const e=new Promise((e=>{const t=s=>{"connected"===s&&(e(),this.removeConnectionStatusListener(t))};this.addConnectionStatusListener(t)}));if("disconnected"===this.connectionStatus){this.dispatch({type:"webSocketOpening"});try{await this.openWebSocket(),this.webSocket.addEventListener("open",(()=>{this.dispatch({type:"webSocketOpened"})})),this.webSocket.addEventListener("message",(e=>{const t=JSON.parse(e.data);this.dispatch({type:"webSocketMessageReceived",message:t})})),this.webSocket.addEventListener("close",(()=>{this.disconnect()})),this.webSocket.addEventListener("error",(()=>{this.dispatch({type:"webSocketErrored"})}))}catch(e){if(this.disconnect(),e instanceof o.Q)return;throw e}}return e}disconnect(){"disconnected"!==this.connectionStatus&&(this.closeWebSocket(),this.dispatch({type:"webSocketClosed"}))}dispatch(e){const[t,s]=function(e,t){const{state:s,sideEffects:r}=(0,p.produce)({state:e,sideEffects:[]},(({state:s,sideEffects:r})=>{switch(t.type){case"queryRegistered":{const{id:e,mdx:n,context:i,ranges:a,updateMode:o="once"}=t;if(void 0!==s._map[e]?.query)throw new Error(`Cannot register a query for id: "${e}", because a query is already registered with this id.`);const c=s.nextQueryId.toString();s.nextQueryId+=1;const d=s._map[e]?.queryListeners??[],u=s._map[e]?.queryResultListeners??[],l={mdx:n,context:i,ranges:a,updateMode:o};return s._map[e]={queryVersion:c,queryResult:{isLoading:!0},query:l,queryListeners:d,queryResultListeners:u},void r.push({type:"webSocketSendMessage",message:{action:"REGISTER",data:{initialState:"once"===o?"PAUSED":"STARTED",streamId:e,queryId:c,mdxQuery:{mdx:n,context:i},ranges:a}}})}case"queryUpdated":{const{id:n,mdx:i,context:a,ranges:o,updateMode:c}=t,d=e._map[n]?.query,u=s._map[n]?.query;if(!d||!u)throw new v(n);const l=i&&(d.mdx!==i||!(0,g.isEqual)(d.context,a)),h=o&&!(0,g.isEqual)(d.ranges,o),m=c&&d.updateMode!==c;if(!l&&!h&&!m)return;const p=e._map[n].queryForCurrentResult?.mdx===i&&(0,g.isEqual)(e._map[n].queryForCurrentResult?.context,a)&&(0,g.isEqual)(e._map[n].queryForCurrentResult?.ranges,o);if(l||h)if(p)s._map[n].queryResult.isLoading=!1,s._map[n].query=e._map[n].queryForCurrentResult,s._map[n].queryVersion=e._map[n].queryVersionForCurrentResult;else{const e=s.nextQueryId.toString();s.nextQueryId+=1,s._map[n].queryVersion=e,s._map[n].queryResult={...s._map[n].queryResult,isLoading:!0},i&&l?(u.mdx=i,u.context=a,o&&h&&(u.ranges=o),r.push({type:"webSocketSendMessage",message:{action:"UPDATE",data:{streamId:n,queryId:e,mdxQuery:{mdx:i,context:a},ranges:o}}})):o&&h&&(u.ranges=o,r.push({type:"webSocketSendMessage",message:{action:"RANGE_UPDATE",data:{streamId:n,queryId:e,ranges:o}}}))}if(c&&m){s._map[n].query.updateMode=c;const e="once"===c;r.push({type:"webSocketSendMessage",message:{action:e?"PAUSE":"RESUME",data:n}})}return}case"queryRefreshed":{const e=t.id,n=s._map[e]?.query;if(!n)throw new v(e);return s._map[e].queryResult.isLoading=!0,void r.push({type:"webSocketSendMessage",message:{action:"REFRESH",data:e}})}case"queryUnregistered":if(void 0!==s._map[t.id]){const e=s._map[t.id].query,n=s._map[t.id].queryListeners,i=s._map[t.id].queryResultListeners;n&&n.length>0||i&&i.length>0?s._map[t.id]={queryListeners:n,queryResultListeners:i}:Reflect.deleteProperty(s._map,t.id),void 0!==e&&r.push({type:"webSocketSendMessage",message:{action:"UNREGISTER",data:t.id}})}return;case"webSocketOpening":return void(s.connectionStatus="connecting");case"webSocketOpened":s.connectionStatus="connected";for(const e in s._map){const t=s._map[e].query;if(t){const n=s._map[e].queryVersion;if(void 0===n)throw new Error(`Query with id ${e} is defined in the client state, but has no associated query version.`);const{mdx:i,context:a,updateMode:o,ranges:c}=t,d={action:"REGISTER",data:{initialState:"once"===o?"PAUSED":"STARTED",streamId:e,queryId:n,mdxQuery:{mdx:i,context:a},ranges:c}};r.push({type:"webSocketSendMessage",message:d})}}return;case"webSocketClosed":case"webSocketErrored":return void(s.connectionStatus="disconnected");case"connectionStatusListenerAdded":return void s.connectionStatusListeners.push(t.listener);case"connectionStatusListenerRemoved":{s.connectionStatusListeners.push(t.listener);const e=s.connectionStatusListeners.indexOf(t.listener);return void(-1!==e&&s.connectionStatusListeners.splice(e,1))}case"queryListenerAdded":return void 0===s._map[t.id]&&(s._map[t.id]={queryListeners:[]}),void 0===s._map[t.id]?.queryListeners&&(s._map[t.id].queryListeners=[]),void s._map[t.id].queryListeners.push(t.listener);case"queryResultListenerAdded":return void 0===s._map[t.id]&&(s._map[t.id]={queryResultListeners:[]}),void 0===s._map[t.id]?.queryResultListeners&&(s._map[t.id].queryResultListeners=[]),void s._map[t.id].queryResultListeners.push(t.listener);case"queryListenerRemoved":{const e=s._map[t.id].queryListeners.indexOf(t.listener);return void(-1!==e&&s._map[t.id].queryListeners.splice(e,1))}case"queryResultListenerRemoved":{const e=s._map[t.id].queryResultListeners.indexOf(t.listener);return void(-1!==e&&s._map[t.id].queryResultListeners.splice(e,1))}case"webSocketMessageReceived":{const{message:r}=t;if(void 0===e._map[r.streamId]||r.queryId!==e._map[r.streamId].queryVersion)return;s._map[r.streamId].queryForCurrentResult=e._map[r.streamId].query,s._map[r.streamId].queryVersionForCurrentResult=e._map[r.streamId].queryVersion;const n={isLoading:!1};return f(r)?(n.data=function(e,t){if(f(t))switch(t.type){case"cellData":if(void 0===e)throw new Error("Should have existing data to update.");if(!y(e))throw new Error("Received a Cellset update from ActivePivot about a query whose last result was a DrillthroughResult. This is not supported.");return(0,p.produce)(e,(e=>{e.epoch=t.data.epoch;const s=(0,g.keyBy)(t.data.cells,"ordinal");e.cells=e.cells.map((e=>s[e.ordinal]||e))}));case"drillthroughUpdateData":if(void 0===e)throw new Error("Received a Drillthrough update from ActivePivot about a query without a prior full drillthrough result. This is not supported.");if(y(e))throw new Error("Received a Drillthrough update from ActivePivot about a query whose last result was a Cellset. This is not supported.");return(0,p.produce)(e,(e=>{e.epoch=t.data.epoch;const{addedOrUpdatedRows:s,removedRows:r}=t.data;if(s&&Object.keys(s).forEach((t=>{const r=parseInt(t,10);e.result.rows[r]=s[r]})),r){r.sort();for(let t=r.length-1;t>=0;t--)e.result.rows.splice(r[t],1)}}));case"cellSetData":return{...t.data,cells:(0,g.sortBy)(t.data.cells,"ordinal")};case"drillthroughData":return t.data;default:throw new Error(`Unexpected ActivePivot client message type: "${t.type}". Valid types are ["cellData", "drillthroughUpdateData", "cellSetData", "drillthroughData"]`)}}(e._map[r.streamId].queryResult.data,r),n.error=void 0):n.error=r.error,void(s._map[r.streamId].queryResult=n)}case"dataModelLoadingStarted":s.isDataModelLoading=!0;break;case"dataModelLoaded":s.dataModel=t.dataModel,s.isDataModelLoading=!1,t.error&&(s.dataModelLoadingError=t.error);break;case"dataModelListenerAdded":s.dataModelListeners=[...s.dataModelListeners??[],t.listener];break;case"dataModelListenerRemoved":if(s.dataModelListeners){const e=s.dataModelListeners.indexOf(t.listener);-1!==e&&(s.dataModelListeners.splice(e,1),0===s.dataModelListeners.length&&delete s.dataModelListeners)}break;case"drillthroughColumnsLoading":(0,g.set)(s,`drillthroughColumns.${t.cubeName}.isLoading`,!0);break;case"drillthroughColumnsLoaded":(0,g.update)(s,`drillthroughColumns.${t.cubeName}`,(e=>(e.isLoading=!1,e.drillthroughColumns=t.drillthroughColumns,t.error&&(e.error=t.error),e)));break;case"drillthroughColumnsListenerAdded":(0,g.update)(s,`drillthroughColumns.${t.cubeName}.listeners`,((e=[])=>(e.push(t.listener),e)));break;case"drillthroughColumnsListenerRemoved":(0,g.update)(s,`drillthroughColumns.${t.cubeName}`,(e=>{const s=e?.listeners??[],r=s.indexOf(t.listener);return-1!==r&&(s.splice(r,1),0===s.length&&delete e.listeners),e}));break;case"calculatedMembersLoading":(0,g.set)(s,["calculatedMembers",t.cubeName,"isLoading"],!0);break;case"calculatedMembersLoaded":s.calculatedMembers[t.cubeName]={...s.calculatedMembers[t.cubeName],isLoading:!1,calculatedMembers:t.calculatedMembers,error:t.error};break;case"calculatedMembersListenerAdded":(0,g.update)(s,["calculatedMembers",t.cubeName,"listeners"],((e=[])=>(e.push(t.listener),e)));break;case"calculatedMembersListenerRemoved":(0,g.update)(s,["calculatedMembers",t.cubeName],(e=>{const s=e?.listeners??[],r=s.indexOf(t.listener);return-1!==r&&(s.splice(r,1),0===s.length&&delete e.listeners),e}));break;default:throw new Error(`Unexpected ActivePivot client reducer event type: "${t.type}". Valid types are ["queryRegistered", "queryUpdated", "queryRefreshed", "queryUnregistered", "webSocketOpening", "webSocketOpened", "webSocketClosed", "webSocketErrored", "queryListenerAdded", "queryListenerRemoved", "queryResultListenerAdded", "queryResultListenerRemoved", "connectionStatusListenerAdded", "connectionStatusListenerRemoved", "webSocketMessageReceived", "dataModelLoadingStarted", "dataModelLoaded", "dataModelListenerAdded", "dataModelListenerRemoved", "drillthroughColumnsLoaded", "drillthroughColumnsListenerAdded", "drillthroughColumnsListenerRemoved", "calculatedMembersLoaded", "calculatedMembersListenerAdded", "calculatedMembersListenerRemoved"]`)}}));return[s,r]}(this.state,e);s.forEach((e=>{if("webSocketSendMessage"!==e.type)throw new Error(`Unexpected ActivePivot client sideEffect type: ${e.type}. Valid types are ["webSocketSendMessage"]`);"connected"===t.connectionStatus&&this.webSocket.send(JSON.stringify(e.message))}));const r=this.state._map,n=this.connectionStatus,i=this.dataModel,a=this.state.calculatedMembers,o=this.state.drillthroughColumns;this.state=t;for(const e in t._map){const{query:t,queryResult:s,queryListeners:n,queryResultListeners:i}=this.state._map[e]||{},{query:a,queryResult:o}=r[e]||{};t!==a&&n?.forEach((e=>{e(t)})),s!==o&&i?.forEach((e=>{e(s)}))}this.connectionStatus!==n&&t.connectionStatusListeners.forEach((e=>{e(this.connectionStatus)})),this.dataModel!==i&&t.dataModelListeners?.forEach((e=>{e(this.dataModel)}));for(const e in this.state.drillthroughColumns){const t=this.state.drillthroughColumns[e],s=o[e],{drillthroughColumns:r,isLoading:n,error:i}=t;r===s?.drillthroughColumns&&n===s?.isLoading||t.listeners?.forEach((e=>{e(r,{error:i,isLoading:n})}))}for(const e in this.state.calculatedMembers){const t=this.state.calculatedMembers[e],s=a[e],{calculatedMembers:r,isLoading:n,error:i}=t;r===s?.calculatedMembers&&n===s?.isLoading||t.listeners?.forEach((e=>{e(r,{error:i,isLoading:n})}))}}register(e,t){this.dispatch({type:"queryRegistered",id:e,...t})}update(e,t){this.dispatch({type:"queryUpdated",id:e,...t})}setQuery(e,t){void 0!==this.state._map[e]?.query?this.update(e,t):this.register(e,t)}get connectionStatus(){return this.state.connectionStatus}addConnectionStatusListener(e){this.dispatch({type:"connectionStatusListenerAdded",listener:e})}removeConnectionStatusListener(e){this.dispatch({type:"connectionStatusListenerRemoved",listener:e})}getQuery(e){return this.state._map[e]?.query}addQueryListener(e,t){this.dispatch({type:"queryListenerAdded",id:e,listener:t})}removeQueryListener(e,t){this.dispatch({type:"queryListenerRemoved",id:e,listener:t})}getQueryResult(e){return this.state._map[e]?.queryResult}addQueryResultListener(e,t){this.dispatch({type:"queryResultListenerAdded",id:e,listener:t})}removeQueryResultListener(e,t){this.dispatch({type:"queryResultListenerRemoved",id:e,listener:t}),0===this.state._map[e].queryResultListeners.length&&this.dispatch({type:"queryUnregistered",id:e})}refreshQuery(e){this.dispatch({type:"queryRefreshed",id:e})}async loadDataModel({signal:e}={}){this.dispatch({type:"dataModelLoadingStarted"});const t=await async function(e){return 8===(0,w.z)(e.pivotServiceVersion.id)?x(e):async function(e){return(await x(e)).data}(e)}({serverUrl:this.url,pivotServiceVersion:this.serviceVersion,options:{...this.requestInit,signal:e}}),s=(0,c.M)(t);this.__UNSAFE_setDataModel__(s)}get dataModel(){return this.state.dataModel}get isDataModelLoading(){return this.state.isDataModelLoading}get drillthroughColumns(){return this.state.drillthroughColumns}get calculatedMembers(){return this.state.calculatedMembers}__UNSAFE_setDataModel__(e,t){this.dispatch({type:"dataModelLoaded",dataModel:e,error:t})}addDataModelListener(e){this.dispatch({type:"dataModelListenerAdded",listener:e})}removeDataModelListener(e){this.dispatch({type:"dataModelListenerRemoved",listener:e})}async loadDrillthroughColumns(e,{signal:t}={}){const s=this.state.drillthroughColumns[e];if(s&&s.isLoading)return;let r,n;this.dispatch({type:"drillthroughColumnsLoading",cubeName:e});try{n=await async function(e){return 8===(0,w.z)(e.pivotServiceVersion.id)?M(e):async function(e){return(await M(e)).data}(e)}({url:this.url,pivotServiceVersion:this.serviceVersion,cubeName:e,requestInit:{...this.requestInit,signal:t}})}catch(e){r=(0,m.b)(e),console.error(r)}this.dispatch({type:"drillthroughColumnsLoaded",cubeName:e,drillthroughColumns:n,error:r})}addDrillthroughColumnsListener(e,t){this.dispatch({type:"drillthroughColumnsListenerAdded",cubeName:e,listener:t})}removeDrillthroughColumnsListener(e,t){this.dispatch({type:"drillthroughColumnsListenerRemoved",cubeName:e,listener:t})}async loadCalculatedMembers(e,{signal:t}={}){const s=this.state.calculatedMembers[e];if(s&&s.isLoading)return;let r,n;this.dispatch({type:"calculatedMembersLoading",cubeName:e});try{n=await async function(e){return 8===(0,w.z)(e.pivotServiceVersion.id)?q(e):async function(e){return(await q(e)).data}(e)}({cubeName:e,serverUrl:this.url,pivotServiceVersion:this.serviceVersion,options:{...this.requestInit,signal:t}})}catch(e){r=(0,m.b)(e),console.error(r)}this.dispatch({type:"calculatedMembersLoaded",cubeName:e,calculatedMembers:n,error:r})}addCalculatedMembersListener(e,t){this.dispatch({type:"calculatedMembersListenerAdded",cubeName:e,listener:t})}removeCalculatedMembersListener(e,t){this.dispatch({type:"calculatedMembersListenerRemoved",cubeName:e,listener:t})}async createCalculatedMember({formula:e,cubeName:t,owners:s,readers:r}){const n=I(e,t),i=`CREATE ${(0,u.P)(n)}`;await S({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:i,owners:s,readers:r}),await this.loadCalculatedMembers(t)}async deleteCalculatedMember({memberUniqueName:e,cubeName:t}){const s=(0,l.I)(e),r=`DROP MEMBER ${s[0]===t?e:(0,h.mW)(t,...s)}`;await S({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:r}),await this.loadCalculatedMembers(t)}async updateCalculatedMember({formula:e,cubeName:t,owners:s,readers:r}){const n=I(e,t),i=`UPDATE ${(0,u.P)(n)}`;await S({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:i,owners:s,readers:r}),await this.loadCalculatedMembers(t)}async createKpi({kpi:e,cubeName:t,owners:s,readers:r}){let n=`CREATE KPI ${(0,h.mW)(t,e.name)} AS ${e.value}`;d.a.map((e=>e.slice(3))).forEach((t=>{const s=t;e[s]&&(n=`${n}, ${s.toUpperCase()}=${e[s]}`)})),await S({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:n,owners:s,readers:r})}async deleteKpi({kpiName:e,cubeName:t}){const s=`DROP KPI ${(0,h.mW)(t,e)}`;await S({url:this.url,pivotServiceVersion:this.serviceVersion,requestInit:this.requestInit,mdxDefinitionStatement:s})}}function E({url:e,serverVersion:t,serviceVersion:s,requestInit:r,pingPeriod:n}){return R.create({url:e,serverVersion:t,serviceVersion:s,requestInit:r,pingPeriod:n})}class C extends Error{error;constructor(e){super(e.errorChain[0].message),this.error=e}}class _ extends C{}function N(e,t){return e.errorChain.some((e=>e.type===t))}function k(e,t,{signal:s}={}){const{drillthroughColumns:r,isLoading:n}=e.drillthroughColumns[t]??{};return!n&&r?Promise.resolve(r.filter((e=>e.visible))):new Promise(((r,n)=>{const i=(s,a)=>{a.isLoading||(e.removeDrillthroughColumnsListener(t,i),a.error?n(a.error):r(s.filter((e=>e.visible))))};e.addDrillthroughColumnsListener(t,i),e.loadDrillthroughColumns(t,{signal:s}),s&&(s.onabort=()=>{e.removeDrillthroughColumnsListener(t,i),n(s.reason)})}))}function P(e,t){return!e.slicing&&1===t.namePath.length}var V=s(85365);const T={slicer:-1,columns:0,rows:1,pages:2,chapters:3,sections:4};function D(e){return T[e.toLowerCase()]}const A=e=>{const{range:t}=e;return t&&!t.entireAxis?t.axisLength:e.positions.length};function $(e,t){const s=[],r={};let n,i=0;for(const r of e.axes){const e=[],a=Object.values(r.hierarchies);for(let s=0;s<a.length;s++){const{dimension:o,hierarchy:c}=a[s];if("Measures"===o)n=r,i=s;else{const n=(0,V._)({dimensionName:o,hierarchyName:c},t),i=Object.values(n.levels).slice(n.slicing?0:1,r.maxLevelPerHierarchy[s]).map((({name:e,index:t})=>({dimensionName:o,hierarchyName:c,levelName:e,hierarchyIndex:s,levelIndex:t})));e.push(...i)}}for(const{hierarchyIndex:t,levelIndex:n,...i}of e){const e=r.positions.every((e=>{if(n<e[t].namePath.length){const s=e[t].namePath[n];return!isNaN(s)}return!0}));s.push({...i,isNumeric:e})}}const a=e.axes.find((({id:e})=>e===T.columns));if(n&&a&&[T.rows,T.columns].includes(n.id)){const t=A(a);for(const s of e.cells){const e=Math.floor(s.ordinal/t),a=s.ordinal%t,o=(n.id===T.columns?a:e)-(n.range?.from??0),c=n.positions[o][i].namePath[0],d=!1!==r[c]?.isNumeric&&!isNaN(s.value);r[c]={isNumeric:d}}}return{levels:s,measures:Object.entries(r).map((([e,{isNumeric:t}])=>({measureName:e,isNumeric:t})))}}const U=(e,t)=>{const s={};return e.axes.forEach(((e,r)=>{-1!==e.id&&(void 0===t||0===e.id&&t.axisNames.includes("COLUMNS")||1===e.id&&t.axisNames.includes("ROWS"))&&e.hierarchies.forEach((({dimension:e,hierarchy:t},n)=>{s[(0,h.mW)(e,t)]={dimensionName:e,hierarchyName:t,axisIndex:r,hierarchyIndex:n}}))})),s},O=({columnIndex:e,data:t,hierarchyIndicesInCellSet:s,rowIndex:r})=>{const n=[];let i=!1;return Object.values(s).forEach((({dimensionName:s,hierarchyName:a,axisIndex:o,hierarchyIndex:c})=>{const d=t.axes[o],u=d.range?.from||0,l=(0===d.id?e:r)-u;d.positions[l]&&(i=!0,void 0!==d.positions[l][c]&&n.push({dimensionName:s,hierarchyName:a,...d.positions[l][c]}))})),i?n:null},W=(e,t,s)=>{const[r,n]=[T.columns,T.rows].map((t=>{const s=e.axes.find((({id:e})=>e===t));return s?.positions.length??1}));let i=0;for(let a=0;a<n;a++)for(let n=0;n<r;n++){let o=null;const c=e.cells[i],d=a*r+n;c?.ordinal===d&&(i+=1,o=c),s({cell:o,cellIndex:o?i-1:null,columnIndex:n,tuple:O({columnIndex:n,data:e,hierarchyIndicesInCellSet:t,rowIndex:a}),rowIndex:a})}},Q=e=>(0,g.zipWith)(...e.positions,((...e)=>(0,g.uniqBy)(e,(e=>(0,h.mW)(...e.namePath))))).map(((t,s)=>({axisId:e.id,hierarchy:e.hierarchies[s],members:t}))),H=e=>e.map((({dimensionName:e,hierarchyName:t,namePath:s})=>e===t&&"Measures"===e?(0,h.mW)("Measures",s[0]):(0,h.mW)(e,t,...s))),j=e=>H(e).join(",")||"Total",B=e=>H(e.map((({dimensionName:e,hierarchyName:t,member:s})=>({dimensionName:e,hierarchyName:t,...s})))).sort().join(",")||"Total";function F(e,{cube:t,captionForTotals:s,separator:r=" ",hasOnlyCaptionForLeafLevels:n=!1}){if(0===e.length)return s;let i=!1;const a=(0,g.flatten)(e.map((({dimensionName:e,hierarchyName:s,...r})=>{if(void 0===r)return"";const a=r.namePath??r.path,o=r.captionPath;if("Measures"===e)return o;const c=(0,V._)({dimensionName:e,hierarchyName:s},t);return c.slicing||1!==a.length?n?o.at(-1):c.slicing?o:o.slice(1):(i=!0,[])})));return(i?[...a,s]:a).join(r)}function G(e,t,s){const r=(0,g.findLastIndex)(e,(e=>"Measures"===e.dimensionName?!s?.doesConsiderMeasuresAsTotals:!P((0,V._)(e,t),e)));return e.slice(0,r+1)}function K(e,{rowIndexOnScreen:t,rowIndexInData:s,numberOfMissingTotalRowsAbove:r}){if(e)for(let n=0;n<=r;n++)e[t+n]=s}const z=(e,t,{hierarchies:s,maxLevelPerHierarchy:r,cube:n})=>{const i=[];let[a,o]=((e,t,s)=>{if(!e)return[0,0];for(let r=0;r<s.length;r++)for(let n=0;n<s[r];n++){const s=e[r];if(t[r].namePath[n]!==s.namePath[n])return[r,n]}return[s.length-1,s.at(-1)??0]})(e,t,r);const c=((e,t)=>G(e,t).length)(t,n);for(;a<c;){const e=t[a];for(;o<e.namePath.length&&(a!==c-1||o!==e.namePath.length-1);){const s=[...t.slice(0,a),{...e,namePath:e.namePath.slice(0,o+1),captionPath:e.captionPath.slice(0,o+1)}],r="Measures"===e.dimensionName?null:(0,V._)(e,n);r&&s.every((e=>P(r,e)))||i.push(s),o++}if(a++,a<s.length){const e=s[a];o=null===e||e.slicing?0:1}}return i};function J(e,{cube:t,rowIndexMapping:s}){return t?(0,p.produce)(e,(r=>{const n=r.axes.find((({id:e})=>e===T.rows));if(!n)return;const i=n.range?.from??0,a=function(e,t){if(!t||0===e)return 0;let s=t.length-1,r=t[s];const n=e;for(;s>=0&&(r=t[s])&&r>n;)s-=r-n;return s+(e-r)}(i,s);let o=a-i;n.range&&a>0&&(n.range.from+=o,s&&s.length<n.range.from-1&&function(e,t){const s=e.length-1,r=s-e[s];let n=e.length-r;for(;e.length<t+r;)e.push(n),n++}(s,n.range.from));const c=n.hierarchies.map((({dimension:e,hierarchy:s})=>"Measures"===e?null:(0,V._)({dimensionName:e,hierarchyName:s},t))),d=[];let u=0,l=0;for(;u<n.positions.length;){const[e,r]=[u-1,u].map((e=>{if(-1!==e)return n.positions[e].map(((e,t)=>{const{dimension:s,hierarchy:r}=n.hierarchies[t];return{dimensionName:s,hierarchyName:r,...e}}))})),o=n.range&&n.range.from>0&&0===u?[]:z(e,r,{cube:t,hierarchies:c,maxLevelPerHierarchy:n.maxLevelPerHierarchy});if(n.positions.splice(u,0,...o),K(s,{rowIndexInData:i+l,rowIndexOnScreen:a+u,numberOfMissingTotalRowsAbove:o.length}),o.length>0){const e=n.range?n.range.from:0;d.push(...(0,g.range)(e+u,e+u+o.length))}u+=o.length+1,l+=1}!function(e,t){if(!e||t>=e.length-1)return;let s=t;for(;e[s+1]>e[s]+1;)e.splice(s+1,0,e[s]+1),s++}(s,a+u-1);const h=e.axes.find((({id:e})=>e===T.columns)),m=h?h.positions.length:0;r.cells.forEach((e=>{const t=Math.floor(e.ordinal/m);for(;d.length>0&&t+o>=d[0];)o+=1,d.shift();e.ordinal+=o*m})),n.range&&(n.range.to+=o,n.range.axisLength+=o)})):e}var X=s(41448),Y=s(85881),Z=s(17938),ee=s(53676),te=s(45379),se=s(25446),re=s(17298),ne=s(95735);function ie(e,{cube:t,levelCoordinates:s}){return(0,Z.E)(e,(e=>{if(!(0,ne.G)(e,"Members")||!(0,re.a)(e.arguments[0]))return!1;const r=(0,se.c)(e.arguments[0],{cube:t});return"level"===r.type&&(0,X.i)(r,s)}))?.path}function ae(e,{cube:t,hiddenGrandTotalsContextValue:s,hiddenSubTotalsContextValue:r}){const n={},i=s?s.split(","):[],a=(r?r.split(","):[]).map((e=>{const[t,s,r]=(0,l.I)(e);return{dimensionName:t,hierarchyName:s,levelName:r}}));return e?.axes.forEach((e=>{const s=function(e,t){const s=(0,ee.X)(e,t),r=[],n=[],i=[];if(0===s.length&&-1!==(0,te.n)(e))return{levelsWithToggleableTotals:r,levelsWithHiddenTotals:n,deepLevelsExpressedWithMembers:i,isGrandTotalHidden:!1,isGrandTotalToggleable:!1};let a=!0,o=!1,c=!1;for(let e=s.length-1;e>=0;e--){const{path:d,match:u,...l}=s[e];e===s.length-1||r.unshift(l),c&&n.unshift(l);const h=(0,V._)(l,t),m=(0,Y.K)({...l,cube:t});if(m>0){const e=ie(u,{cube:t,levelCoordinates:l});if(void 0!==e){o=!0;const t=[...d,...e];i.unshift({...l,pathWithinAxis:t}),c=!0}}const p=Object.values(h.levels).slice(h.slicing?0:1,m).reverse();for(const e of p){const t={...l,levelName:e.name};r.unshift(t),c&&n.unshift(t)}if(h.slicing){a=!1,o=!0;break}}return{levelsWithToggleableTotals:(0,g.uniqWith)(r,X.i),levelsWithHiddenTotals:(0,g.uniqWith)(n,X.i),deepLevelsExpressedWithMembers:i,isGrandTotalToggleable:a,isGrandTotalHidden:o}}(e,t),r=s.isGrandTotalHidden||i.includes(String(D(e.name))),o=(0,g.intersectionWith)(s.levelsWithToggleableTotals,[...s.levelsWithHiddenTotals,...a],X.i);n[e.name]={...s,isGrandTotalHidden:r,levelsWithHiddenTotals:o}})),n}},74854:(e,t,s)=>{s.d(t,{p:()=>r});class r{url;serverVersion;serviceVersion;requestInit;constructor({url:e,serverVersion:t,serviceVersion:s,requestInit:r}){this.url=e,this.serviceVersion=s,this.serverVersion=t,this.requestInit=r}}},55876:(e,t,s)=>{s.d(t,{o:()=>r});class r extends Error{static status=400;response;constructor(e){const{url:t}=e;super(`400: Bad request error on: ${t||"unspecified URL"}.`),this.name="BadRequestError",this.response=e}}},66035:(e,t,s)=>{s.d(t,{_:()=>r});class r extends Error{static status=403;expirationDate;constructor(e){super(`Your license expired on ${e.toLocaleDateString()}. Please contact ActiveViam.`),this.name="ExpiredLicenseError",this.expirationDate=e}}},67906:(e,t,s)=>{s.d(t,{l:()=>r});class r extends Error{static status=403;response;constructor(e){const{url:t}=e;super(`403: Access to: ${t||"unspecified URL"} is forbidden.`),this.name="ForbiddenError",this.response=e}}},66551:(e,t,s)=>{s.d(t,{H:()=>r});class r extends Error{static status=500;response;constructor(e){const{url:t}=e;super(`500: Internal server error on: ${t||"unspecified URL"}.`),this.name="InternalServerError",this.response=e}}},52947:(e,t,s)=>{s.d(t,{Q:()=>r});class r extends Error{url;constructor(e,t){super(`No response received from: ${e||"unspecified URL"}.`,t),this.name="NoResponseError",this.url=e}}},75084:(e,t,s)=>{s.d(t,{T:()=>r});class r extends Error{static status=404;response;constructor(e){const{url:t}=e;super(`404: The resource at ${t||"unspecified URL"} was not found.`),this.name="ResourceNotFoundError",this.response=e}}},53254:(e,t,s)=>{s.d(t,{y:()=>r});class r extends Error{static status=401;response;constructor(e){const{url:t}=e;super(`401: Not authorized to access: ${t||"unspecified URL"}.`),this.name="UnauthorizedError",this.response=e}}},62854:(e,t,s)=>{s.d(t,{P:()=>l});var r=s(60136),n=s(55876),i=s(66035),a=s(67906),o=s(66551),c=s(52947),d=s(75084),u=s(53254);async function l(e,t){try{const s=await fetch(e,t);switch(s.status){case 400:throw new n.o(s);case 401:throw new u.y(s);case 403:{let e;try{const t=await s.json(),r=(t.error?.errorChain??t.errorChain)[0];"ForbiddenAccessException"===r.type&&r.message.includes("license has expired")&&(e=new Date(r.message.slice(r.message.lastIndexOf("(")+1,r.message.lastIndexOf(")"))))}catch(e){}if(e)throw new i._(e);throw new a.l(s)}case 404:throw new d.T(s);case 500:throw new o.H(s)}return s}catch(t){const s=(0,r.b)(t);throw"Failed to fetch"===s.message||"NetworkError when attempting to fetch resource."===s.message||"Load failed"===s.message?new c.Q(e,{cause:s}):s}}},64755:(e,t,s)=>{s.d(t,{q:()=>n});var r=s(62854);async function n(e,t,s){const{restPath:n}=t;await(0,r.P)(`${e}${n}/ping`,s)}},35899:(e,t,s)=>{s.d(t,{R:()=>r});const r=["KPIValue","KPIGoal","KPIStatus","KPITrend","KPIStart","KPIExpiry"]},58267:(e,t,s)=>{s.d(t,{a:()=>r});const r=s(35899).R.map((e=>e.toLowerCase()))},40831:(e,t,s)=>{s.d(t,{M:()=>n});var r=s(77026);const n=e=>{const t=e.catalogs.map((e=>{const t=e.cubes.map((e=>(e=>{const t=e.dimensions.map((e=>{const t=e.hierarchies.map((e=>{const t=(0,r.keyBy)(e.levels.map(((e,t)=>({...e,index:t}))),"name");return{...e,levels:t}})),s=(0,r.keyBy)(t,"name");return{...e,hierarchies:s}})),{measures:s,kpis:n,sets:i,contextValues:a,measureGroups:o}=e;return{...e,dimensions:(0,r.keyBy)(t,"name"),measures:(0,r.keyBy)(s,"name"),kpis:(0,r.keyBy)(n,"name"),sets:(0,r.keyBy)(i,"name"),contextValues:(0,r.keyBy)(a,"name"),measureGroups:(0,r.keyBy)(o,"name")}})(e)));return{...e,cubes:(0,r.keyBy)(t,"name")}})),{contextValues:s}=e;return{catalogs:(0,r.keyBy)(t,"name"),contextValues:(0,r.keyBy)(s,"name")}}},38755:(e,t,s)=>{function r(e){return"measure"===e.type?e.measureName:e.identifiers[1].value}s.d(t,{S:()=>r})},45379:(e,t,s)=>{s.d(t,{n:()=>n});var r=s(58191);function n(e){const t=(0,r.w)(e);if(0===t.length)return-1;if(t[0].length<2)return 0;const s=t[0].slice(t[0].length-2);return"arguments"===s[0]?s[1]:0}},58191:(e,t,s)=>{s.d(t,{w:()=>c});var r=s(6083),n=s(41232),i=s(23764),a=s(65567),o=s(60200);const c=e=>{const t=[];if((0,o.V)(e))for(let t=0;t<e.axes.length;t++){const s=c(e.axes[t]);if(s.length>0)return s.map((e=>["axes",t,...e]))}if((0,a.Q)(e)){const s=e;(0,r.f)(s,((e,r)=>{if((0,i.H)(s,e,r)&&!t.some((e=>e.every(((e,t)=>r[t]===e))))){const{path:e}=(0,n.k)(s,r);t.push(e)}}))}return t}},23764:(e,t,s)=>{s.d(t,{H:()=>o});var r=s(77026),n=s(39845),i=s(95735),a=s(65567);const o=(e,t,s)=>{if(!(0,n.T)(t))return!1;const o=(0,r.initial)(s),c=(0,r.initial)(o),d=o.length>0?(0,r.get)(e,o):e,u=c.length>0?(0,r.get)(e,c):void 0;return(0,a.Q)(d)||(0,i.G)(u)&&("{}"===u.name||"crossjoin"===u.name.toLowerCase())}},39845:(e,t,s)=>{s.d(t,{T:()=>i});var r=s(38755),n=s(17298);const i=(e,{measureName:t}={})=>!(!(0,n.a)(e)||"measures"!==e.identifiers[0].value.toLowerCase()||void 0===e.identifiers[1]||void 0!==t&&(0,r.S)(e)!==t)}}]);